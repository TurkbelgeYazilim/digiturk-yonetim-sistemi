{
    "sourceFile": "test_iris_karsilastirma.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759332348169,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759332348169,
            "name": "Commit-0",
            "content": "<?php\r\n// Test script to debug iris_karsilastirma.php issues\r\n\r\n// Enable error reporting\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\nini_set('log_errors', 1);\r\n\r\necho \"=== DEBUGGING iris_karsilastirma.php ===\\n\\n\";\r\n\r\n// Test 1: Check if auth.php exists and can be included\r\necho \"1. Testing auth.php inclusion...\\n\";\r\ntry {\r\n    if (file_exists('auth.php')) {\r\n        echo \"auth.php exists\\n\";\r\n        require_once 'auth.php';\r\n        echo \"auth.php included successfully\\n\";\r\n    } else {\r\n        echo \"ERROR: auth.php not found\\n\";\r\n        exit;\r\n    }\r\n} catch (Exception $e) {\r\n    echo \"ERROR including auth.php: \" . $e->getMessage() . \"\\n\";\r\n    exit;\r\n}\r\n\r\n// Test 2: Check session\r\necho \"\\n2. Testing session...\\n\";\r\ntry {\r\n    if (session_status() == PHP_SESSION_NONE) {\r\n        session_start();\r\n    }\r\n    echo \"Session status: \" . session_status() . \"\\n\";\r\n    \r\n    if (isset($_SESSION['user_id'])) {\r\n        echo \"User logged in: \" . $_SESSION['user_id'] . \"\\n\";\r\n    } else {\r\n        echo \"No user session found - would redirect to login\\n\";\r\n    }\r\n} catch (Exception $e) {\r\n    echo \"ERROR with session: \" . $e->getMessage() . \"\\n\";\r\n}\r\n\r\n// Test 3: Check database configuration\r\necho \"\\n3. Testing database configuration...\\n\";\r\ntry {\r\n    $configFile = __DIR__ . '/config/mssql.php';\r\n    \r\n    if (!file_exists($configFile)) {\r\n        echo \"ERROR: Database config file not found: \" . $configFile . \"\\n\";\r\n        exit;\r\n    }\r\n    \r\n    $config = include $configFile;\r\n    echo \"Database config loaded successfully\\n\";\r\n    echo \"Host: \" . $config['host'] . \"\\n\";\r\n    echo \"Database: \" . $config['database'] . \"\\n\";\r\n    echo \"Username: \" . $config['username'] . \"\\n\";\r\n    \r\n} catch (Exception $e) {\r\n    echo \"ERROR loading database config: \" . $e->getMessage() . \"\\n\";\r\n}\r\n\r\n// Test 4: Check database connection\r\necho \"\\n4. Testing database connection...\\n\";\r\ntry {\r\n    $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n    \r\n    $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n        PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n        PDO::ATTR_EMULATE_PREPARES => false\r\n    ]);\r\n    \r\n    echo \"Database connection successful\\n\";\r\n    \r\n} catch (PDOException $e) {\r\n    echo \"ERROR connecting to database: \" . $e->getMessage() . \"\\n\";\r\n}\r\n\r\n// Test 5: Check if iris_rapor table exists\r\necho \"\\n5. Testing iris_rapor table...\\n\";\r\ntry {\r\n    if (isset($connection)) {\r\n        $sql = \"SELECT COUNT(*) as table_exists FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'iris_rapor'\";\r\n        $stmt = $connection->prepare($sql);\r\n        $stmt->execute();\r\n        $result = $stmt->fetch();\r\n        \r\n        if ($result['table_exists'] > 0) {\r\n            echo \"iris_rapor table exists\\n\";\r\n            \r\n            // Check table structure\r\n            $sql = \"SELECT COUNT(*) as record_count FROM iris_rapor\";\r\n            $stmt = $connection->prepare($sql);\r\n            $stmt->execute();\r\n            $result = $stmt->fetch();\r\n            echo \"Record count: \" . $result['record_count'] . \"\\n\";\r\n            \r\n        } else {\r\n            echo \"ERROR: iris_rapor table does not exist\\n\";\r\n        }\r\n    }\r\n} catch (PDOException $e) {\r\n    echo \"ERROR checking iris_rapor table: \" . $e->getMessage() . \"\\n\";\r\n}\r\n\r\n// Test 6: Test the problematic SQL query\r\necho \"\\n6. Testing problematic SQL query...\\n\";\r\ntry {\r\n    if (isset($connection)) {\r\n        $sql = \"\r\n            WITH DuplicateMemos AS (\r\n                SELECT MEMO_ID, COUNT(*) as kayit_sayisi\r\n                FROM iris_rapor \r\n                WHERE MEMO_ID IS NOT NULL\r\n                GROUP BY MEMO_ID\r\n                HAVING COUNT(*) > 1\r\n            )\r\n            SELECT TOP 5\r\n                ir.dosya_adi as 'Dosya Adı',\r\n                ir.MEMO_ID as 'Memo ID',\r\n                ir.GUNCEL_OUTLET_DURUM as 'Güncel Outlet',\r\n                ir.TEYIT_DURUM as 'Teyit Durumu',\r\n                ir.eklenme_tarihi as 'Eklenme Tarihi',\r\n                ir.guncellenme_tarihi as 'Güncellenme Tarihi',\r\n                dm.kayit_sayisi as 'Toplam Kayıt Sayısı'\r\n            FROM iris_rapor ir\r\n            INNER JOIN DuplicateMemos dm ON ir.MEMO_ID = dm.MEMO_ID\r\n            ORDER BY ir.MEMO_ID, ir.eklenme_tarihi DESC\r\n        \";\r\n        \r\n        $stmt = $connection->prepare($sql);\r\n        $stmt->execute();\r\n        $duplicates = $stmt->fetchAll();\r\n        \r\n        echo \"SQL query executed successfully\\n\";\r\n        echo \"Duplicate records found: \" . count($duplicates) . \"\\n\";\r\n        \r\n    }\r\n} catch (PDOException $e) {\r\n    echo \"ERROR executing SQL query: \" . $e->getMessage() . \"\\n\";\r\n    echo \"SQL State: \" . $e->getCode() . \"\\n\";\r\n}\r\n\r\n// Test 7: Check includes\r\necho \"\\n7. Testing includes...\\n\";\r\nif (file_exists('includes/header.php')) {\r\n    echo \"includes/header.php exists\\n\";\r\n} else {\r\n    echo \"ERROR: includes/header.php not found\\n\";\r\n}\r\n\r\nif (file_exists('includes/footer.php')) {\r\n    echo \"includes/footer.php exists\\n\";\r\n} else {\r\n    echo \"ERROR: includes/footer.php not found\\n\";\r\n}\r\n\r\necho \"\\n=== DEBUG COMPLETE ===\\n\";\r\n?>"
        }
    ]
}