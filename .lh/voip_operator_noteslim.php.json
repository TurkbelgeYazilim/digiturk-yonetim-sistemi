{
    "sourceFile": "voip_operator_noteslim.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1760609804958,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1760610232459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -82,16 +82,23 @@\n // Kullanıcıları al (tüm kullanıcılar, status kontrolü yok)\r\n try {\r\n     $conn = getDatabaseConnection();\r\n     \r\n-    $userSql = \"SELECT id, first_name, last_name FROM users ORDER BY first_name, last_name\";\r\n+    $userSql = \"SELECT id, ISNULL(first_name, '') as first_name, ISNULL(last_name, '') as last_name FROM users ORDER BY first_name, last_name\";\r\n     $userStmt = $conn->prepare($userSql);\r\n     $userStmt->execute();\r\n     $users = $userStmt->fetchAll(PDO::FETCH_ASSOC);\r\n     \r\n+    // Debug: İlk birkaç kullanıcıyı konsola yazdır\r\n+    error_log(\"Kullanıcı sayısı: \" . count($users));\r\n+    if (!empty($users)) {\r\n+        error_log(\"İlk kullanıcı: \" . print_r($users[0], true));\r\n+    }\r\n+    \r\n } catch (Exception $e) {\r\n     $users = [];\r\n     $error = \"Kullanıcılar alınırken hata: \" . $e->getMessage();\r\n+    error_log(\"Kullanıcı çekme hatası: \" . $e->getMessage());\r\n }\r\n \r\n // VoIP Numaralarını al\r\n try {\r\n@@ -169,11 +176,16 @@\n     <div class=\"row\">\r\n         <div class=\"col-12\">\r\n             <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                 <h2><i class=\"fas fa-exchange-alt me-2\"></i>VoIP Numara Teslim/İade</h2>\r\n-                <button class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#addTeslimModal\">\r\n-                    <i class=\"fas fa-plus me-1\"></i>Yeni Kayıt\r\n-                </button>\r\n+                <div>\r\n+                    <button class=\"btn btn-info me-2\" onclick=\"testModal()\">\r\n+                        <i class=\"fas fa-bug me-1\"></i>Test Modal\r\n+                    </button>\r\n+                    <button class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#addTeslimModal\">\r\n+                        <i class=\"fas fa-plus me-1\"></i>Yeni Kayıt\r\n+                    </button>\r\n+                </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n \r\n@@ -203,8 +215,9 @@\n     <?php elseif (!empty($users)): ?>\r\n         <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\">\r\n             <i class=\"fas fa-check-circle me-2\"></i>\r\n             Toplam <?php echo count($users); ?> kullanıcı yüklendi (status kısıtlaması kaldırıldı)\r\n+            <br><small>İlk kullanıcı örneği: <?php echo !empty($users) ? htmlspecialchars(($users[0]['first_name'] ?? 'NULL') . ' ' . ($users[0]['last_name'] ?? 'NULL')) : 'Yok'; ?></small>\r\n             <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n         </div>\r\n     <?php endif; ?>\r\n \r\n@@ -219,9 +232,9 @@\n             <form method=\"GET\" class=\"row g-3\">\r\n                 <div class=\"col-md-3\">\r\n                     <label class=\"form-label\">Kullanıcı</label>\r\n                     <select name=\"filter_user\" class=\"form-select\">\r\n-                        <option value=\"\">Tümü</option>\r\n+                        <option value=\"\">Tümü (<?php echo count($users); ?> kullanıcı)</option>\r\n                         <?php foreach ($users as $user): ?>\r\n                             <option value=\"<?php echo $user['id']; ?>\" <?php echo $filterUser == $user['id'] ? 'selected' : ''; ?>>\r\n                                 <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n                             </option>\r\n@@ -367,14 +380,26 @@\n                     <div class=\"mb-3\">\r\n                         <label for=\"voip_operator_users_id\" class=\"form-label\">Kullanıcı <span class=\"text-danger\">*</span></label>\r\n                         <select class=\"form-select\" id=\"voip_operator_users_id\" name=\"voip_operator_users_id\" required>\r\n                             <option value=\"\">Seçiniz... (<?php echo count($users); ?> kullanıcı mevcut)</option>\r\n-                            <?php foreach ($users as $user): ?>\r\n-                                <option value=\"<?php echo $user['id']; ?>\">\r\n-                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n-                                </option>\r\n+                            <?php if (empty($users)): ?>\r\n+                                <option disabled>Kullanıcı bulunamadı</option>\r\n+                            <?php else: ?>\r\n+                                <?php foreach ($users as $index => $user): ?>\r\n+                                    <option value=\"<?php echo htmlspecialchars($user['id']); ?>\">\r\n+                                        [<?php echo $index + 1; ?>] <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?> (ID: <?php echo $user['id']; ?>)\r\n+                                    </option>\r\n+                                <?php endforeach; ?>\r\n+                            <?php endif; ?>\r\n+                        </select>\r\n+                        <!-- Debug bilgisi -->\r\n+                        <small class=\"text-muted\">Debug: Array count = <?php echo count($users); ?>, Is array = <?php echo is_array($users) ? 'Yes' : 'No'; ?></small>\r\n+                        <!-- Raw debug -->\r\n+                        <div style=\"max-height: 100px; overflow-y: auto; font-size: 10px; background: #f8f9fa; padding: 5px; margin-top: 5px;\">\r\n+                            <?php foreach (array_slice($users, 0, 3) as $u): ?>\r\n+                                ID: <?php echo $u['id']; ?>, Ad: \"<?php echo $u['first_name']; ?>\", Soyad: \"<?php echo $u['last_name']; ?>\"<br>\r\n                             <?php endforeach; ?>\r\n-                        </select>\r\n+                        </div>\r\n                     </div>\r\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"voip_operator_numara_id\" class=\"form-label\">VoIP Numara <span class=\"text-danger\">*</span></label>\r\n@@ -441,14 +466,20 @@\n                     <div class=\"mb-3\">\r\n                         <label for=\"edit_voip_operator_users_id\" class=\"form-label\">Kullanıcı <span class=\"text-danger\">*</span></label>\r\n                         <select class=\"form-select\" id=\"edit_voip_operator_users_id\" name=\"voip_operator_users_id\" required>\r\n                             <option value=\"\">Seçiniz... (<?php echo count($users); ?> kullanıcı mevcut)</option>\r\n-                            <?php foreach ($users as $user): ?>\r\n-                                <option value=\"<?php echo $user['id']; ?>\">\r\n-                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n-                                </option>\r\n-                            <?php endforeach; ?>\r\n+                            <?php if (empty($users)): ?>\r\n+                                <option disabled>Kullanıcı bulunamadı</option>\r\n+                            <?php else: ?>\r\n+                                <?php foreach ($users as $user): ?>\r\n+                                    <option value=\"<?php echo htmlspecialchars($user['id']); ?>\">\r\n+                                        <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n+                                    </option>\r\n+                                <?php endforeach; ?>\r\n+                            <?php endif; ?>\r\n                         </select>\r\n+                        <!-- Debug bilgisi -->\r\n+                        <small class=\"text-muted\">Debug: Array count = <?php echo count($users); ?>, Is array = <?php echo is_array($users) ? 'Yes' : 'No'; ?></small>\r\n                     </div>\r\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"edit_voip_operator_numara_id\" class=\"form-label\">VoIP Numara <span class=\"text-danger\">*</span></label>\r\n@@ -522,8 +553,23 @@\n     </div>\r\n </div>\r\n \r\n <script>\r\n+function testModal() {\r\n+    const selectElement = document.getElementById('voip_operator_users_id');\r\n+    console.log('Select element:', selectElement);\r\n+    console.log('Options count:', selectElement ? selectElement.options.length : 'Select not found');\r\n+    \r\n+    if (selectElement) {\r\n+        console.log('Options:', Array.from(selectElement.options).map(opt => ({\r\n+            value: opt.value,\r\n+            text: opt.text\r\n+        })));\r\n+    }\r\n+    \r\n+    alert('Test tamamlandı - Console\\'u kontrol edin');\r\n+}\r\n+\r\n function editTeslim(record) {\r\n     // Modal formuna veri doldur\r\n     document.getElementById('edit_voip_operator_NoTeslim_id').value = record.voip_operator_NoTeslim_id;\r\n     document.getElementById('edit_voip_operator_users_id').value = record.voip_operator_users_id;\r\n@@ -543,25 +589,31 @@\n }\r\n \r\n // Select2 benzeri arama özelliği ekle\r\n $(document).ready(function() {\r\n+    console.log('Document ready - checking selects');\r\n+    \r\n     // Kullanıcı arama\r\n-    $('#voip_operator_users_id, #edit_voip_operator_users_id').select2 && $('#voip_operator_users_id, #edit_voip_operator_users_id').select2({\r\n-        placeholder: 'Kullanıcı ara...',\r\n-        allowClear: true\r\n-    });\r\n-    \r\n-    // Numara arama (multiselect için)\r\n-    $('#voip_operator_numara_id').select2 && $('#voip_operator_numara_id').select2({\r\n-        placeholder: 'Numara ara...',\r\n-        allowClear: true\r\n-    });\r\n-    \r\n-    // Tekli numara seçimi için\r\n-    $('#edit_voip_operator_numara_id').select2 && $('#edit_voip_operator_numara_id').select2({\r\n-        placeholder: 'Numara ara...',\r\n-        allowClear: true\r\n-    });\r\n+    if (typeof $.fn.select2 !== 'undefined') {\r\n+        $('#voip_operator_users_id, #edit_voip_operator_users_id').select2({\r\n+            placeholder: 'Kullanıcı ara...',\r\n+            allowClear: true\r\n+        });\r\n+        \r\n+        // Numara arama (multiselect için)\r\n+        $('#voip_operator_numara_id').select2({\r\n+            placeholder: 'Numara ara...',\r\n+            allowClear: true\r\n+        });\r\n+        \r\n+        // Tekli numara seçimi için\r\n+        $('#edit_voip_operator_numara_id').select2({\r\n+            placeholder: 'Numara ara...',\r\n+            allowClear: true\r\n+        });\r\n+    } else {\r\n+        console.log('Select2 library not loaded');\r\n+    }\r\n });\r\n </script>\r\n \r\n <!-- Select2 CSS ve JS (eğer yoksa) -->\r\n"
                },
                {
                    "date": 1760610399428,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -393,13 +393,15 @@\n                         </select>\r\n                         <!-- Debug bilgisi -->\r\n                         <small class=\"text-muted\">Debug: Array count = <?php echo count($users); ?>, Is array = <?php echo is_array($users) ? 'Yes' : 'No'; ?></small>\r\n                         <!-- Raw debug -->\r\n-                        <div style=\"max-height: 100px; overflow-y: auto; font-size: 10px; background: #f8f9fa; padding: 5px; margin-top: 5px;\">\r\n+                        <div style=\"max-height: 100px; overflow-y: auto; font-size: 10px; background: #f8f9fa; padding: 5px; margin-top: 5px; border: 1px solid #dee2e6;\">\r\n+                            <strong>İlk 3 kullanıcı:</strong><br>\r\n                             <?php foreach (array_slice($users, 0, 3) as $u): ?>\r\n-                                ID: <?php echo $u['id']; ?>, Ad: \"<?php echo $u['first_name']; ?>\", Soyad: \"<?php echo $u['last_name']; ?>\"<br>\r\n+                                ID: <?php echo $u['id']; ?>, Ad: \"<?php echo htmlspecialchars($u['first_name']); ?>\", Soyad: \"<?php echo htmlspecialchars($u['last_name']); ?>\"<br>\r\n                             <?php endforeach; ?>\r\n                         </div>\r\n+                        <button type=\"button\" class=\"btn btn-sm btn-warning mt-2\" onclick=\"testSelectContent()\">Test Select İçeriği</button>\r\n                     </div>\r\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"voip_operator_numara_id\" class=\"form-label\">VoIP Numara <span class=\"text-danger\">*</span></label>\r\n@@ -553,18 +555,47 @@\n     </div>\r\n </div>\r\n \r\n <script>\r\n+function testSelectContent() {\r\n+    const selectElement = document.getElementById('voip_operator_users_id');\r\n+    if (selectElement) {\r\n+        console.log('=== SELECT TEST ===');\r\n+        console.log('Element:', selectElement);\r\n+        console.log('Class list:', selectElement.classList.toString());\r\n+        console.log('Style display:', getComputedStyle(selectElement).display);\r\n+        console.log('Style visibility:', getComputedStyle(selectElement).visibility);\r\n+        console.log('innerHTML length:', selectElement.innerHTML.length);\r\n+        console.log('First 500 chars of innerHTML:', selectElement.innerHTML.substring(0, 500));\r\n+        \r\n+        // Manuel option testi\r\n+        for (let i = 0; i < Math.min(5, selectElement.options.length); i++) {\r\n+            console.log(`Option ${i}:`, {\r\n+                value: selectElement.options[i].value,\r\n+                text: selectElement.options[i].text,\r\n+                innerHTML: selectElement.options[i].innerHTML\r\n+            });\r\n+        }\r\n+    }\r\n+    alert('Select test bitti - console kontrol et');\r\n+}\r\n+\r\n function testModal() {\r\n     const selectElement = document.getElementById('voip_operator_users_id');\r\n     console.log('Select element:', selectElement);\r\n+    console.log('Select visible:', selectElement ? getComputedStyle(selectElement).display : 'not found');\r\n     console.log('Options count:', selectElement ? selectElement.options.length : 'Select not found');\r\n     \r\n     if (selectElement) {\r\n         console.log('Options:', Array.from(selectElement.options).map(opt => ({\r\n             value: opt.value,\r\n             text: opt.text\r\n         })));\r\n+        \r\n+        // Select2 container'ı kontrol et\r\n+        const select2Container = document.querySelector('.select2-container');\r\n+        console.log('Select2 container found:', !!select2Container);\r\n+        console.log('Select2 container visible:', select2Container ? getComputedStyle(select2Container).display : 'none');\r\n     }\r\n     \r\n     alert('Test tamamlandı - Console\\'u kontrol edin');\r\n }\r\n@@ -591,51 +622,57 @@\n // Select2 benzeri arama özelliği ekle\r\n $(document).ready(function() {\r\n     console.log('Document ready - checking selects');\r\n     \r\n-    // Kullanıcı arama\r\n+    // Select2 kütüphanesini devre dışı bırak ve basit dropdown kullan\r\n     if (typeof $.fn.select2 !== 'undefined') {\r\n-        $('#voip_operator_users_id, #edit_voip_operator_users_id').select2({\r\n-            placeholder: 'Kullanıcı ara...',\r\n-            allowClear: true\r\n-        });\r\n+        console.log('Select2 detected - destroying any existing instances');\r\n         \r\n-        // Numara arama (multiselect için)\r\n-        $('#voip_operator_numara_id').select2({\r\n-            placeholder: 'Numara ara...',\r\n-            allowClear: true\r\n-        });\r\n+        // Mevcut Select2 instance'larını temizle\r\n+        $('#voip_operator_users_id, #edit_voip_operator_users_id').select2('destroy');\r\n+        $('#voip_operator_numara_id').select2('destroy');\r\n+        $('#edit_voip_operator_numara_id').select2('destroy');\r\n         \r\n-        // Tekli numara seçimi için\r\n-        $('#edit_voip_operator_numara_id').select2({\r\n-            placeholder: 'Numara ara...',\r\n-            allowClear: true\r\n-        });\r\n-    } else {\r\n-        console.log('Select2 library not loaded');\r\n+        console.log('Select2 instances destroyed');\r\n     }\r\n+    \r\n+    // Manuel arama işlevi ekle\r\n+    $('select').on('focus', function() {\r\n+        console.log('Select focused:', this.id, 'Options:', this.options.length);\r\n+    });\r\n });\r\n </script>\r\n \r\n <!-- Select2 CSS ve JS (eğer yoksa) -->\r\n+<!-- Geçici olarak devre dışı \r\n <link href=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css\" rel=\"stylesheet\" />\r\n <script src=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js\"></script>\r\n+-->\r\n <style>\r\n-.select2-container--default .select2-selection--single {\r\n-    height: 38px;\r\n-    border: 1px solid #ced4da;\r\n-    border-radius: 0.375rem;\r\n+/* Select2 stillerini temizle */\r\n+.select2-hidden-accessible {\r\n+    display: block !important;\r\n+    position: static !important;\r\n+    width: auto !important;\r\n+    height: auto !important;\r\n }\r\n \r\n-.select2-container--default .select2-selection--single .select2-selection__rendered {\r\n-    line-height: 36px;\r\n-    padding-left: 12px;\r\n+.select2-container {\r\n+    display: none !important;\r\n }\r\n \r\n-.select2-container--default .select2-selection--multiple {\r\n+/* Basit select stilleri */\r\n+.form-select {\r\n+    background-color: #fff;\r\n     border: 1px solid #ced4da;\r\n     border-radius: 0.375rem;\r\n-    min-height: 38px;\r\n+    padding: 0.375rem 2.25rem 0.375rem 0.75rem;\r\n }\r\n+\r\n+.form-select:focus {\r\n+    border-color: #86b7fe;\r\n+    outline: 0;\r\n+    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);\r\n+}\r\n </style>\r\n \r\n <?php include 'includes/footer.php'; ?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1760611438279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,18 +87,11 @@\n     $userStmt = $conn->prepare($userSql);\r\n     $userStmt->execute();\r\n     $users = $userStmt->fetchAll(PDO::FETCH_ASSOC);\r\n     \r\n-    // Debug: İlk birkaç kullanıcıyı konsola yazdır\r\n-    error_log(\"Kullanıcı sayısı: \" . count($users));\r\n-    if (!empty($users)) {\r\n-        error_log(\"İlk kullanıcı: \" . print_r($users[0], true));\r\n-    }\r\n-    \r\n } catch (Exception $e) {\r\n     $users = [];\r\n     $error = \"Kullanıcılar alınırken hata: \" . $e->getMessage();\r\n-    error_log(\"Kullanıcı çekme hatası: \" . $e->getMessage());\r\n }\r\n \r\n // VoIP Numaralarını al\r\n try {\r\n@@ -176,16 +169,11 @@\n     <div class=\"row\">\r\n         <div class=\"col-12\">\r\n             <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                 <h2><i class=\"fas fa-exchange-alt me-2\"></i>VoIP Numara Teslim/İade</h2>\r\n-                <div>\r\n-                    <button class=\"btn btn-info me-2\" onclick=\"testModal()\">\r\n-                        <i class=\"fas fa-bug me-1\"></i>Test Modal\r\n-                    </button>\r\n-                    <button class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#addTeslimModal\">\r\n-                        <i class=\"fas fa-plus me-1\"></i>Yeni Kayıt\r\n-                    </button>\r\n-                </div>\r\n+                <button class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#addTeslimModal\">\r\n+                    <i class=\"fas fa-plus me-1\"></i>Yeni Kayıt\r\n+                </button>\r\n             </div>\r\n         </div>\r\n     </div>\r\n \r\n@@ -204,24 +192,8 @@\n             <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n         </div>\r\n     <?php endif; ?>\r\n \r\n-    <!-- Debug bilgisi -->\r\n-    <?php if (empty($users) && empty($error)): ?>\r\n-        <div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">\r\n-            <i class=\"fas fa-exclamation-triangle me-2\"></i>\r\n-            Kullanıcı listesi boş. Veritabanı bağlantısını kontrol edin.\r\n-            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n-        </div>\r\n-    <?php elseif (!empty($users)): ?>\r\n-        <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\">\r\n-            <i class=\"fas fa-check-circle me-2\"></i>\r\n-            Toplam <?php echo count($users); ?> kullanıcı yüklendi (status kısıtlaması kaldırıldı)\r\n-            <br><small>İlk kullanıcı örneği: <?php echo !empty($users) ? htmlspecialchars(($users[0]['first_name'] ?? 'NULL') . ' ' . ($users[0]['last_name'] ?? 'NULL')) : 'Yok'; ?></small>\r\n-            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n-        </div>\r\n-    <?php endif; ?>\r\n-\r\n     <!-- Filtreleme -->\r\n     <div class=\"card border-0 shadow-sm mb-4\">\r\n         <div class=\"card-header bg-light\">\r\n             <h5 class=\"mb-0\">\r\n@@ -232,9 +204,9 @@\n             <form method=\"GET\" class=\"row g-3\">\r\n                 <div class=\"col-md-3\">\r\n                     <label class=\"form-label\">Kullanıcı</label>\r\n                     <select name=\"filter_user\" class=\"form-select\">\r\n-                        <option value=\"\">Tümü (<?php echo count($users); ?> kullanıcı)</option>\r\n+                        <option value=\"\">Tümü</option>\r\n                         <?php foreach ($users as $user): ?>\r\n                             <option value=\"<?php echo $user['id']; ?>\" <?php echo $filterUser == $user['id'] ? 'selected' : ''; ?>>\r\n                                 <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n                             </option>\r\n@@ -379,45 +351,27 @@\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"voip_operator_users_id\" class=\"form-label\">Kullanıcı <span class=\"text-danger\">*</span></label>\r\n                         <select class=\"form-select\" id=\"voip_operator_users_id\" name=\"voip_operator_users_id\" required>\r\n-                            <option value=\"\">Seçiniz... (<?php echo count($users); ?> kullanıcı mevcut)</option>\r\n-                            <?php if (empty($users)): ?>\r\n-                                <option disabled>Kullanıcı bulunamadı</option>\r\n-                            <?php else: ?>\r\n-                                <?php foreach ($users as $index => $user): ?>\r\n-                                    <option value=\"<?php echo htmlspecialchars($user['id']); ?>\">\r\n-                                        [<?php echo $index + 1; ?>] <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?> (ID: <?php echo $user['id']; ?>)\r\n-                                    </option>\r\n-                                <?php endforeach; ?>\r\n-                            <?php endif; ?>\r\n+                            <option value=\"\">Seçiniz...</option>\r\n+                            <?php foreach ($users as $user): ?>\r\n+                                <option value=\"<?php echo htmlspecialchars($user['id']); ?>\">\r\n+                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n+                                </option>\r\n+                            <?php endforeach; ?>\r\n                         </select>\r\n-                        <!-- Debug bilgisi -->\r\n-                        <small class=\"text-muted\">Debug: Array count = <?php echo count($users); ?>, Is array = <?php echo is_array($users) ? 'Yes' : 'No'; ?></small>\r\n-                        <!-- Raw debug -->\r\n-                        <div style=\"max-height: 100px; overflow-y: auto; font-size: 10px; background: #f8f9fa; padding: 5px; margin-top: 5px; border: 1px solid #dee2e6;\">\r\n-                            <strong>İlk 3 kullanıcı:</strong><br>\r\n-                            <?php foreach (array_slice($users, 0, 3) as $u): ?>\r\n-                                ID: <?php echo $u['id']; ?>, Ad: \"<?php echo htmlspecialchars($u['first_name']); ?>\", Soyad: \"<?php echo htmlspecialchars($u['last_name']); ?>\"<br>\r\n-                            <?php endforeach; ?>\r\n-                        </div>\r\n-                        <button type=\"button\" class=\"btn btn-sm btn-warning mt-2\" onclick=\"testSelectContent()\">Test Select İçeriği</button>\r\n                     </div>\r\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"voip_operator_numara_id\" class=\"form-label\">VoIP Numara <span class=\"text-danger\">*</span></label>\r\n                         <select class=\"form-select\" id=\"voip_operator_numara_id\" name=\"voip_operator_numara_id[]\" multiple required style=\"height: 150px;\">\r\n-                            <?php if (empty($numeros)): ?>\r\n-                                <option disabled>Hiç VoIP numara bulunamadı</option>\r\n-                            <?php else: ?>\r\n-                                <?php foreach ($numeros as $numero): ?>\r\n-                                    <option value=\"<?php echo $numero['voip_operator_numara_id']; ?>\">\r\n-                                        <?php echo htmlspecialchars($numero['voip_operator_numara_VoIPNo'] . ' (' . $numero['voip_operator_adi'] . ')'); ?>\r\n-                                    </option>\r\n-                                <?php endforeach; ?>\r\n-                            <?php endif; ?>\r\n+                            <?php foreach ($numeros as $numero): ?>\r\n+                                <option value=\"<?php echo $numero['voip_operator_numara_id']; ?>\">\r\n+                                    <?php echo htmlspecialchars($numero['voip_operator_numara_VoIPNo'] . ' (' . $numero['voip_operator_adi'] . ')'); ?>\r\n+                                </option>\r\n+                            <?php endforeach; ?>\r\n                         </select>\r\n-                        <small class=\"form-text text-muted\">Birden fazla numara seçmek için Ctrl tuşuna basılı tutun. (<?php echo count($numeros); ?> numara)</small>\r\n+                        <small class=\"form-text text-muted\">Birden fazla numara seçmek için Ctrl tuşuna basılı tutun.</small>\r\n                     </div>\r\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"voip_operator_NoTeslim_Aciklama\" class=\"form-label\">Açıklama</label>\r\n@@ -467,21 +421,15 @@\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"edit_voip_operator_users_id\" class=\"form-label\">Kullanıcı <span class=\"text-danger\">*</span></label>\r\n                         <select class=\"form-select\" id=\"edit_voip_operator_users_id\" name=\"voip_operator_users_id\" required>\r\n-                            <option value=\"\">Seçiniz... (<?php echo count($users); ?> kullanıcı mevcut)</option>\r\n-                            <?php if (empty($users)): ?>\r\n-                                <option disabled>Kullanıcı bulunamadı</option>\r\n-                            <?php else: ?>\r\n-                                <?php foreach ($users as $user): ?>\r\n-                                    <option value=\"<?php echo htmlspecialchars($user['id']); ?>\">\r\n-                                        <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n-                                    </option>\r\n-                                <?php endforeach; ?>\r\n-                            <?php endif; ?>\r\n+                            <option value=\"\">Seçiniz...</option>\r\n+                            <?php foreach ($users as $user): ?>\r\n+                                <option value=\"<?php echo htmlspecialchars($user['id']); ?>\">\r\n+                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n+                                </option>\r\n+                            <?php endforeach; ?>\r\n                         </select>\r\n-                        <!-- Debug bilgisi -->\r\n-                        <small class=\"text-muted\">Debug: Array count = <?php echo count($users); ?>, Is array = <?php echo is_array($users) ? 'Yes' : 'No'; ?></small>\r\n                     </div>\r\n                     \r\n                     <div class=\"mb-3\">\r\n                         <label for=\"edit_voip_operator_numara_id\" class=\"form-label\">VoIP Numara <span class=\"text-danger\">*</span></label>\r\n@@ -555,52 +503,9 @@\n     </div>\r\n </div>\r\n \r\n <script>\r\n-function testSelectContent() {\r\n-    const selectElement = document.getElementById('voip_operator_users_id');\r\n-    if (selectElement) {\r\n-        console.log('=== SELECT TEST ===');\r\n-        console.log('Element:', selectElement);\r\n-        console.log('Class list:', selectElement.classList.toString());\r\n-        console.log('Style display:', getComputedStyle(selectElement).display);\r\n-        console.log('Style visibility:', getComputedStyle(selectElement).visibility);\r\n-        console.log('innerHTML length:', selectElement.innerHTML.length);\r\n-        console.log('First 500 chars of innerHTML:', selectElement.innerHTML.substring(0, 500));\r\n-        \r\n-        // Manuel option testi\r\n-        for (let i = 0; i < Math.min(5, selectElement.options.length); i++) {\r\n-            console.log(`Option ${i}:`, {\r\n-                value: selectElement.options[i].value,\r\n-                text: selectElement.options[i].text,\r\n-                innerHTML: selectElement.options[i].innerHTML\r\n-            });\r\n-        }\r\n-    }\r\n-    alert('Select test bitti - console kontrol et');\r\n-}\r\n-\r\n-function testModal() {\r\n-    const selectElement = document.getElementById('voip_operator_users_id');\r\n-    console.log('Select element:', selectElement);\r\n-    console.log('Select visible:', selectElement ? getComputedStyle(selectElement).display : 'not found');\r\n-    console.log('Options count:', selectElement ? selectElement.options.length : 'Select not found');\r\n-    \r\n-    if (selectElement) {\r\n-        console.log('Options:', Array.from(selectElement.options).map(opt => ({\r\n-            value: opt.value,\r\n-            text: opt.text\r\n-        })));\r\n-        \r\n-        // Select2 container'ı kontrol et\r\n-        const select2Container = document.querySelector('.select2-container');\r\n-        console.log('Select2 container found:', !!select2Container);\r\n-        console.log('Select2 container visible:', select2Container ? getComputedStyle(select2Container).display : 'none');\r\n-    }\r\n-    \r\n-    alert('Test tamamlandı - Console\\'u kontrol edin');\r\n-}\r\n-\r\n+<script>\r\n function editTeslim(record) {\r\n     // Modal formuna veri doldur\r\n     document.getElementById('edit_voip_operator_NoTeslim_id').value = record.voip_operator_NoTeslim_id;\r\n     document.getElementById('edit_voip_operator_users_id').value = record.voip_operator_users_id;\r\n@@ -617,50 +522,11 @@\n     document.getElementById('deleteTeslimId').value = id;\r\n     document.getElementById('deleteTeslimName').textContent = 'VoIP No: ' + voipNo;\r\n     new bootstrap.Modal(document.getElementById('deleteTeslimModal')).show();\r\n }\r\n-\r\n-// Select2 benzeri arama özelliği ekle\r\n-$(document).ready(function() {\r\n-    console.log('Document ready - checking selects');\r\n-    \r\n-    // Select2 kütüphanesini devre dışı bırak ve basit dropdown kullan\r\n-    if (typeof $.fn.select2 !== 'undefined') {\r\n-        console.log('Select2 detected - destroying any existing instances');\r\n-        \r\n-        // Mevcut Select2 instance'larını temizle\r\n-        $('#voip_operator_users_id, #edit_voip_operator_users_id').select2('destroy');\r\n-        $('#voip_operator_numara_id').select2('destroy');\r\n-        $('#edit_voip_operator_numara_id').select2('destroy');\r\n-        \r\n-        console.log('Select2 instances destroyed');\r\n-    }\r\n-    \r\n-    // Manuel arama işlevi ekle\r\n-    $('select').on('focus', function() {\r\n-        console.log('Select focused:', this.id, 'Options:', this.options.length);\r\n-    });\r\n-});\r\n </script>\r\n \r\n-<!-- Select2 CSS ve JS (eğer yoksa) -->\r\n-<!-- Geçici olarak devre dışı \r\n-<link href=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css\" rel=\"stylesheet\" />\r\n-<script src=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js\"></script>\r\n--->\r\n <style>\r\n-/* Select2 stillerini temizle */\r\n-.select2-hidden-accessible {\r\n-    display: block !important;\r\n-    position: static !important;\r\n-    width: auto !important;\r\n-    height: auto !important;\r\n-}\r\n-\r\n-.select2-container {\r\n-    display: none !important;\r\n-}\r\n-\r\n /* Basit select stilleri */\r\n .form-select {\r\n     background-color: #fff;\r\n     border: 1px solid #ced4da;\r\n"
                },
                {
                    "date": 1761031785104,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -503,9 +503,8 @@\n     </div>\r\n </div>\r\n \r\n <script>\r\n-<script>\r\n function editTeslim(record) {\r\n     // Modal formuna veri doldur\r\n     document.getElementById('edit_voip_operator_NoTeslim_id').value = record.voip_operator_NoTeslim_id;\r\n     document.getElementById('edit_voip_operator_users_id').value = record.voip_operator_users_id;\r\n"
                }
            ],
            "date": 1760609804958,
            "name": "Commit-0",
            "content": "<?php\r\n$pageTitle = \"VoIP Numara Teslim/İade\";\r\n$breadcrumbs = [\r\n    ['title' => 'Yönetim', 'url' => 'index.php'],\r\n    ['title' => 'VoIP', 'url' => '#'],\r\n    ['title' => 'VoIP Numara Teslim/İade']\r\n];\r\n\r\n// Auth kontrol\r\nrequire_once 'auth.php';\r\n$currentUser = checkAdminAuth(); // Sadece admin erişebilir\r\n\r\n$message = '';\r\n$messageType = '';\r\n\r\n// VoIP Numara Teslim/İade işlemleri\r\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n    try {\r\n        $conn = getDatabaseConnection();\r\n        \r\n        $action = $_POST['action'] ?? '';\r\n        \r\n        switch ($action) {\r\n            case 'add':\r\n                $userId = (int)$_POST['voip_operator_users_id'];\r\n                $numeroIds = $_POST['voip_operator_numara_id'] ?? [];\r\n                $aciklama = trim($_POST['voip_operator_NoTeslim_Aciklama']);\r\n                $teslimTarihi = $_POST['voip_operator_NoTeslim_TeslimTarihi'] ? $_POST['voip_operator_NoTeslim_TeslimTarihi'] : null;\r\n                $iadeTarihi = $_POST['voip_operator_NoTeslim_IadeTarihi'] ? $_POST['voip_operator_NoTeslim_IadeTarihi'] : null;\r\n                \r\n                // Çoklu numara ekleme\r\n                foreach ($numeroIds as $numeroId) {\r\n                    $sql = \"INSERT INTO voip_operator_NoTeslim \r\n                            (voip_operator_users_id, voip_operator_numara_id, voip_operator_NoTeslim_Aciklama, \r\n                             voip_operator_NoTeslim_TeslimTarihi, voip_operator_NoTeslim_IadeTarihi) \r\n                            VALUES (?, ?, ?, ?, ?)\";\r\n                    $stmt = $conn->prepare($sql);\r\n                    $stmt->execute([$userId, $numeroId, $aciklama, $teslimTarihi, $iadeTarihi]);\r\n                }\r\n                \r\n                $message = 'VoIP Numara Teslim/İade kaydı başarıyla eklendi.';\r\n                $messageType = 'success';\r\n                break;\r\n                \r\n            case 'edit':\r\n                $id = (int)$_POST['voip_operator_NoTeslim_id'];\r\n                $userId = (int)$_POST['voip_operator_users_id'];\r\n                $numeroId = (int)$_POST['voip_operator_numara_id'];\r\n                $aciklama = trim($_POST['voip_operator_NoTeslim_Aciklama']);\r\n                $teslimTarihi = $_POST['voip_operator_NoTeslim_TeslimTarihi'] ? $_POST['voip_operator_NoTeslim_TeslimTarihi'] : null;\r\n                $iadeTarihi = $_POST['voip_operator_NoTeslim_IadeTarihi'] ? $_POST['voip_operator_NoTeslim_IadeTarihi'] : null;\r\n                \r\n                $sql = \"UPDATE voip_operator_NoTeslim SET \r\n                        voip_operator_users_id = ?, voip_operator_numara_id = ?, \r\n                        voip_operator_NoTeslim_Aciklama = ?, voip_operator_NoTeslim_TeslimTarihi = ?, \r\n                        voip_operator_NoTeslim_IadeTarihi = ? \r\n                        WHERE voip_operator_NoTeslim_id = ?\";\r\n                $stmt = $conn->prepare($sql);\r\n                $stmt->execute([$userId, $numeroId, $aciklama, $teslimTarihi, $iadeTarihi, $id]);\r\n                \r\n                $message = 'VoIP Numara Teslim/İade kaydı başarıyla güncellendi.';\r\n                $messageType = 'success';\r\n                break;\r\n                \r\n            case 'delete':\r\n                $id = (int)$_POST['id'];\r\n                \r\n                $sql = \"DELETE FROM voip_operator_NoTeslim WHERE voip_operator_NoTeslim_id = ?\";\r\n                $stmt = $conn->prepare($sql);\r\n                $stmt->execute([$id]);\r\n                \r\n                $message = 'VoIP Numara Teslim/İade kaydı başarıyla silindi.';\r\n                $messageType = 'success';\r\n                break;\r\n        }\r\n    } catch (Exception $e) {\r\n        $message = 'Hata: ' . $e->getMessage();\r\n        $messageType = 'danger';\r\n    }\r\n}\r\n\r\n// Kullanıcıları al (tüm kullanıcılar, status kontrolü yok)\r\ntry {\r\n    $conn = getDatabaseConnection();\r\n    \r\n    $userSql = \"SELECT id, first_name, last_name FROM users ORDER BY first_name, last_name\";\r\n    $userStmt = $conn->prepare($userSql);\r\n    $userStmt->execute();\r\n    $users = $userStmt->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n} catch (Exception $e) {\r\n    $users = [];\r\n    $error = \"Kullanıcılar alınırken hata: \" . $e->getMessage();\r\n}\r\n\r\n// VoIP Numaralarını al\r\ntry {\r\n    $conn = getDatabaseConnection();\r\n    \r\n    $numeroSql = \"SELECT n.voip_operator_numara_id, n.voip_operator_numara_VoIPNo, o.voip_operator_adi \r\n                  FROM voip_operator_numara n \r\n                  LEFT JOIN voip_operator_tanim o ON n.voip_operator_tanim_id = o.voip_operator_id\r\n                  WHERE n.voip_operator_numara_durum = 1 \r\n                  ORDER BY o.voip_operator_adi, n.voip_operator_numara_VoIPNo\";\r\n    $numeroStmt = $conn->prepare($numeroSql);\r\n    $numeroStmt->execute();\r\n    $numeros = $numeroStmt->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n} catch (Exception $e) {\r\n    $numeros = [];\r\n    if (!isset($error)) $error = \"\";\r\n    $error .= \" VoIP numaralar alınırken hata: \" . $e->getMessage();\r\n}\r\n\r\n// Filtreleme parametrelerini al\r\n$filterUser = $_GET['filter_user'] ?? '';\r\n$filterNumero = $_GET['filter_numero'] ?? '';\r\n$filterTeslim = $_GET['filter_teslim'] ?? '';\r\n\r\n// VoIP Numara Teslim/İade kayıtlarını listele\r\n$teslimRecords = [];\r\n$error = '';\r\ntry {\r\n    $conn = getDatabaseConnection();\r\n    \r\n    $whereConditions = [];\r\n    $params = [];\r\n    \r\n    if ($filterUser) {\r\n        $whereConditions[] = \"nt.voip_operator_users_id = ?\";\r\n        $params[] = $filterUser;\r\n    }\r\n    \r\n    if ($filterNumero) {\r\n        $whereConditions[] = \"nt.voip_operator_numara_id = ?\";\r\n        $params[] = $filterNumero;\r\n    }\r\n    \r\n    if ($filterTeslim === 'teslim') {\r\n        $whereConditions[] = \"nt.voip_operator_NoTeslim_TeslimTarihi IS NOT NULL AND nt.voip_operator_NoTeslim_IadeTarihi IS NULL\";\r\n    } elseif ($filterTeslim === 'iade') {\r\n        $whereConditions[] = \"nt.voip_operator_NoTeslim_IadeTarihi IS NOT NULL\";\r\n    }\r\n    \r\n    $whereClause = !empty($whereConditions) ? 'WHERE ' . implode(' AND ', $whereConditions) : '';\r\n    \r\n    $sql = \"SELECT nt.*, \r\n                   u.first_name, u.last_name,\r\n                   n.voip_operator_numara_VoIPNo,\r\n                   o.voip_operator_adi\r\n            FROM voip_operator_NoTeslim nt \r\n            LEFT JOIN users u ON nt.voip_operator_users_id = u.id\r\n            LEFT JOIN voip_operator_numara n ON nt.voip_operator_numara_id = n.voip_operator_numara_id\r\n            LEFT JOIN voip_operator_tanim o ON n.voip_operator_tanim_id = o.voip_operator_id\r\n            $whereClause\r\n            ORDER BY nt.voip_operator_NoTeslim_TeslimTarihi DESC, nt.voip_operator_NoTeslim_id DESC\";\r\n    $stmt = $conn->prepare($sql);\r\n    $stmt->execute($params);\r\n    $teslimRecords = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n} catch (Exception $e) {\r\n    $error = \"Veritabanı hatası: \" . $e->getMessage();\r\n}\r\n\r\ninclude 'includes/header.php';\r\n?>\r\n\r\n<div class=\"container-fluid mt-4\">\r\n    <div class=\"row\">\r\n        <div class=\"col-12\">\r\n            <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                <h2><i class=\"fas fa-exchange-alt me-2\"></i>VoIP Numara Teslim/İade</h2>\r\n                <button class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#addTeslimModal\">\r\n                    <i class=\"fas fa-plus me-1\"></i>Yeni Kayıt\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <?php if ($message): ?>\r\n        <div class=\"alert alert-<?php echo $messageType; ?> alert-dismissible fade show\" role=\"alert\">\r\n            <i class=\"fas fa-<?php echo $messageType === 'success' ? 'check-circle' : 'exclamation-triangle'; ?> me-2\"></i>\r\n            <?php echo htmlspecialchars($message); ?>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n        </div>\r\n    <?php endif; ?>\r\n\r\n    <?php if ($error): ?>\r\n        <div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">\r\n            <i class=\"fas fa-exclamation-triangle me-2\"></i>\r\n            <?php echo htmlspecialchars($error); ?>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n        </div>\r\n    <?php endif; ?>\r\n\r\n    <!-- Debug bilgisi -->\r\n    <?php if (empty($users) && empty($error)): ?>\r\n        <div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">\r\n            <i class=\"fas fa-exclamation-triangle me-2\"></i>\r\n            Kullanıcı listesi boş. Veritabanı bağlantısını kontrol edin.\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n        </div>\r\n    <?php elseif (!empty($users)): ?>\r\n        <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\">\r\n            <i class=\"fas fa-check-circle me-2\"></i>\r\n            Toplam <?php echo count($users); ?> kullanıcı yüklendi (status kısıtlaması kaldırıldı)\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n        </div>\r\n    <?php endif; ?>\r\n\r\n    <!-- Filtreleme -->\r\n    <div class=\"card border-0 shadow-sm mb-4\">\r\n        <div class=\"card-header bg-light\">\r\n            <h5 class=\"mb-0\">\r\n                <i class=\"fas fa-filter me-2\"></i>Filtreleme\r\n            </h5>\r\n        </div>\r\n        <div class=\"card-body\">\r\n            <form method=\"GET\" class=\"row g-3\">\r\n                <div class=\"col-md-3\">\r\n                    <label class=\"form-label\">Kullanıcı</label>\r\n                    <select name=\"filter_user\" class=\"form-select\">\r\n                        <option value=\"\">Tümü</option>\r\n                        <?php foreach ($users as $user): ?>\r\n                            <option value=\"<?php echo $user['id']; ?>\" <?php echo $filterUser == $user['id'] ? 'selected' : ''; ?>>\r\n                                <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n                            </option>\r\n                        <?php endforeach; ?>\r\n                    </select>\r\n                </div>\r\n                <div class=\"col-md-3\">\r\n                    <label class=\"form-label\">Numara</label>\r\n                    <select name=\"filter_numero\" class=\"form-select\">\r\n                        <option value=\"\">Tümü</option>\r\n                        <?php foreach ($numeros as $numero): ?>\r\n                            <option value=\"<?php echo $numero['voip_operator_numara_id']; ?>\" <?php echo $filterNumero == $numero['voip_operator_numara_id'] ? 'selected' : ''; ?>>\r\n                                <?php echo htmlspecialchars($numero['voip_operator_numara_VoIPNo'] . ' (' . $numero['voip_operator_adi'] . ')'); ?>\r\n                            </option>\r\n                        <?php endforeach; ?>\r\n                    </select>\r\n                </div>\r\n                <div class=\"col-md-3\">\r\n                    <label class=\"form-label\">Durum</label>\r\n                    <select name=\"filter_teslim\" class=\"form-select\">\r\n                        <option value=\"\">Tümü</option>\r\n                        <option value=\"teslim\" <?php echo $filterTeslim === 'teslim' ? 'selected' : ''; ?>>Teslim Edilen</option>\r\n                        <option value=\"iade\" <?php echo $filterTeslim === 'iade' ? 'selected' : ''; ?>>İade Edilen</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"col-md-2\">\r\n                    <label class=\"form-label\">&nbsp;</label>\r\n                    <div class=\"d-grid\">\r\n                        <button type=\"submit\" class=\"btn btn-primary\">\r\n                            <i class=\"fas fa-search me-1\"></i>Filtrele\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"col-md-1\">\r\n                    <label class=\"form-label\">&nbsp;</label>\r\n                    <div class=\"d-grid\">\r\n                        <a href=\"voip_operator_noteslim.php\" class=\"btn btn-outline-secondary\">\r\n                            <i class=\"fas fa-times\"></i>\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- VoIP Numara Teslim/İade Tablosu -->\r\n    <div class=\"card border-0 shadow-sm\">\r\n        <div class=\"card-header bg-primary text-white\">\r\n            <h5 class=\"mb-0\">\r\n                <i class=\"fas fa-list me-2\"></i>Teslim/İade Kayıt Listesi\r\n            </h5>\r\n        </div>\r\n        <div class=\"card-body p-0\">\r\n            <div class=\"table-responsive\">\r\n                <table class=\"table table-hover mb-0\">\r\n                    <thead class=\"table-light\">\r\n                        <tr>\r\n                            <th>ID</th>\r\n                            <th>Kullanıcı</th>\r\n                            <th>VoIP Numara</th>\r\n                            <th>Operatör</th>\r\n                            <th>Açıklama</th>\r\n                            <th>Teslim Tarihi</th>\r\n                            <th>İade Tarihi</th>\r\n                            <th>Durum</th>\r\n                            <th>İşlemler</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <?php if (!empty($teslimRecords)): ?>\r\n                            <?php foreach ($teslimRecords as $record): ?>\r\n                                <tr>\r\n                                    <td><?php echo $record['voip_operator_NoTeslim_id']; ?></td>\r\n                                    <td>\r\n                                        <strong><?php echo htmlspecialchars(($record['first_name'] ?? '') . ' ' . ($record['last_name'] ?? '')); ?></strong>\r\n                                    </td>\r\n                                    <td>\r\n                                        <code><?php echo htmlspecialchars($record['voip_operator_numara_VoIPNo'] ?? ''); ?></code>\r\n                                    </td>\r\n                                    <td><?php echo htmlspecialchars($record['voip_operator_adi'] ?? '-'); ?></td>\r\n                                    <td><?php echo htmlspecialchars($record['voip_operator_NoTeslim_Aciklama'] ?? '-'); ?></td>\r\n                                    <td>\r\n                                        <?php echo $record['voip_operator_NoTeslim_TeslimTarihi'] ? date('d.m.Y', strtotime($record['voip_operator_NoTeslim_TeslimTarihi'])) : '-'; ?>\r\n                                    </td>\r\n                                    <td>\r\n                                        <?php echo $record['voip_operator_NoTeslim_IadeTarihi'] ? date('d.m.Y', strtotime($record['voip_operator_NoTeslim_IadeTarihi'])) : '-'; ?>\r\n                                    </td>\r\n                                    <td>\r\n                                        <?php \r\n                                        if ($record['voip_operator_NoTeslim_IadeTarihi']) {\r\n                                            echo '<span class=\"badge bg-warning\">İade Edildi</span>';\r\n                                        } elseif ($record['voip_operator_NoTeslim_TeslimTarihi']) {\r\n                                            echo '<span class=\"badge bg-success\">Teslim Edildi</span>';\r\n                                        } else {\r\n                                            echo '<span class=\"badge bg-secondary\">Belirsiz</span>';\r\n                                        }\r\n                                        ?>\r\n                                    </td>\r\n                                    <td>\r\n                                        <div class=\"btn-group\" role=\"group\">\r\n                                            <button type=\"button\" class=\"btn btn-sm btn-outline-primary\" \r\n                                                    onclick=\"editTeslim(<?php echo htmlspecialchars(json_encode($record)); ?>)\">\r\n                                                <i class=\"fas fa-edit\"></i>\r\n                                            </button>\r\n                                            <button type=\"button\" class=\"btn btn-sm btn-outline-danger\" \r\n                                                    onclick=\"deleteTeslim(<?php echo $record['voip_operator_NoTeslim_id']; ?>, '<?php echo htmlspecialchars($record['voip_operator_numara_VoIPNo']); ?>')\">\r\n                                                <i class=\"fas fa-trash\"></i>\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            <?php endforeach; ?>\r\n                        <?php else: ?>\r\n                            <tr>\r\n                                <td colspan=\"9\" class=\"text-center py-5 text-muted\">\r\n                                    <i class=\"fas fa-exchange-alt fa-3x mb-3 d-block\"></i>\r\n                                    <h5>Henüz teslim/iade kaydı bulunmuyor</h5>\r\n                                    <p>İlk kaydı eklemek için \"Yeni Kayıt\" butonuna tıklayın.</p>\r\n                                </td>\r\n                            </tr>\r\n                        <?php endif; ?>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- Yeni Teslim/İade Ekleme Modal -->\r\n<div class=\"modal fade\" id=\"addTeslimModal\" tabindex=\"-1\" aria-labelledby=\"addTeslimModalLabel\" aria-hidden=\"true\">\r\n    <div class=\"modal-dialog modal-lg\">\r\n        <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n                <h5 class=\"modal-title\" id=\"addTeslimModalLabel\">\r\n                    <i class=\"fas fa-plus me-2\"></i>Yeni Teslim/İade Kaydı Ekle\r\n                </h5>\r\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n            </div>\r\n            <form method=\"POST\">\r\n                <div class=\"modal-body\">\r\n                    <input type=\"hidden\" name=\"action\" value=\"add\">\r\n                    \r\n                    <div class=\"mb-3\">\r\n                        <label for=\"voip_operator_users_id\" class=\"form-label\">Kullanıcı <span class=\"text-danger\">*</span></label>\r\n                        <select class=\"form-select\" id=\"voip_operator_users_id\" name=\"voip_operator_users_id\" required>\r\n                            <option value=\"\">Seçiniz... (<?php echo count($users); ?> kullanıcı mevcut)</option>\r\n                            <?php foreach ($users as $user): ?>\r\n                                <option value=\"<?php echo $user['id']; ?>\">\r\n                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n                                </option>\r\n                            <?php endforeach; ?>\r\n                        </select>\r\n                    </div>\r\n                    \r\n                    <div class=\"mb-3\">\r\n                        <label for=\"voip_operator_numara_id\" class=\"form-label\">VoIP Numara <span class=\"text-danger\">*</span></label>\r\n                        <select class=\"form-select\" id=\"voip_operator_numara_id\" name=\"voip_operator_numara_id[]\" multiple required style=\"height: 150px;\">\r\n                            <?php if (empty($numeros)): ?>\r\n                                <option disabled>Hiç VoIP numara bulunamadı</option>\r\n                            <?php else: ?>\r\n                                <?php foreach ($numeros as $numero): ?>\r\n                                    <option value=\"<?php echo $numero['voip_operator_numara_id']; ?>\">\r\n                                        <?php echo htmlspecialchars($numero['voip_operator_numara_VoIPNo'] . ' (' . $numero['voip_operator_adi'] . ')'); ?>\r\n                                    </option>\r\n                                <?php endforeach; ?>\r\n                            <?php endif; ?>\r\n                        </select>\r\n                        <small class=\"form-text text-muted\">Birden fazla numara seçmek için Ctrl tuşuna basılı tutun. (<?php echo count($numeros); ?> numara)</small>\r\n                    </div>\r\n                    \r\n                    <div class=\"mb-3\">\r\n                        <label for=\"voip_operator_NoTeslim_Aciklama\" class=\"form-label\">Açıklama</label>\r\n                        <textarea class=\"form-control\" id=\"voip_operator_NoTeslim_Aciklama\" name=\"voip_operator_NoTeslim_Aciklama\" rows=\"3\"></textarea>\r\n                    </div>\r\n                    \r\n                    <div class=\"row\">\r\n                        <div class=\"col-md-6\">\r\n                            <div class=\"mb-3\">\r\n                                <label for=\"voip_operator_NoTeslim_TeslimTarihi\" class=\"form-label\">Teslim Tarihi</label>\r\n                                <input type=\"date\" class=\"form-control\" id=\"voip_operator_NoTeslim_TeslimTarihi\" name=\"voip_operator_NoTeslim_TeslimTarihi\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"col-md-6\">\r\n                            <div class=\"mb-3\">\r\n                                <label for=\"voip_operator_NoTeslim_IadeTarihi\" class=\"form-label\">İade Tarihi</label>\r\n                                <input type=\"date\" class=\"form-control\" id=\"voip_operator_NoTeslim_IadeTarihi\" name=\"voip_operator_NoTeslim_IadeTarihi\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"modal-footer\">\r\n                    <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">İptal</button>\r\n                    <button type=\"submit\" class=\"btn btn-primary\">\r\n                        <i class=\"fas fa-save me-1\"></i>Kaydet\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- Teslim/İade Düzenleme Modal -->\r\n<div class=\"modal fade\" id=\"editTeslimModal\" tabindex=\"-1\" aria-labelledby=\"editTeslimModalLabel\" aria-hidden=\"true\">\r\n    <div class=\"modal-dialog modal-lg\">\r\n        <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n                <h5 class=\"modal-title\" id=\"editTeslimModalLabel\">\r\n                    <i class=\"fas fa-edit me-2\"></i>Teslim/İade Kaydı Düzenle\r\n                </h5>\r\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n            </div>\r\n            <form method=\"POST\" id=\"editTeslimForm\">\r\n                <div class=\"modal-body\">\r\n                    <input type=\"hidden\" name=\"action\" value=\"edit\">\r\n                    <input type=\"hidden\" name=\"voip_operator_NoTeslim_id\" id=\"edit_voip_operator_NoTeslim_id\">\r\n                    \r\n                    <div class=\"mb-3\">\r\n                        <label for=\"edit_voip_operator_users_id\" class=\"form-label\">Kullanıcı <span class=\"text-danger\">*</span></label>\r\n                        <select class=\"form-select\" id=\"edit_voip_operator_users_id\" name=\"voip_operator_users_id\" required>\r\n                            <option value=\"\">Seçiniz... (<?php echo count($users); ?> kullanıcı mevcut)</option>\r\n                            <?php foreach ($users as $user): ?>\r\n                                <option value=\"<?php echo $user['id']; ?>\">\r\n                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?>\r\n                                </option>\r\n                            <?php endforeach; ?>\r\n                        </select>\r\n                    </div>\r\n                    \r\n                    <div class=\"mb-3\">\r\n                        <label for=\"edit_voip_operator_numara_id\" class=\"form-label\">VoIP Numara <span class=\"text-danger\">*</span></label>\r\n                        <select class=\"form-select\" id=\"edit_voip_operator_numara_id\" name=\"voip_operator_numara_id\" required>\r\n                            <option value=\"\">Seçiniz...</option>\r\n                            <?php foreach ($numeros as $numero): ?>\r\n                                <option value=\"<?php echo $numero['voip_operator_numara_id']; ?>\">\r\n                                    <?php echo htmlspecialchars($numero['voip_operator_numara_VoIPNo'] . ' (' . $numero['voip_operator_adi'] . ')'); ?>\r\n                                </option>\r\n                            <?php endforeach; ?>\r\n                        </select>\r\n                    </div>\r\n                    \r\n                    <div class=\"mb-3\">\r\n                        <label for=\"edit_voip_operator_NoTeslim_Aciklama\" class=\"form-label\">Açıklama</label>\r\n                        <textarea class=\"form-control\" id=\"edit_voip_operator_NoTeslim_Aciklama\" name=\"voip_operator_NoTeslim_Aciklama\" rows=\"3\"></textarea>\r\n                    </div>\r\n                    \r\n                    <div class=\"row\">\r\n                        <div class=\"col-md-6\">\r\n                            <div class=\"mb-3\">\r\n                                <label for=\"edit_voip_operator_NoTeslim_TeslimTarihi\" class=\"form-label\">Teslim Tarihi</label>\r\n                                <input type=\"date\" class=\"form-control\" id=\"edit_voip_operator_NoTeslim_TeslimTarihi\" name=\"voip_operator_NoTeslim_TeslimTarihi\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"col-md-6\">\r\n                            <div class=\"mb-3\">\r\n                                <label for=\"edit_voip_operator_NoTeslim_IadeTarihi\" class=\"form-label\">İade Tarihi</label>\r\n                                <input type=\"date\" class=\"form-control\" id=\"edit_voip_operator_NoTeslim_IadeTarihi\" name=\"voip_operator_NoTeslim_IadeTarihi\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"modal-footer\">\r\n                    <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">İptal</button>\r\n                    <button type=\"submit\" class=\"btn btn-primary\">\r\n                        <i class=\"fas fa-save me-1\"></i>Güncelle\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- Silme Onay Modal -->\r\n<div class=\"modal fade\" id=\"deleteTeslimModal\" tabindex=\"-1\" aria-labelledby=\"deleteTeslimModalLabel\" aria-hidden=\"true\">\r\n    <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n                <h5 class=\"modal-title\" id=\"deleteTeslimModalLabel\">\r\n                    <i class=\"fas fa-trash me-2\"></i>Kayıt Sil\r\n                </h5>\r\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n                <p>Bu teslim/iade kaydını silmek istediğinizden emin misiniz?</p>\r\n                <p><strong id=\"deleteTeslimName\"></strong></p>\r\n                <p class=\"text-danger\"><small>Bu işlem geri alınamaz!</small></p>\r\n            </div>\r\n            <div class=\"modal-footer\">\r\n                <form method=\"POST\" id=\"deleteTeslimForm\">\r\n                    <input type=\"hidden\" name=\"action\" value=\"delete\">\r\n                    <input type=\"hidden\" name=\"id\" id=\"deleteTeslimId\">\r\n                    <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">İptal</button>\r\n                    <button type=\"submit\" class=\"btn btn-danger\">\r\n                        <i class=\"fas fa-trash me-1\"></i>Sil\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script>\r\nfunction editTeslim(record) {\r\n    // Modal formuna veri doldur\r\n    document.getElementById('edit_voip_operator_NoTeslim_id').value = record.voip_operator_NoTeslim_id;\r\n    document.getElementById('edit_voip_operator_users_id').value = record.voip_operator_users_id;\r\n    document.getElementById('edit_voip_operator_numara_id').value = record.voip_operator_numara_id;\r\n    document.getElementById('edit_voip_operator_NoTeslim_Aciklama').value = record.voip_operator_NoTeslim_Aciklama || '';\r\n    document.getElementById('edit_voip_operator_NoTeslim_TeslimTarihi').value = record.voip_operator_NoTeslim_TeslimTarihi || '';\r\n    document.getElementById('edit_voip_operator_NoTeslim_IadeTarihi').value = record.voip_operator_NoTeslim_IadeTarihi || '';\r\n    \r\n    // Modal'ı aç\r\n    new bootstrap.Modal(document.getElementById('editTeslimModal')).show();\r\n}\r\n\r\nfunction deleteTeslim(id, voipNo) {\r\n    document.getElementById('deleteTeslimId').value = id;\r\n    document.getElementById('deleteTeslimName').textContent = 'VoIP No: ' + voipNo;\r\n    new bootstrap.Modal(document.getElementById('deleteTeslimModal')).show();\r\n}\r\n\r\n// Select2 benzeri arama özelliği ekle\r\n$(document).ready(function() {\r\n    // Kullanıcı arama\r\n    $('#voip_operator_users_id, #edit_voip_operator_users_id').select2 && $('#voip_operator_users_id, #edit_voip_operator_users_id').select2({\r\n        placeholder: 'Kullanıcı ara...',\r\n        allowClear: true\r\n    });\r\n    \r\n    // Numara arama (multiselect için)\r\n    $('#voip_operator_numara_id').select2 && $('#voip_operator_numara_id').select2({\r\n        placeholder: 'Numara ara...',\r\n        allowClear: true\r\n    });\r\n    \r\n    // Tekli numara seçimi için\r\n    $('#edit_voip_operator_numara_id').select2 && $('#edit_voip_operator_numara_id').select2({\r\n        placeholder: 'Numara ara...',\r\n        allowClear: true\r\n    });\r\n});\r\n</script>\r\n\r\n<!-- Select2 CSS ve JS (eğer yoksa) -->\r\n<link href=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css\" rel=\"stylesheet\" />\r\n<script src=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js\"></script>\r\n<style>\r\n.select2-container--default .select2-selection--single {\r\n    height: 38px;\r\n    border: 1px solid #ced4da;\r\n    border-radius: 0.375rem;\r\n}\r\n\r\n.select2-container--default .select2-selection--single .select2-selection__rendered {\r\n    line-height: 36px;\r\n    padding-left: 12px;\r\n}\r\n\r\n.select2-container--default .select2-selection--multiple {\r\n    border: 1px solid #ced4da;\r\n    border-radius: 0.375rem;\r\n    min-height: 38px;\r\n}\r\n</style>\r\n\r\n<?php include 'includes/footer.php'; ?>"
        }
    ]
}