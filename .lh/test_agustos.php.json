{
    "sourceFile": "test_agustos.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759315823328,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759315823328,
            "name": "Commit-0",
            "content": "<?php\r\n// AĞUSTOS veritabanı kontrolü\r\n$config = include 'config/mssql.php';\r\n$server = $config['host'];\r\n$database = $config['database'];\r\n$username = $config['username'];\r\n$password = $config['password'];\r\n\r\necho \"<h2>Veritabanı Bağlantı Testi</h2>\";\r\necho \"<p><strong>Server:</strong> $server</p>\";\r\necho \"<p><strong>Database:</strong> $database</p>\";\r\necho \"<p><strong>Username:</strong> $username</p>\";\r\necho \"<hr>\";\r\n\r\ntry {\r\n    // Farklı bağlantı yöntemlerini dene\r\n    $connectionStrings = [\r\n        // Windows Authentication\r\n        \"sqlsrv:server=localhost\\\\SQLEXPRESS;database=$database;TrustServerCertificate=yes\",\r\n        // SQL Server Authentication\r\n        \"sqlsrv:server=localhost\\\\SQLEXPRESS;database=$database;TrustServerCertificate=yes;UID=$username;PWD=$password\",\r\n        \"sqlsrv:server=(local)\\\\SQLEXPRESS;database=$database;TrustServerCertificate=yes\",\r\n        \"sqlsrv:server=.\\\\SQLEXPRESS;database=$database;TrustServerCertificate=yes\"\r\n    ];\r\n    \r\n    $authOptions = [\r\n        // Windows Authentication\r\n        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION, PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8],\r\n        // SQL Server Authentication\r\n        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION, PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8],\r\n        // Windows Authentication\r\n        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION, PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8],\r\n        // Windows Authentication\r\n        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION, PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8]\r\n    ];\r\n    \r\n    $authCredentials = [\r\n        [null, null], // Windows Authentication\r\n        [$username, $password], // SQL Server Authentication\r\n        [null, null], // Windows Authentication\r\n        [null, null]  // Windows Authentication\r\n    ];\r\n    \r\n    $pdo = null;\r\n    $lastError = '';\r\n    \r\n    foreach ($connectionStrings as $index => $connStr) {\r\n        try {\r\n            echo \"<p>Deneme \" . ($index + 1) . \": $connStr</p>\";\r\n            $creds = $authCredentials[$index];\r\n            \r\n            $pdo = new PDO(\r\n                $connStr,\r\n                $creds[0], // username (null for Windows Auth)\r\n                $creds[1], // password (null for Windows Auth)\r\n                $authOptions[$index]\r\n            );\r\n            echo \"<p style='color: green;'>✓ Bağlantı başarılı!</p>\";\r\n            break;\r\n        } catch (Exception $e) {\r\n            $lastError = $e->getMessage();\r\n            echo \"<p style='color: red;'>✗ Hata: \" . htmlspecialchars($lastError) . \"</p>\";\r\n        }\r\n    }\r\n    \r\n    if (!$pdo) {\r\n        throw new Exception(\"Tüm bağlantı denemeleri başarısız: \" . $lastError);\r\n    }\r\n    \r\n    echo \"<h2>AĞUSTOS Verisi Kontrol Raporu</h2>\";\r\n    \r\n    // Toplam kayıt sayısı\r\n    $stmt = $pdo->query(\"SELECT COUNT(*) as total FROM dbo.primebaz_rapor\");\r\n    $total = $stmt->fetch()['total'];\r\n    echo \"<p><strong>Toplam kayıt sayısı:</strong> $total</p>\";\r\n    \r\n    // AĞUSTOS 2024 verisi var mı?\r\n    $stmt = $pdo->query(\"SELECT COUNT(*) as agustos_count FROM dbo.primebaz_rapor WHERE MONTH(ORDER_DATE) = 8 AND YEAR(ORDER_DATE) = 2024\");\r\n    $agustos = $stmt->fetch()['agustos_count'];\r\n    echo \"<p><strong>AĞUSTOS 2024 kayıtları:</strong> $agustos</p>\";\r\n    \r\n    // Son eklenen kayıtlar\r\n    $stmt = $pdo->query(\"SELECT TOP 5 ORDER_DATE, CUSTOMER_ID, ACCOUNT_NO FROM dbo.primebaz_rapor ORDER BY id DESC\");\r\n    echo \"<h3>Son 5 Kayıt:</h3>\";\r\n    echo \"<table border='1'>\";\r\n    echo \"<tr><th>ORDER_DATE</th><th>CUSTOMER_ID</th><th>ACCOUNT_NO</th></tr>\";\r\n    while ($row = $stmt->fetch()) {\r\n        echo \"<tr>\";\r\n        echo \"<td>\" . ($row['ORDER_DATE'] ? $row['ORDER_DATE']->format('Y-m-d') : 'NULL') . \"</td>\";\r\n        echo \"<td>\" . htmlspecialchars($row['CUSTOMER_ID']) . \"</td>\";\r\n        echo \"<td>\" . htmlspecialchars($row['ACCOUNT_NO']) . \"</td>\";\r\n        echo \"</tr>\";\r\n    }\r\n    echo \"</table>\";\r\n    \r\n    // AĞUSTOS verilerine örnek\r\n    if ($agustos > 0) {\r\n        $stmt = $pdo->query(\"SELECT TOP 3 ORDER_DATE, CUSTOMER_ID, ACCOUNT_NO FROM dbo.primebaz_rapor WHERE MONTH(ORDER_DATE) = 8 AND YEAR(ORDER_DATE) = 2024\");\r\n        echo \"<h3>AĞUSTOS 2024 Örnekleri:</h3>\";\r\n        echo \"<table border='1'>\";\r\n        echo \"<tr><th>ORDER_DATE</th><th>CUSTOMER_ID</th><th>ACCOUNT_NO</th></tr>\";\r\n        while ($row = $stmt->fetch()) {\r\n            echo \"<tr>\";\r\n            echo \"<td>\" . ($row['ORDER_DATE'] ? $row['ORDER_DATE']->format('Y-m-d') : 'NULL') . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['CUSTOMER_ID']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['ACCOUNT_NO']) . \"</td>\";\r\n            echo \"</tr>\";\r\n        }\r\n        echo \"</table>\";\r\n    }\r\n    \r\n} catch (Exception $e) {\r\n    echo \"<p style='color: red;'><strong>Hata:</strong> \" . htmlspecialchars($e->getMessage()) . \"</p>\";\r\n}\r\n?>"
        }
    ]
}