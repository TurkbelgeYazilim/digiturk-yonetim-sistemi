{
    "sourceFile": "bayi_tanimlama.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1758983724598,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759329392119,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,19 +7,42 @@\n // Auth kontrol\r\n require_once 'auth.php';\r\n $currentUser = checkAdminAuth(); // Sadece admin erişebilir\r\n \r\n-// Veritabanı bağlantısı\r\n-require_once 'MSSQLConnection.php';\r\n+// Veritabanı bağlantı fonksiyonu\r\n+function getDatabaseConnection() {\r\n+    $configFile = __DIR__ . '/config/mssql.php';\r\n+    \r\n+    if (!file_exists($configFile)) {\r\n+        throw new Exception('Veritabanı konfigürasyon dosyası bulunamadı: ' . $configFile);\r\n+    }\r\n+    \r\n+    $config = include $configFile;\r\n+    \r\n+    try {\r\n+        $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n+        \r\n+        $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n+            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n+            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n+            PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n+            PDO::ATTR_EMULATE_PREPARES => false\r\n+        ]);\r\n+        \r\n+        return $connection;\r\n+        \r\n+    } catch (PDOException $e) {\r\n+        throw new Exception('Veritabanı bağlantı hatası: ' . $e->getMessage());\r\n+    }\r\n+}\r\n \r\n $message = '';\r\n $messageType = '';\r\n \r\n // Bayi işlemleri\r\n if ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n     try {\r\n-        $db = new MSSQLConnection();\r\n-        $conn = $db->getConnection();\r\n+        $conn = getDatabaseConnection();\r\n         \r\n         $action = $_POST['action'] ?? '';\r\n         \r\n         switch ($action) {\r\n@@ -97,10 +120,9 @@\n \r\n // Kullanıcıları al (dropdown için)\r\n $users = [];\r\n try {\r\n-    $db = new MSSQLConnection();\r\n-    $conn = $db->getConnection();\r\n+    $conn = getDatabaseConnection();\r\n     \r\n     $userSql = \"SELECT id, first_name, last_name, email FROM users WHERE status = 'AKTIF' ORDER BY first_name, last_name\";\r\n     $userStmt = $conn->prepare($userSql);\r\n     $userStmt->execute();\r\n@@ -113,10 +135,9 @@\n // Bayileri listele\r\n $bayiler = [];\r\n $error = '';\r\n try {\r\n-    $db = new MSSQLConnection();\r\n-    $conn = $db->getConnection();\r\n+    $conn = getDatabaseConnection();\r\n     \r\n     $sql = \"SELECT ub.id, ub.user_id, ub.iris_altbayi, ub.personel_kimlik_no, ub.created_at, ub.updated_at,\r\n                    u.first_name, u.last_name\r\n             FROM users_bayi ub \r\n"
                },
                {
                    "date": 1759333257163,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,39 +1,21 @@\n <?php\r\n+// Enable error reporting for debugging\r\n+ini_set('display_errors', 1);\r\n+ini_set('display_startup_errors', 1);\r\n+error_reporting(E_ALL);\r\n+\r\n $pageTitle = \"Bayi Tanımlama\";\r\n $breadcrumbs = [\r\n     ['title' => 'Bayi Tanımlama']\r\n ];\r\n \r\n // Auth kontrol\r\n-require_once 'auth.php';\r\n-$currentUser = checkAdminAuth(); // Sadece admin erişebilir\r\n-\r\n-// Veritabanı bağlantı fonksiyonu\r\n-function getDatabaseConnection() {\r\n-    $configFile = __DIR__ . '/config/mssql.php';\r\n-    \r\n-    if (!file_exists($configFile)) {\r\n-        throw new Exception('Veritabanı konfigürasyon dosyası bulunamadı: ' . $configFile);\r\n-    }\r\n-    \r\n-    $config = include $configFile;\r\n-    \r\n-    try {\r\n-        $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n-        \r\n-        $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n-            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n-            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n-            PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n-            PDO::ATTR_EMULATE_PREPARES => false\r\n-        ]);\r\n-        \r\n-        return $connection;\r\n-        \r\n-    } catch (PDOException $e) {\r\n-        throw new Exception('Veritabanı bağlantı hatası: ' . $e->getMessage());\r\n-    }\r\n+try {\r\n+    require_once 'auth.php';\r\n+    $currentUser = checkAdminAuth(); // Sadece admin erişebilir\r\n+} catch (Exception $e) {\r\n+    die(\"Auth hatası: \" . $e->getMessage());\r\n }\r\n \r\n $message = '';\r\n $messageType = '';\r\n@@ -50,8 +32,20 @@\n                 $userId = (int)$_POST['user_id'];\r\n                 $irisAltbayi = trim($_POST['iris_altbayi']);\r\n                 $personelKimlikNo = trim($_POST['personel_kimlik_no']);\r\n                 \r\n+                if ($userId <= 0) {\r\n+                    $message = 'Geçerli bir kullanıcı seçiniz.';\r\n+                    $messageType = 'danger';\r\n+                    break;\r\n+                }\r\n+                \r\n+                if (empty($irisAltbayi)) {\r\n+                    $message = 'İRİS ALTBAYI alanı zorunludur.';\r\n+                    $messageType = 'danger';\r\n+                    break;\r\n+                }\r\n+                \r\n                 // Personel Kimlik No boş değilse, zaten kullanılıp kullanılmadığını kontrol et\r\n                 if (!empty($personelKimlikNo)) {\r\n                     $checkSql = \"SELECT id FROM users_bayi WHERE personel_kimlik_no = ?\";\r\n                     $checkStmt = $conn->prepare($checkSql);\r\n@@ -78,8 +72,20 @@\n                 $userId = (int)$_POST['user_id'];\r\n                 $irisAltbayi = trim($_POST['iris_altbayi']);\r\n                 $personelKimlikNo = trim($_POST['personel_kimlik_no']);\r\n                 \r\n+                if ($id <= 0 || $userId <= 0) {\r\n+                    $message = 'Geçersiz parametreler.';\r\n+                    $messageType = 'danger';\r\n+                    break;\r\n+                }\r\n+                \r\n+                if (empty($irisAltbayi)) {\r\n+                    $message = 'İRİS ALTBAYI alanı zorunludur.';\r\n+                    $messageType = 'danger';\r\n+                    break;\r\n+                }\r\n+                \r\n                 // Personel Kimlik No boş değilse, başka bir kayıtta kullanılıp kullanılmadığını kontrol et (mevcut kayıt hariç)\r\n                 if (!empty($personelKimlikNo)) {\r\n                     $checkSql = \"SELECT id FROM users_bayi WHERE personel_kimlik_no = ? AND id != ?\";\r\n                     $checkStmt = $conn->prepare($checkSql);\r\n@@ -103,17 +109,29 @@\n                 \r\n             case 'delete':\r\n                 $id = (int)$_POST['id'];\r\n                 \r\n+                if ($id <= 0) {\r\n+                    $message = 'Geçersiz ID.';\r\n+                    $messageType = 'danger';\r\n+                    break;\r\n+                }\r\n+                \r\n                 $sql = \"DELETE FROM users_bayi WHERE id = ?\";\r\n                 $stmt = $conn->prepare($sql);\r\n                 $stmt->execute([$id]);\r\n                 \r\n                 $message = 'Bayi kaydı başarıyla silindi.';\r\n                 $messageType = 'success';\r\n                 break;\r\n+                \r\n+            default:\r\n+                $message = 'Geçersiz işlem.';\r\n+                $messageType = 'danger';\r\n+                break;\r\n         }\r\n     } catch (Exception $e) {\r\n+        error_log(\"POST operation error: \" . $e->getMessage());\r\n         $message = 'Hata: ' . $e->getMessage();\r\n         $messageType = 'danger';\r\n     }\r\n }\r\n@@ -129,8 +147,10 @@\n     $users = $userStmt->fetchAll(PDO::FETCH_ASSOC);\r\n     \r\n } catch (Exception $e) {\r\n     $users = [];\r\n+    error_log(\"Error fetching users: \" . $e->getMessage());\r\n+    $error = \"Kullanıcı listesi alınırken hata oluştu: \" . $e->getMessage();\r\n }\r\n \r\n // Bayileri listele\r\n $bayiler = [];\r\n@@ -147,12 +167,17 @@\n     $stmt->execute();\r\n     $bayiler = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n     \r\n } catch (Exception $e) {\r\n+    error_log(\"Error fetching bayiler: \" . $e->getMessage());\r\n     $error = \"Veritabanı hatası: \" . $e->getMessage();\r\n }\r\n \r\n-include 'includes/header.php';\r\n+try {\r\n+    include 'includes/header.php';\r\n+} catch (Exception $e) {\r\n+    die(\"Header dosyası yüklenirken hata: \" . $e->getMessage());\r\n+}\r\n ?>\r\n \r\n <div class=\"container-fluid mt-4\">\r\n     <div class=\"row\">\r\n"
                }
            ],
            "date": 1758983724598,
            "name": "Commit-0",
            "content": "<?php\r\n$pageTitle = \"Bayi Tanımlama\";\r\n$breadcrumbs = [\r\n    ['title' => 'Bayi Tanımlama']\r\n];\r\n\r\n// Auth kontrol\r\nrequire_once 'auth.php';\r\n$currentUser = checkAdminAuth(); // Sadece admin erişebilir\r\n\r\n// Veritabanı bağlantısı\r\nrequire_once 'MSSQLConnection.php';\r\n\r\n$message = '';\r\n$messageType = '';\r\n\r\n// Bayi işlemleri\r\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n    try {\r\n        $db = new MSSQLConnection();\r\n        $conn = $db->getConnection();\r\n        \r\n        $action = $_POST['action'] ?? '';\r\n        \r\n        switch ($action) {\r\n            case 'add':\r\n                $userId = (int)$_POST['user_id'];\r\n                $irisAltbayi = trim($_POST['iris_altbayi']);\r\n                $personelKimlikNo = trim($_POST['personel_kimlik_no']);\r\n                \r\n                // Personel Kimlik No boş değilse, zaten kullanılıp kullanılmadığını kontrol et\r\n                if (!empty($personelKimlikNo)) {\r\n                    $checkSql = \"SELECT id FROM users_bayi WHERE personel_kimlik_no = ?\";\r\n                    $checkStmt = $conn->prepare($checkSql);\r\n                    $checkStmt->execute([$personelKimlikNo]);\r\n                    \r\n                    if ($checkStmt->fetch()) {\r\n                        $message = 'Bu Personel Kimlik No zaten kullanılmaktadır.';\r\n                        $messageType = 'danger';\r\n                        break;\r\n                    }\r\n                }\r\n                \r\n                $sql = \"INSERT INTO users_bayi (user_id, iris_altbayi, personel_kimlik_no) \r\n                        VALUES (?, ?, ?)\";\r\n                $stmt = $conn->prepare($sql);\r\n                $stmt->execute([$userId, $irisAltbayi, $personelKimlikNo]);\r\n                \r\n                $message = 'Bayi başarıyla tanımlandı.';\r\n                $messageType = 'success';\r\n                break;\r\n                \r\n            case 'edit':\r\n                $id = (int)$_POST['id'];\r\n                $userId = (int)$_POST['user_id'];\r\n                $irisAltbayi = trim($_POST['iris_altbayi']);\r\n                $personelKimlikNo = trim($_POST['personel_kimlik_no']);\r\n                \r\n                // Personel Kimlik No boş değilse, başka bir kayıtta kullanılıp kullanılmadığını kontrol et (mevcut kayıt hariç)\r\n                if (!empty($personelKimlikNo)) {\r\n                    $checkSql = \"SELECT id FROM users_bayi WHERE personel_kimlik_no = ? AND id != ?\";\r\n                    $checkStmt = $conn->prepare($checkSql);\r\n                    $checkStmt->execute([$personelKimlikNo, $id]);\r\n                    \r\n                    if ($checkStmt->fetch()) {\r\n                        $message = 'Bu Personel Kimlik No başka bir bayi kaydında kullanılmaktadır.';\r\n                        $messageType = 'danger';\r\n                        break;\r\n                    }\r\n                }\r\n                \r\n                $sql = \"UPDATE users_bayi SET user_id = ?, iris_altbayi = ?, personel_kimlik_no = ?, updated_at = GETDATE() \r\n                        WHERE id = ?\";\r\n                $stmt = $conn->prepare($sql);\r\n                $stmt->execute([$userId, $irisAltbayi, $personelKimlikNo, $id]);\r\n                \r\n                $message = 'Bayi bilgileri başarıyla güncellendi.';\r\n                $messageType = 'success';\r\n                break;\r\n                \r\n            case 'delete':\r\n                $id = (int)$_POST['id'];\r\n                \r\n                $sql = \"DELETE FROM users_bayi WHERE id = ?\";\r\n                $stmt = $conn->prepare($sql);\r\n                $stmt->execute([$id]);\r\n                \r\n                $message = 'Bayi kaydı başarıyla silindi.';\r\n                $messageType = 'success';\r\n                break;\r\n        }\r\n    } catch (Exception $e) {\r\n        $message = 'Hata: ' . $e->getMessage();\r\n        $messageType = 'danger';\r\n    }\r\n}\r\n\r\n// Kullanıcıları al (dropdown için)\r\n$users = [];\r\ntry {\r\n    $db = new MSSQLConnection();\r\n    $conn = $db->getConnection();\r\n    \r\n    $userSql = \"SELECT id, first_name, last_name, email FROM users WHERE status = 'AKTIF' ORDER BY first_name, last_name\";\r\n    $userStmt = $conn->prepare($userSql);\r\n    $userStmt->execute();\r\n    $users = $userStmt->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n} catch (Exception $e) {\r\n    $users = [];\r\n}\r\n\r\n// Bayileri listele\r\n$bayiler = [];\r\n$error = '';\r\ntry {\r\n    $db = new MSSQLConnection();\r\n    $conn = $db->getConnection();\r\n    \r\n    $sql = \"SELECT ub.id, ub.user_id, ub.iris_altbayi, ub.personel_kimlik_no, ub.created_at, ub.updated_at,\r\n                   u.first_name, u.last_name\r\n            FROM users_bayi ub \r\n            INNER JOIN users u ON ub.user_id = u.id\r\n            ORDER BY ub.created_at DESC\";\r\n    $stmt = $conn->prepare($sql);\r\n    $stmt->execute();\r\n    $bayiler = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n} catch (Exception $e) {\r\n    $error = \"Veritabanı hatası: \" . $e->getMessage();\r\n}\r\n\r\ninclude 'includes/header.php';\r\n?>\r\n\r\n<div class=\"container-fluid mt-4\">\r\n    <div class=\"row\">\r\n        <div class=\"col-12\">\r\n            <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                <h2><i class=\"fas fa-store me-2\"></i>Bayi Tanımlama</h2>\r\n                <button class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#addBayiModal\">\r\n                    <i class=\"fas fa-plus me-1\"></i>Yeni Bayi\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <?php if ($message): ?>\r\n        <div class=\"alert alert-<?php echo $messageType; ?> alert-dismissible fade show\" role=\"alert\">\r\n            <i class=\"fas fa-<?php echo $messageType === 'success' ? 'check-circle' : 'exclamation-triangle'; ?> me-2\"></i>\r\n            <?php echo htmlspecialchars($message); ?>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n        </div>\r\n    <?php endif; ?>\r\n\r\n    <?php if ($error): ?>\r\n        <div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">\r\n            <i class=\"fas fa-exclamation-triangle me-2\"></i>\r\n            <?php echo htmlspecialchars($error); ?>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n        </div>\r\n    <?php endif; ?>\r\n\r\n    <!-- Bayiler Tablosu -->\r\n    <div class=\"card border-0 shadow-sm\">\r\n        <div class=\"card-header bg-primary text-white\">\r\n            <h5 class=\"mb-0\">\r\n                <i class=\"fas fa-list me-2\"></i>Bayi Listesi\r\n            </h5>\r\n        </div>\r\n        <div class=\"card-body p-0\">\r\n            <div class=\"table-responsive\">\r\n                <table class=\"table table-hover mb-0\">\r\n                    <thead class=\"table-light\">\r\n                        <tr>\r\n                            <th>ID</th>\r\n                            <th>Kullanıcı Adı</th>\r\n                            <th>İRİS ALTBAYI</th>\r\n                            <th>Personel Kimlik No</th>\r\n                            <th>Kayıt Tarihi</th>\r\n                            <th>Güncelleme Tarihi</th>\r\n                            <th>İşlemler</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <?php if (!empty($bayiler)): ?>\r\n                            <?php foreach ($bayiler as $bayi): ?>\r\n                                <tr>\r\n                                    <td><?php echo $bayi['id']; ?></td>\r\n                                    <td>\r\n                                        <strong><?php echo htmlspecialchars($bayi['first_name'] . ' ' . $bayi['last_name']); ?></strong>\r\n                                    </td>\r\n                                    <td>\r\n                                        <span class=\"badge bg-info\">\r\n                                            <?php echo htmlspecialchars($bayi['iris_altbayi']); ?>\r\n                                        </span>\r\n                                    </td>\r\n                                    <td><?php echo htmlspecialchars($bayi['personel_kimlik_no'] ?? '-'); ?></td>\r\n                                    <td>\r\n                                        <?php echo $bayi['created_at'] ? date('d.m.Y H:i', strtotime($bayi['created_at'])) : '-'; ?>\r\n                                    </td>\r\n                                    <td>\r\n                                        <?php echo $bayi['updated_at'] ? date('d.m.Y H:i', strtotime($bayi['updated_at'])) : '-'; ?>\r\n                                    </td>\r\n                                    <td>\r\n                                        <div class=\"btn-group\" role=\"group\">\r\n                                            <button type=\"button\" class=\"btn btn-sm btn-outline-primary\" \r\n                                                    onclick=\"editBayi(<?php echo htmlspecialchars(json_encode($bayi)); ?>)\">\r\n                                                <i class=\"fas fa-edit\"></i>\r\n                                            </button>\r\n                                            <button type=\"button\" class=\"btn btn-sm btn-outline-danger\" \r\n                                                    onclick=\"deleteBayi(<?php echo $bayi['id']; ?>, '<?php echo htmlspecialchars($bayi['first_name'] . ' ' . $bayi['last_name']); ?>')\">\r\n                                                <i class=\"fas fa-trash\"></i>\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            <?php endforeach; ?>\r\n                        <?php else: ?>\r\n                            <tr>\r\n                                <td colspan=\"7\" class=\"text-center py-5 text-muted\">\r\n                                    <i class=\"fas fa-store fa-3x mb-3 d-block\"></i>\r\n                                    <h5>Henüz bayi tanımlanmamış</h5>\r\n                                    <p>İlk bayiyi tanımlamak için \"Yeni Bayi\" butonuna tıklayın.</p>\r\n                                </td>\r\n                            </tr>\r\n                        <?php endif; ?>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- Yeni Bayi Modal -->\r\n<div class=\"modal fade\" id=\"addBayiModal\" tabindex=\"-1\">\r\n    <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n            <form method=\"POST\" action=\"\">\r\n                <input type=\"hidden\" name=\"action\" value=\"add\">\r\n                <div class=\"modal-header\">\r\n                    <h5 class=\"modal-title\">\r\n                        <i class=\"fas fa-store me-2\"></i>Yeni Bayi Tanımla\r\n                    </h5>\r\n                    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <div class=\"mb-3\">\r\n                        <label for=\"add_user_id\" class=\"form-label\">Kullanıcı Seçin</label>\r\n                        <select class=\"form-select\" id=\"add_user_id\" name=\"user_id\" required>\r\n                            <option value=\"\">Kullanıcı Seçin</option>\r\n                            <?php foreach ($users as $user): ?>\r\n                                <option value=\"<?php echo $user['id']; ?>\" title=\"<?php echo htmlspecialchars($user['email']); ?>\">\r\n                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?> \r\n                                    (<?php echo htmlspecialchars($user['email']); ?>)\r\n                                </option>\r\n                            <?php endforeach; ?>\r\n                        </select>\r\n                    </div>\r\n                    <div class=\"mb-3\">\r\n                        <label for=\"add_iris_altbayi\" class=\"form-label\">İRİS ALTBAYI</label>\r\n                        <input type=\"text\" class=\"form-control\" id=\"add_iris_altbayi\" name=\"iris_altbayi\" required \r\n                               placeholder=\"İRİS ALTBAYI kodunu girin\">\r\n                    </div>\r\n                    <div class=\"mb-3\">\r\n                        <label for=\"add_personel_kimlik_no\" class=\"form-label\">Personel Kimlik No</label>\r\n                        <input type=\"text\" class=\"form-control\" id=\"add_personel_kimlik_no\" name=\"personel_kimlik_no\" \r\n                               placeholder=\"Personel kimlik numarasını girin (opsiyonel)\">\r\n                    </div>\r\n                </div>\r\n                <div class=\"modal-footer\">\r\n                    <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">İptal</button>\r\n                    <button type=\"submit\" class=\"btn btn-primary\">\r\n                        <i class=\"fas fa-save me-1\"></i>Kaydet\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- Bayi Düzenle Modal -->\r\n<div class=\"modal fade\" id=\"editBayiModal\" tabindex=\"-1\">\r\n    <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n            <form method=\"POST\" action=\"\">\r\n                <input type=\"hidden\" name=\"action\" value=\"edit\">\r\n                <input type=\"hidden\" name=\"id\" id=\"edit_id\">\r\n                <div class=\"modal-header\">\r\n                    <h5 class=\"modal-title\">\r\n                        <i class=\"fas fa-edit me-2\"></i>Bayi Düzenle\r\n                    </h5>\r\n                    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <div class=\"mb-3\">\r\n                        <label for=\"edit_user_id\" class=\"form-label\">Kullanıcı Seçin</label>\r\n                        <select class=\"form-select\" id=\"edit_user_id\" name=\"user_id\" required>\r\n                            <option value=\"\">Kullanıcı Seçin</option>\r\n                            <?php foreach ($users as $user): ?>\r\n                                <option value=\"<?php echo $user['id']; ?>\" title=\"<?php echo htmlspecialchars($user['email']); ?>\">\r\n                                    <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?> \r\n                                    (<?php echo htmlspecialchars($user['email']); ?>)\r\n                                </option>\r\n                            <?php endforeach; ?>\r\n                        </select>\r\n                    </div>\r\n                    <div class=\"mb-3\">\r\n                        <label for=\"edit_iris_altbayi\" class=\"form-label\">İRİS ALTBAYI</label>\r\n                        <input type=\"text\" class=\"form-control\" id=\"edit_iris_altbayi\" name=\"iris_altbayi\" required \r\n                               placeholder=\"İRİS ALTBAYI kodunu girin\">\r\n                    </div>\r\n                    <div class=\"mb-3\">\r\n                        <label for=\"edit_personel_kimlik_no\" class=\"form-label\">Personel Kimlik No</label>\r\n                        <input type=\"text\" class=\"form-control\" id=\"edit_personel_kimlik_no\" name=\"personel_kimlik_no\" \r\n                               placeholder=\"Personel kimlik numarasını girin (opsiyonel)\">\r\n                    </div>\r\n                </div>\r\n                <div class=\"modal-footer\">\r\n                    <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">İptal</button>\r\n                    <button type=\"submit\" class=\"btn btn-primary\">\r\n                        <i class=\"fas fa-save me-1\"></i>Güncelle\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n<script>\r\nfunction editBayi(bayi) {\r\n    document.getElementById('edit_id').value = bayi.id;\r\n    document.getElementById('edit_user_id').value = bayi.user_id;\r\n    document.getElementById('edit_iris_altbayi').value = bayi.iris_altbayi;\r\n    document.getElementById('edit_personel_kimlik_no').value = bayi.personel_kimlik_no || '';\r\n    \r\n    new bootstrap.Modal(document.getElementById('editBayiModal')).show();\r\n}\r\n\r\nfunction deleteBayi(bayiId, kullaniciAdi) {\r\n    if (confirm(kullaniciAdi + ' kullanıcısının bayi kaydını silmek istediğinizden emin misiniz?\\n\\nBu işlem geri alınamaz.')) {\r\n        const form = document.createElement('form');\r\n        form.method = 'POST';\r\n        form.innerHTML = `\r\n            <input type=\"hidden\" name=\"action\" value=\"delete\">\r\n            <input type=\"hidden\" name=\"id\" value=\"${bayiId}\">\r\n        `;\r\n        document.body.appendChild(form);\r\n        form.submit();\r\n    }\r\n}\r\n\r\n// Modal açıldığında temizle\r\ndocument.getElementById('addBayiModal').addEventListener('show.bs.modal', function () {\r\n    document.getElementById('add_user_id').value = '';\r\n    document.getElementById('add_iris_altbayi').value = '';\r\n    document.getElementById('add_personel_kimlik_no').value = '';\r\n});\r\n</script>\r\n\r\n<?php include 'includes/footer.php'; ?>\r\n"
        }
    ]
}