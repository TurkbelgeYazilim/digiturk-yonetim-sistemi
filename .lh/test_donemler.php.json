{
    "sourceFile": "test_donemler.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759480961228,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759480961228,
            "name": "Commit-0",
            "content": "<?php\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\n\r\n// Veritabanı bağlantısı\r\nrequire_once 'config/mssql.php';\r\n\r\nfunction getDatabaseConnection() {\r\n    $config = include 'config/mssql.php';\r\n    try {\r\n        $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n        $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n            PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n            PDO::ATTR_EMULATE_PREPARES => false\r\n        ]);\r\n        return $connection;\r\n    } catch (PDOException $e) {\r\n        throw new Exception('Veritabanı bağlantı hatası: ' . $e->getMessage());\r\n    }\r\n}\r\n\r\ntry {\r\n    $conn = getDatabaseConnection();\r\n    echo \"<h2>Dönem Tablosu Test</h2>\";\r\n    \r\n    // 1. Tablo var mı kontrol et\r\n    echo \"<h3>1. Tablo Kontrolü</h3>\";\r\n    try {\r\n        $testSql = \"SELECT COUNT(*) as count FROM digiturk.bayi_hakedis_prim_donem\";\r\n        $testStmt = $conn->prepare($testSql);\r\n        $testStmt->execute();\r\n        $count = $testStmt->fetch(PDO::FETCH_ASSOC);\r\n        echo \"<p><strong>digiturk.bayi_hakedis_prim_donem</strong> tablosunda toplam kayıt: <strong>\" . $count['count'] . \"</strong></p>\";\r\n    } catch (Exception $e) {\r\n        echo \"<p style='color: red;'>HATA: \" . $e->getMessage() . \"</p>\";\r\n        \r\n        // Schema olmadan dene\r\n        echo \"<h3>2. Schema Olmadan Test</h3>\";\r\n        try {\r\n            $testSql2 = \"SELECT COUNT(*) as count FROM bayi_hakedis_prim_donem\";\r\n            $testStmt2 = $conn->prepare($testSql2);\r\n            $testStmt2->execute();\r\n            $count2 = $testStmt2->fetch(PDO::FETCH_ASSOC);\r\n            echo \"<p><strong>bayi_hakedis_prim_donem</strong> tablosunda toplam kayıt: <strong>\" . $count2['count'] . \"</strong></p>\";\r\n        } catch (Exception $e2) {\r\n            echo \"<p style='color: red;'>HATA 2: \" . $e2->getMessage() . \"</p>\";\r\n        }\r\n    }\r\n    \r\n    // 2. Aktif dönemleri getir\r\n    echo \"<h3>3. Aktif Dönemler</h3>\";\r\n    try {\r\n        $donemSql = \"SELECT id, donem_adi, durum FROM digiturk.bayi_hakedis_prim_donem ORDER BY id DESC\";\r\n        $donemStmt = $conn->prepare($donemSql);\r\n        $donemStmt->execute();\r\n        $donemler = $donemStmt->fetchAll(PDO::FETCH_ASSOC);\r\n        \r\n        if (empty($donemler)) {\r\n            echo \"<p style='color: orange;'>Hiç dönem bulunamadı!</p>\";\r\n        } else {\r\n            echo \"<p>Toplam \" . count($donemler) . \" dönem bulundu:</p>\";\r\n            echo \"<table border='1' style='border-collapse: collapse;'>\";\r\n            echo \"<tr><th>ID</th><th>Dönem Adı</th><th>Durum</th></tr>\";\r\n            foreach ($donemler as $donem) {\r\n                echo \"<tr>\";\r\n                echo \"<td>\" . $donem['id'] . \"</td>\";\r\n                echo \"<td>\" . htmlspecialchars($donem['donem_adi']) . \"</td>\";\r\n                echo \"<td>\" . $donem['durum'] . \"</td>\";\r\n                echo \"</tr>\";\r\n            }\r\n            echo \"</table>\";\r\n            \r\n            // Sadece aktif olanları filtrele\r\n            $aktifDonemler = array_filter($donemler, function($donem) {\r\n                return $donem['durum'] === 'AKTIF';\r\n            });\r\n            echo \"<p><strong>Aktif dönem sayısı:</strong> \" . count($aktifDonemler) . \"</p>\";\r\n        }\r\n    } catch (Exception $e) {\r\n        echo \"<p style='color: red;'>Dönem sorgusunda HATA: \" . $e->getMessage() . \"</p>\";\r\n    }\r\n    \r\n} catch (Exception $e) {\r\n    echo \"<p style='color: red;'>Genel HATA: \" . $e->getMessage() . \"</p>\";\r\n}\r\n?>"
        }
    ]
}