{
    "sourceFile": "forgot-password.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1759329631675,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759385814935,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,34 +3,10 @@\n \r\n $message = '';\r\n $messageType = '';\r\n \r\n-// Veritabanı bağlantı fonksiyonu\r\n-function getDatabaseConnection() {\r\n-    $configFile = __DIR__ . '/config/mssql.php';\r\n-    \r\n-    if (!file_exists($configFile)) {\r\n-        throw new Exception('Veritabanı konfigürasyon dosyası bulunamadı: ' . $configFile);\r\n-    }\r\n-    \r\n-    $config = include $configFile;\r\n-    \r\n-    try {\r\n-        $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n-        \r\n-        $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n-            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n-            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n-            PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n-            PDO::ATTR_EMULATE_PREPARES => false\r\n-        ]);\r\n-        \r\n-        return $connection;\r\n-        \r\n-    } catch (PDOException $e) {\r\n-        throw new Exception('Veritabanı bağlantı hatası: ' . $e->getMessage());\r\n-    }\r\n-}\r\n+// Veritabanı bağlantı fonksiyonu auth.php dosyasından include edilecek\r\n+require_once 'auth.php';\r\n \r\n if ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n     \r\n     $email = trim($_POST['email'] ?? '');\r\n"
                }
            ],
            "date": 1759329631674,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\n\r\n$message = '';\r\n$messageType = '';\r\n\r\n// Veritabanı bağlantı fonksiyonu\r\nfunction getDatabaseConnection() {\r\n    $configFile = __DIR__ . '/config/mssql.php';\r\n    \r\n    if (!file_exists($configFile)) {\r\n        throw new Exception('Veritabanı konfigürasyon dosyası bulunamadı: ' . $configFile);\r\n    }\r\n    \r\n    $config = include $configFile;\r\n    \r\n    try {\r\n        $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n        \r\n        $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n            PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n            PDO::ATTR_EMULATE_PREPARES => false\r\n        ]);\r\n        \r\n        return $connection;\r\n        \r\n    } catch (PDOException $e) {\r\n        throw new Exception('Veritabanı bağlantı hatası: ' . $e->getMessage());\r\n    }\r\n}\r\n\r\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n    \r\n    $email = trim($_POST['email'] ?? '');\r\n    \r\n    if (empty($email)) {\r\n        $message = 'E-posta adresi zorunludur.';\r\n        $messageType = 'danger';\r\n    } else {\r\n        try {\r\n            $conn = getDatabaseConnection();\r\n            \r\n            // Kullanıcıyı e-posta ile bul\r\n            $sql = \"SELECT id, first_name, last_name FROM users WHERE email = ? AND status = 'AKTIF'\";\r\n            $stmt = $conn->prepare($sql);\r\n            $stmt->execute([$email]);\r\n            $user = $stmt->fetch(PDO::FETCH_ASSOC);\r\n            \r\n            if ($user) {\r\n                // Gerçek bir uygulamada burada e-posta gönderilir\r\n                // Şimdilik geçici şifre olarak \"temp123\" veriyoruz\r\n                $tempPassword = 'temp123';\r\n                $passwordHash = password_hash($tempPassword, PASSWORD_DEFAULT);\r\n                \r\n                $updateSql = \"UPDATE users SET password_hash = ?, updated_at = GETDATE() WHERE id = ?\";\r\n                $updateStmt = $conn->prepare($updateSql);\r\n                $updateStmt->execute([$passwordHash, $user['id']]);\r\n                \r\n                $message = 'Geçici şifreniz: <strong>temp123</strong><br>Lütfen giriş yaptıktan sonra şifrenizi değiştirin.';\r\n                $messageType = 'success';\r\n            } else {\r\n                $message = 'Bu e-posta adresi ile kayıtlı aktif bir kullanıcı bulunamadı.';\r\n                $messageType = 'danger';\r\n            }\r\n        } catch (Exception $e) {\r\n            $message = 'Sistem hatası: ' . $e->getMessage();\r\n            $messageType = 'danger';\r\n        }\r\n    }\r\n}\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"tr\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Şifremi Unuttum - Digitürk İleka</title>\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" rel=\"stylesheet\">\r\n    <style>\r\n        body {\r\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n            min-height: 100vh;\r\n            display: flex;\r\n            align-items: center;\r\n        }\r\n        .forgot-card {\r\n            background: rgba(255, 255, 255, 0.95);\r\n            backdrop-filter: blur(10px);\r\n            border-radius: 15px;\r\n            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);\r\n            overflow: hidden;\r\n        }\r\n        .forgot-header {\r\n            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\r\n            color: white;\r\n            padding: 2rem;\r\n            text-align: center;\r\n        }\r\n        .forgot-body {\r\n            padding: 2rem;\r\n        }\r\n        .form-control {\r\n            border: none;\r\n            border-bottom: 2px solid #e0e0e0;\r\n            border-radius: 0;\r\n            padding: 15px 0;\r\n            background: transparent;\r\n            transition: all 0.3s ease;\r\n        }\r\n        .form-control:focus {\r\n            border-bottom-color: #f59e0b;\r\n            box-shadow: none;\r\n            background: transparent;\r\n        }\r\n        .btn-reset {\r\n            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\r\n            border: none;\r\n            padding: 12px 30px;\r\n            border-radius: 25px;\r\n            font-weight: 600;\r\n            transition: all 0.3s ease;\r\n        }\r\n        .btn-reset:hover {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);\r\n        }\r\n        .input-group {\r\n            position: relative;\r\n            margin-bottom: 1.5rem;\r\n        }\r\n        .input-icon {\r\n            position: absolute;\r\n            left: 0;\r\n            top: 50%;\r\n            transform: translateY(-50%);\r\n            color: #666;\r\n            z-index: 10;\r\n        }\r\n        .form-control {\r\n            padding-left: 30px;\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"container\">\r\n        <div class=\"row justify-content-center\">\r\n            <div class=\"col-md-6 col-lg-5\">\r\n                <div class=\"forgot-card\">\r\n                    <div class=\"forgot-header\">\r\n                        <div class=\"mb-3\">\r\n                            <i class=\"fas fa-key fa-3x\"></i>\r\n                        </div>\r\n                        <h3 class=\"mb-0\">Şifremi Unuttum</h3>\r\n                        <p class=\"mb-0\">E-posta adresinizi girin</p>\r\n                    </div>\r\n                    \r\n                    <div class=\"forgot-body\">\r\n                        <?php if ($message): ?>\r\n                            <div class=\"alert alert-<?php echo $messageType; ?> alert-dismissible fade show\" role=\"alert\">\r\n                                <i class=\"fas fa-<?php echo $messageType === 'success' ? 'check-circle' : 'exclamation-triangle'; ?> me-2\"></i>\r\n                                <?php echo $message; ?>\r\n                                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n                            </div>\r\n                        <?php endif; ?>\r\n                        \r\n                        <form method=\"POST\" action=\"\" id=\"forgotForm\">\r\n                            <div class=\"input-group\">\r\n                                <i class=\"fas fa-envelope input-icon\"></i>\r\n                                <input type=\"email\" \r\n                                       class=\"form-control\" \r\n                                       id=\"email\" \r\n                                       name=\"email\" \r\n                                       placeholder=\"E-posta adresiniz\"\r\n                                       value=\"<?php echo htmlspecialchars($_POST['email'] ?? ''); ?>\"\r\n                                       required>\r\n                            </div>\r\n                            \r\n                            <div class=\"d-grid mb-3\">\r\n                                <button type=\"submit\" class=\"btn btn-warning btn-reset btn-lg\">\r\n                                    <i class=\"fas fa-paper-plane me-2\"></i>\r\n                                    Şifre Sıfırla\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                        \r\n                        <hr class=\"my-4\">\r\n                        \r\n                        <div class=\"text-center\">\r\n                            <a href=\"login.php\" class=\"btn btn-outline-secondary\">\r\n                                <i class=\"fas fa-arrow-left me-2\"></i>\r\n                                Giriş Sayfasına Dön\r\n                            </a>\r\n                        </div>\r\n                        \r\n                        <div class=\"mt-4 text-center\">\r\n                            <small class=\"text-muted\">\r\n                                <i class=\"fas fa-info-circle me-1\"></i>\r\n                                Geçici şifre ile giriş yaptıktan sonra şifrenizi değiştirmeyi unutmayın.\r\n                            </small>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n    <script>\r\n        // Form validasyonu\r\n        document.getElementById('forgotForm').addEventListener('submit', function(e) {\r\n            const email = document.getElementById('email').value.trim();\r\n            \r\n            if (!email) {\r\n                e.preventDefault();\r\n                alert('Lütfen e-posta adresinizi giriniz.');\r\n                return false;\r\n            }\r\n            \r\n            // Email format kontrolü\r\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n            if (!emailRegex.test(email)) {\r\n                e.preventDefault();\r\n                alert('Lütfen geçerli bir e-posta adresi giriniz.');\r\n                return false;\r\n            }\r\n            \r\n            // Loading göster\r\n            const submitBtn = this.querySelector('button[type=\"submit\"]');\r\n            const originalText = submitBtn.innerHTML;\r\n            submitBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin me-2\"></i>İşleniyor...';\r\n            submitBtn.disabled = true;\r\n            \r\n            // Hata durumunda loading'i geri al\r\n            setTimeout(() => {\r\n                submitBtn.innerHTML = originalText;\r\n                submitBtn.disabled = false;\r\n            }, 5000);\r\n        });\r\n        \r\n        // Auto focus\r\n        document.addEventListener('DOMContentLoaded', function() {\r\n            document.getElementById('email').focus();\r\n        });\r\n    </script>\r\n</body>\r\n</html>\r\n"
        }
    ]
}