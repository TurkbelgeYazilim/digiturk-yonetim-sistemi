{
    "sourceFile": "update_aciklama_field.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1758977855761,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1758977855761,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * Hakediş tanım tablosundaki açıklama alanının boyutunu kontrol et ve güncelle\r\n * Bu script bir kere çalıştırılarak veritabanı yapısını güncelleyecek\r\n */\r\n\r\ntry {\r\n    require_once 'MSSQLConnection.php';\r\n    \r\n    $db = new MSSQLConnection();\r\n    $conn = $db->getConnection();\r\n    \r\n    // Mevcut açıklama alanının boyutunu kontrol et\r\n    $checkSql = \"\r\n    SELECT \r\n        COLUMN_NAME,\r\n        DATA_TYPE,\r\n        CHARACTER_MAXIMUM_LENGTH,\r\n        IS_NULLABLE\r\n    FROM INFORMATION_SCHEMA.COLUMNS \r\n    WHERE TABLE_NAME = 'hakedis_tanim' \r\n    AND COLUMN_NAME = 'aciklama'\";\r\n    \r\n    $stmt = $conn->prepare($checkSql);\r\n    $stmt->execute();\r\n    $column = $stmt->fetch();\r\n    \r\n    if ($column) {\r\n        echo \"<h3>Mevcut açıklama alanı bilgileri:</h3>\";\r\n        echo \"Veri tipi: \" . $column['DATA_TYPE'] . \"<br>\";\r\n        echo \"Maksimum uzunluk: \" . ($column['CHARACTER_MAXIMUM_LENGTH'] ?? 'NULL') . \"<br>\";\r\n        echo \"Null olabilir: \" . $column['IS_NULLABLE'] . \"<br><br>\";\r\n        \r\n        // Eğer uzunluk 200'den azsa veya 500'den azsa güncelle\r\n        if ($column['CHARACTER_MAXIMUM_LENGTH'] < 500) {\r\n            echo \"<h3>Açıklama alanı 500 karaktere güncelleniyor...</h3>\";\r\n            \r\n            // Açıklama alanını NVARCHAR(500) olarak güncelle\r\n            $updateSql = \"ALTER TABLE hakedis_tanim ALTER COLUMN aciklama NVARCHAR(500) NULL\";\r\n            $conn->exec($updateSql);\r\n            \r\n            echo \"<div style='color: green; font-weight: bold;'>✓ Açıklama alanı başarıyla NVARCHAR(500) olarak güncellendi!</div>\";\r\n            \r\n            // Güncel durumu kontrol et\r\n            $stmt->execute();\r\n            $updatedColumn = $stmt->fetch();\r\n            echo \"<br><h3>Güncellenmiş açıklama alanı bilgileri:</h3>\";\r\n            echo \"Veri tipi: \" . $updatedColumn['DATA_TYPE'] . \"<br>\";\r\n            echo \"Maksimum uzunluk: \" . ($updatedColumn['CHARACTER_MAXIMUM_LENGTH'] ?? 'NULL') . \"<br>\";\r\n        } else {\r\n            echo \"<div style='color: blue; font-weight: bold;'>✓ Açıklama alanı zaten yeterli boyutta (\" . $column['CHARACTER_MAXIMUM_LENGTH'] . \" karakter)</div>\";\r\n        }\r\n    } else {\r\n        echo \"<div style='color: red; font-weight: bold;'>❌ Açıklama alanı bulunamadı! Tablo mevcut mu?</div>\";\r\n        \r\n        // Tablo var mı kontrol et\r\n        $tableCheckSql = \"SELECT COUNT(*) as count FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'hakedis_tanim'\";\r\n        $tableStmt = $conn->prepare($tableCheckSql);\r\n        $tableStmt->execute();\r\n        $tableExists = $tableStmt->fetch();\r\n        \r\n        if ($tableExists['count'] == 0) {\r\n            echo \"<br><div style='color: orange;'>Tablo mevcut değil. Tablo oluşturuluyor...</div>\";\r\n            $db->createHakedisTanimTable();\r\n            echo \"<div style='color: green;'>✓ Hakediş tanım tablosu oluşturuldu!</div>\";\r\n        }\r\n    }\r\n    \r\n    echo \"<br><hr><br>\";\r\n    echo \"<h3>İşlem tamamlandı!</h3>\";\r\n    echo \"<p>Bu sayfayı kapatabilir ve <a href='bayi_hakedis_tanimla.php'>Hakediş Tanımlama</a> sayfasına dönebilirsiniz.</p>\";\r\n    \r\n} catch (Exception $e) {\r\n    echo \"<div style='color: red; font-weight: bold;'>❌ Hata: \" . $e->getMessage() . \"</div>\";\r\n}\r\n?>"
        }
    ]
}