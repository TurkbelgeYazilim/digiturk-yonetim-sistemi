{
    "sourceFile": "debug_user_groups.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1760603608285,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1760603608285,
            "name": "Commit-0",
            "content": "<?php\r\n// Debug için geçici dosya - user_groups.php sorununu tespit etmek için\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\n\r\necho \"<h1>User Groups Debug</h1>\";\r\n\r\ntry {\r\n    require_once 'config/mssql.php';\r\n    $config = include 'config/mssql.php';\r\n    \r\n    echo \"<h2>1. Veritabanı Bağlantısı Test</h2>\";\r\n    \r\n    $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n    echo \"DSN: \" . $dsn . \"<br>\";\r\n    \r\n    $pdo = new PDO($dsn, $config['username'], $config['password'], [\r\n        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n        PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n        PDO::ATTR_EMULATE_PREPARES => false\r\n    ]);\r\n    \r\n    echo \"✅ Veritabanı bağlantısı başarılı<br><br>\";\r\n    \r\n    echo \"<h2>2. User Groups Tablosu Test</h2>\";\r\n    \r\n    // Mevcut grupları listele\r\n    $stmt = $pdo->query(\"SELECT * FROM user_groups ORDER BY id\");\r\n    $groups = $stmt->fetchAll();\r\n    \r\n    echo \"Toplam grup sayısı: \" . count($groups) . \"<br>\";\r\n    \r\n    if (!empty($groups)) {\r\n        echo \"<table border='1' style='border-collapse: collapse; margin: 10px 0;'>\";\r\n        echo \"<tr><th>ID</th><th>Grup Adı</th><th>Açıklama</th><th>İzinler</th><th>Oluşturma</th></tr>\";\r\n        foreach ($groups as $group) {\r\n            echo \"<tr>\";\r\n            echo \"<td>\" . $group['id'] . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($group['group_name']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($group['group_description'] ?? '-') . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($group['permissions'] ?? '[]') . \"</td>\";\r\n            echo \"<td>\" . $group['created_at'] . \"</td>\";\r\n            echo \"</tr>\";\r\n        }\r\n        echo \"</table>\";\r\n    }\r\n    \r\n    echo \"<h2>3. POST İşlemi Test</h2>\";\r\n    \r\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n        echo \"POST verisi alındı:<br>\";\r\n        echo \"<pre>\";\r\n        print_r($_POST);\r\n        echo \"</pre>\";\r\n        \r\n        if (isset($_POST['action'])) {\r\n            switch ($_POST['action']) {\r\n                case 'test_add':\r\n                    echo \"<h3>Grup Ekleme Testi</h3>\";\r\n                    \r\n                    $groupName = trim($_POST['group_name']);\r\n                    $description = trim($_POST['group_description']);\r\n                    $permissions = $_POST['permissions'] ?? [];\r\n                    \r\n                    echo \"Grup Adı: \" . htmlspecialchars($groupName) . \"<br>\";\r\n                    echo \"Açıklama: \" . htmlspecialchars($description) . \"<br>\";\r\n                    echo \"İzinler: \" . json_encode($permissions) . \"<br>\";\r\n                    \r\n                    if (empty($groupName)) {\r\n                        echo \"❌ Grup adı boş!<br>\";\r\n                    } else {\r\n                        $permissionsJson = json_encode($permissions);\r\n                        \r\n                        $stmt = $pdo->prepare(\"\r\n                            INSERT INTO user_groups (group_name, group_description, permissions, created_at) \r\n                            VALUES (?, ?, ?, GETDATE())\r\n                        \");\r\n                        \r\n                        try {\r\n                            $result = $stmt->execute([$groupName, $description, $permissionsJson]);\r\n                            \r\n                            if ($result) {\r\n                                echo \"✅ Grup başarıyla eklendi! ID: \" . $pdo->lastInsertId() . \"<br>\";\r\n                            } else {\r\n                                echo \"❌ Grup eklenemedi!<br>\";\r\n                            }\r\n                        } catch (Exception $e) {\r\n                            echo \"❌ SQL Hatası: \" . $e->getMessage() . \"<br>\";\r\n                        }\r\n                    }\r\n                    break;\r\n                    \r\n                case 'test_edit':\r\n                    echo \"<h3>Grup Düzenleme Testi</h3>\";\r\n                    \r\n                    $id = (int)$_POST['id'];\r\n                    $groupName = trim($_POST['group_name']);\r\n                    $description = trim($_POST['group_description']);\r\n                    $permissions = $_POST['permissions'] ?? [];\r\n                    \r\n                    echo \"ID: \" . $id . \"<br>\";\r\n                    echo \"Grup Adı: \" . htmlspecialchars($groupName) . \"<br>\";\r\n                    echo \"Açıklama: \" . htmlspecialchars($description) . \"<br>\";\r\n                    echo \"İzinler: \" . json_encode($permissions) . \"<br>\";\r\n                    \r\n                    if (empty($groupName)) {\r\n                        echo \"❌ Grup adı boş!<br>\";\r\n                    } else {\r\n                        $permissionsJson = json_encode($permissions);\r\n                        \r\n                        $stmt = $pdo->prepare(\"\r\n                            UPDATE user_groups \r\n                            SET group_name = ?, group_description = ?, permissions = ?, updated_at = GETDATE() \r\n                            WHERE id = ?\r\n                        \");\r\n                        \r\n                        try {\r\n                            $result = $stmt->execute([$groupName, $description, $permissionsJson, $id]);\r\n                            \r\n                            if ($result) {\r\n                                echo \"✅ Grup başarıyla güncellendi!<br>\";\r\n                            } else {\r\n                                echo \"❌ Grup güncellenemedi!<br>\";\r\n                            }\r\n                        } catch (Exception $e) {\r\n                            echo \"❌ SQL Hatası: \" . $e->getMessage() . \"<br>\";\r\n                        }\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    \r\n    echo \"<h2>4. Test Formları</h2>\";\r\n    \r\n    // Mevcut izinler listesi\r\n    $availablePermissions = [\r\n        'users_view' => 'Kullanıcıları Görüntüleme',\r\n        'users_add' => 'Kullanıcı Ekleme',\r\n        'users_edit' => 'Kullanıcı Düzenleme',\r\n        'users_delete' => 'Kullanıcı Silme',\r\n        'reports_view' => 'Raporları Görüntüleme',\r\n        'reports_export' => 'Rapor Dışa Aktarma',\r\n        'system_settings' => 'Sistem Ayarları',\r\n        'user_groups_manage' => 'Kullanıcı Grupları Yönetimi'\r\n    ];\r\n    \r\n    ?>\r\n    \r\n    <form method=\"POST\" style=\"border: 1px solid #ccc; padding: 15px; margin: 10px 0;\">\r\n        <h3>Grup Ekleme Testi</h3>\r\n        <input type=\"hidden\" name=\"action\" value=\"test_add\">\r\n        \r\n        <label>Grup Adı:</label><br>\r\n        <input type=\"text\" name=\"group_name\" required style=\"width: 300px; margin-bottom: 10px;\"><br>\r\n        \r\n        <label>Açıklama:</label><br>\r\n        <textarea name=\"group_description\" style=\"width: 300px; height: 60px; margin-bottom: 10px;\"></textarea><br>\r\n        \r\n        <label>İzinler:</label><br>\r\n        <?php foreach ($availablePermissions as $key => $label): ?>\r\n            <input type=\"checkbox\" name=\"permissions[]\" value=\"<?php echo $key; ?>\" id=\"add_<?php echo $key; ?>\">\r\n            <label for=\"add_<?php echo $key; ?>\"><?php echo $label; ?></label><br>\r\n        <?php endforeach; ?>\r\n        \r\n        <button type=\"submit\" style=\"margin-top: 10px; padding: 8px 15px;\">Grup Ekle</button>\r\n    </form>\r\n    \r\n    <?php if (!empty($groups)): ?>\r\n    <form method=\"POST\" style=\"border: 1px solid #ccc; padding: 15px; margin: 10px 0;\">\r\n        <h3>Grup Düzenleme Testi</h3>\r\n        <input type=\"hidden\" name=\"action\" value=\"test_edit\">\r\n        \r\n        <label>Düzenlenecek Grup:</label><br>\r\n        <select name=\"id\" required style=\"margin-bottom: 10px;\">\r\n            <?php foreach ($groups as $group): ?>\r\n                <option value=\"<?php echo $group['id']; ?>\"><?php echo htmlspecialchars($group['group_name']); ?></option>\r\n            <?php endforeach; ?>\r\n        </select><br>\r\n        \r\n        <label>Yeni Grup Adı:</label><br>\r\n        <input type=\"text\" name=\"group_name\" required style=\"width: 300px; margin-bottom: 10px;\"><br>\r\n        \r\n        <label>Yeni Açıklama:</label><br>\r\n        <textarea name=\"group_description\" style=\"width: 300px; height: 60px; margin-bottom: 10px;\"></textarea><br>\r\n        \r\n        <label>Yeni İzinler:</label><br>\r\n        <?php foreach ($availablePermissions as $key => $label): ?>\r\n            <input type=\"checkbox\" name=\"permissions[]\" value=\"<?php echo $key; ?>\" id=\"edit_<?php echo $key; ?>\">\r\n            <label for=\"edit_<?php echo $key; ?>\"><?php echo $label; ?></label><br>\r\n        <?php endforeach; ?>\r\n        \r\n        <button type=\"submit\" style=\"margin-top: 10px; padding: 8px 15px;\">Grup Güncelle</button>\r\n    </form>\r\n    <?php endif; ?>\r\n    \r\n    <?php\r\n    \r\n} catch (Exception $e) {\r\n    echo \"❌ Hata: \" . $e->getMessage() . \"<br>\";\r\n    echo \"Hata satırı: \" . $e->getLine() . \"<br>\";\r\n    echo \"Hata dosyası: \" . $e->getFile() . \"<br>\";\r\n}\r\n?>"
        }
    ]
}