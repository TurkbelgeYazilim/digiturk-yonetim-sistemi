{
    "sourceFile": "index.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1758983725164,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759329665667,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,14 +9,37 @@\n $currentUser = checkAuth();\r\n checkUserStatus();\r\n updateLastActivity();\r\n \r\n-// Veritabanı bağlantısı\r\n-require_once 'MSSQLConnection.php';\r\n+// Veritabanı bağlantı fonksiyonu\r\n+function getDatabaseConnection() {\r\n+    $configFile = __DIR__ . '/config/mssql.php';\r\n+    \r\n+    if (!file_exists($configFile)) {\r\n+        throw new Exception('Veritabanı konfigürasyon dosyası bulunamadı: ' . $configFile);\r\n+    }\r\n+    \r\n+    $config = include $configFile;\r\n+    \r\n+    try {\r\n+        $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n+        \r\n+        $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n+            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n+            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n+            PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n+            PDO::ATTR_EMULATE_PREPARES => false\r\n+        ]);\r\n+        \r\n+        return $connection;\r\n+        \r\n+    } catch (PDOException $e) {\r\n+        throw new Exception('Veritabanı bağlantı hatası: ' . $e->getMessage());\r\n+    }\r\n+}\r\n \r\n try {\r\n-    $db = new MSSQLConnection();\r\n-    $conn = $db->getConnection();\r\n+    $conn = getDatabaseConnection();\r\n     \r\n     // Genel istatistikler\r\n     $stats = [];\r\n     \r\n"
                },
                {
                    "date": 1760976814714,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,285 +9,174 @@\n $currentUser = checkAuth();\r\n checkUserStatus();\r\n updateLastActivity();\r\n \r\n-// Veritabanı bağlantı fonksiyonu\r\n-function getDatabaseConnection() {\r\n-    $configFile = __DIR__ . '/config/mssql.php';\r\n-    \r\n-    if (!file_exists($configFile)) {\r\n-        throw new Exception('Veritabanı konfigürasyon dosyası bulunamadı: ' . $configFile);\r\n-    }\r\n-    \r\n-    $config = include $configFile;\r\n-    \r\n-    try {\r\n-        $dsn = \"sqlsrv:Server={$config['host']};Database={$config['database']};TrustServerCertificate=yes\";\r\n-        \r\n-        $connection = new PDO($dsn, $config['username'], $config['password'], [\r\n-            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\r\n-            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\r\n-            PDO::SQLSRV_ATTR_ENCODING => PDO::SQLSRV_ENCODING_UTF8,\r\n-            PDO::ATTR_EMULATE_PREPARES => false\r\n-        ]);\r\n-        \r\n-        return $connection;\r\n-        \r\n-    } catch (PDOException $e) {\r\n-        throw new Exception('Veritabanı bağlantı hatası: ' . $e->getMessage());\r\n-    }\r\n-}\r\n-\r\n-try {\r\n-    $conn = getDatabaseConnection();\r\n-    \r\n-    // Genel istatistikler\r\n-    $stats = [];\r\n-    \r\n-    // Toplam kayıt sayısı\r\n-    $sql = \"SELECT COUNT(*) as total FROM iris_rapor\";\r\n-    $stmt = $conn->prepare($sql);\r\n-    $stmt->execute();\r\n-    $stats['total_records'] = $stmt->fetch(PDO::FETCH_ASSOC)['total'];\r\n-    \r\n-    // Bu ayki kayıtlar\r\n-    $sql = \"SELECT COUNT(*) as monthly FROM iris_rapor WHERE MONTH(MEMO_KAPANIS_TARIHI) = MONTH(GETDATE()) AND YEAR(MEMO_KAPANIS_TARIHI) = YEAR(GETDATE())\";\r\n-    $stmt = $conn->prepare($sql);\r\n-    $stmt->execute();\r\n-    $stats['monthly_records'] = $stmt->fetch(PDO::FETCH_ASSOC)['monthly'];\r\n-    \r\n-    // Toplam alt bayi sayısı\r\n-    $sql = \"SELECT COUNT(DISTINCT TALEBI_GIREN_PERSONEL_ALTBAYI) as total FROM iris_rapor WHERE TALEBI_GIREN_PERSONEL_ALTBAYI IS NOT NULL AND TALEBI_GIREN_PERSONEL_ALTBAYI != ''\";\r\n-    $stmt = $conn->prepare($sql);\r\n-    $stmt->execute();\r\n-    $stats['total_dealers'] = $stmt->fetch(PDO::FETCH_ASSOC)['total'];\r\n-    \r\n-    // Hizmet dağılımı\r\n-    $sql = \"SELECT \r\n-                MEMO_KAYIT_TIPI,\r\n-                COUNT(*) as count\r\n-            FROM iris_rapor \r\n-            WHERE MEMO_KAYIT_TIPI IN ('ISP', 'NEO', 'UYDU', 'BAGLANTI', 'SATIS', 'TEKNIK', 'IPTAL')\r\n-            GROUP BY MEMO_KAYIT_TIPI\r\n-            ORDER BY count DESC\";\r\n-    $stmt = $conn->prepare($sql);\r\n-    $stmt->execute();\r\n-    $techStats = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n-    \r\n-    // Toplam kullanıcı sayısı (admin ise)\r\n-    if ($currentUser['group_name'] === 'admin') {\r\n-        $sql = \"SELECT COUNT(*) as total FROM users WHERE status = 'AKTIF'\";\r\n-        $stmt = $conn->prepare($sql);\r\n-        $stmt->execute();\r\n-        $stats['total_users'] = $stmt->fetch(PDO::FETCH_ASSOC)['total'];\r\n-    }\r\n-    \r\n-} catch (Exception $e) {\r\n-    $error = \"Veritabanı hatası: \" . $e->getMessage();\r\n-}\r\n-\r\n include 'includes/header.php';\r\n ?>\r\n \r\n <div class=\"container-fluid mt-4\">\r\n-    <!-- İstatistik Kartları -->\r\n+    <!-- Hoş Geldiniz -->\r\n     <div class=\"row mb-4\">\r\n-        <div class=\"col-md-3\">\r\n+        <div class=\"col-12\">\r\n             <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-body text-center\">\r\n-                    <div class=\"text-primary mb-3\">\r\n-                        <i class=\"fas fa-database fa-3x\"></i>\r\n-                    </div>\r\n-                    <h3 class=\"text-primary\"><?php echo number_format($stats['total_records'] ?? 0); ?></h3>\r\n-                    <p class=\"text-muted mb-0\">Toplam Adet</p>\r\n+                <div class=\"card-body text-center py-5\">\r\n+                    <h1 class=\"display-4 text-primary mb-3\">\r\n+                        <i class=\"fas fa-chart-line me-3\"></i>Digiturk Rapor Sistemi\r\n+                    </h1>\r\n+                    <p class=\"lead text-muted\">\r\n+                        Hoş geldiniz, <strong><?php echo htmlspecialchars($currentUser['name']); ?></strong>\r\n+                    </p>\r\n+                    <p class=\"text-muted\">\r\n+                        Yetki seviyeniz: <span class=\"badge bg-primary\"><?php \r\n+                        switch($currentUser['group_name']) {\r\n+                            case 'admin': echo 'Admin'; break;\r\n+                            case 'bolge_yoneticisi': echo 'Bölge Yöneticisi'; break;\r\n+                            case 'bayi': echo 'Bayi'; break;\r\n+                            default: echo 'Kullanıcı'; break;\r\n+                        }\r\n+                        ?></span>\r\n+                    </p>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n-        \r\n-        <div class=\"col-md-3\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-body text-center\">\r\n-                    <div class=\"text-success mb-3\">\r\n-                        <i class=\"fas fa-calendar-alt fa-3x\"></i>\r\n-                    </div>\r\n-                    <h3 class=\"text-success\"><?php echo number_format($stats['monthly_records'] ?? 0); ?></h3>\r\n-                    <p class=\"text-muted mb-0\">Bu Ayki Kayıt</p>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-        \r\n-        <div class=\"col-md-3\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-body text-center\">\r\n-                    <div class=\"text-info mb-3\">\r\n-                        <i class=\"fas fa-users fa-3x\"></i>\r\n-                    </div>\r\n-                    <h3 class=\"text-info\"><?php echo number_format($stats['total_dealers'] ?? 0); ?></h3>\r\n-                    <p class=\"text-muted mb-0\">Alt Bayi</p>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-        \r\n-        <?php if (isset($stats['total_users'])): ?>\r\n-        <div class=\"col-md-3\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-body text-center\">\r\n-                    <div class=\"text-warning mb-3\">\r\n-                        <i class=\"fas fa-user-shield fa-3x\"></i>\r\n-                    </div>\r\n-                    <h3 class=\"text-warning\"><?php echo number_format($stats['total_users']); ?></h3>\r\n-                    <p class=\"text-muted mb-0\">Aktif Kullanıcı</p>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-        <?php endif; ?>\r\n     </div>\r\n \r\n     <div class=\"row\">\r\n         <!-- Hızlı Erişim -->\r\n-        <div class=\"col-md-6 mb-4\">\r\n+        <div class=\"col-md-8 mb-4\">\r\n             <div class=\"card border-0 shadow-sm\">\r\n                 <div class=\"card-header bg-primary text-white\">\r\n                     <h5 class=\"mb-0\">\r\n                         <i class=\"fas fa-bolt me-2\"></i>Hızlı Erişim\r\n                     </h5>\r\n                 </div>\r\n                 <div class=\"card-body\">\r\n                     <div class=\"row g-3\">\r\n-                        <div class=\"col-6\">\r\n-                            <a href=\"hakedis_hesapla.php\" class=\"btn btn-outline-primary w-100 py-3\">\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n                                 <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n-                                Hakediş Hesaplama\r\n+                                <small>Hakediş Hesaplama</small>\r\n                             </a>\r\n                         </div>\r\n-                        <div class=\"col-6\">\r\n-                            <a href=\"upload_iris_final.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n-                                <i class=\"fas fa-upload fa-2x d-block mb-2\"></i>\r\n-                                Dosya Yükleme\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_hakedis_tanimla.php\" class=\"btn btn-outline-info w-100 py-3\">\r\n+                                <i class=\"fas fa-cog fa-2x d-block mb-2\"></i>\r\n+                                <small>Hakediş Tanımlama</small>\r\n                             </a>\r\n                         </div>\r\n-                        <div class=\"col-6\">\r\n-                            <a href=\"list_uploads.php\" class=\"btn btn-outline-info w-100 py-3\">\r\n-                                <i class=\"fas fa-list fa-2x d-block mb-2\"></i>\r\n-                                Yükleme Listesi\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"primebaz_rapor_yukle.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n+                                <i class=\"fas fa-file-excel fa-2x d-block mb-2\"></i>\r\n+                                <small>Primebaz Rapor</small>\r\n                             </a>\r\n                         </div>\r\n+                        \r\n                         <?php if ($currentUser['group_name'] === 'admin'): ?>\r\n-                        <div class=\"col-6\">\r\n-                            <a href=\"users.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n-                                <i class=\"fas fa-users-cog fa-2x d-block mb-2\"></i>\r\n-                                Kullanıcı Yönetimi\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_hakedis_tanimla.php\" class=\"btn btn-outline-primary w-100 py-3\">\r\n+                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n+                                <small>Hakediş Tanımlama</small>\r\n                             </a>\r\n                         </div>\r\n-                        <div class=\"col-6\">\r\n-                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n+                                <i class=\"fas fa-coins fa-2x d-block mb-2\"></i>\r\n+                                <small>Hakediş Hesaplama</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-danger w-100 py-3\">\r\n                                 <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n-                                Ödeme Yönetimi\r\n+                                <small>Ödeme Yönetimi</small>\r\n                             </a>\r\n                         </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"users.php\" class=\"btn btn-outline-secondary w-100 py-3\">\r\n+                                <i class=\"fas fa-users-cog fa-2x d-block mb-2\"></i>\r\n+                                <small>Kullanıcı Yönetimi</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"user_groups.php\" class=\"btn btn-outline-dark w-100 py-3\">\r\n+                                <i class=\"fas fa-layer-group fa-2x d-block mb-2\"></i>\r\n+                                <small>Grup Yönetimi</small>\r\n+                            </a>\r\n+                        </div>\r\n                         <?php endif; ?>\r\n                     </div>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n \r\n-        <!-- Hizmet Dağılımı -->\r\n-        <div class=\"col-md-6 mb-4\">\r\n+        <!-- Sistem Bilgileri -->\r\n+        <div class=\"col-md-4 mb-4\">\r\n             <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-header bg-info text-white\">\r\n+                <div class=\"card-header bg-success text-white\">\r\n                     <h5 class=\"mb-0\">\r\n-                        <i class=\"fas fa-chart-pie me-2\"></i>Hizmet Dağılımı\r\n+                        <i class=\"fas fa-info-circle me-2\"></i>Sistem Bilgileri\r\n                     </h5>\r\n                 </div>\r\n                 <div class=\"card-body\">\r\n-                    <?php if (!empty($techStats)): ?>\r\n-                        <?php\r\n-                        $totalTech = array_sum(array_column($techStats, 'count'));\r\n-                        foreach ($techStats as $tech):\r\n-                            $percentage = $totalTech > 0 ? round(($tech['count'] / $totalTech) * 100, 1) : 0;\r\n-                            $colorClass = '';\r\n-                            switch ($tech['MEMO_KAYIT_TIPI']) {\r\n-                                case 'ISP': $colorClass = 'bg-primary'; break;\r\n-                                case 'NEO': $colorClass = 'bg-success'; break;\r\n-                                case 'UYDU': $colorClass = 'bg-info'; break;\r\n-                                case 'BAGLANTI': $colorClass = 'bg-warning'; break;\r\n-                                case 'SATIS': $colorClass = 'bg-danger'; break;\r\n-                                case 'TEKNIK': $colorClass = 'bg-secondary'; break;\r\n-                                case 'IPTAL': $colorClass = 'bg-dark'; break;\r\n-                                default: $colorClass = 'bg-light'; break;\r\n-                            }\r\n-                        ?>\r\n-                            <div class=\"d-flex justify-content-between align-items-center mb-2\">\r\n-                                <span class=\"fw-medium\"><?php echo htmlspecialchars($tech['MEMO_KAYIT_TIPI']); ?></span>\r\n-                                <div class=\"text-end\">\r\n-                                    <span class=\"badge <?php echo $colorClass; ?> me-2\">\r\n-                                        <?php echo number_format($tech['count']); ?>\r\n-                                    </span>\r\n-                                    <small class=\"text-muted\">%<?php echo $percentage; ?></small>\r\n-                                </div>\r\n-                            </div>\r\n-                            <div class=\"progress mb-3\" style=\"height: 8px;\">\r\n-                                <div class=\"progress-bar <?php echo $colorClass; ?>\" \r\n-                                     style=\"width: <?php echo $percentage; ?>%\"></div>\r\n-                            </div>\r\n-                        <?php endforeach; ?>\r\n-                    <?php else: ?>\r\n-                        <div class=\"text-center py-4 text-muted\">\r\n-                            <i class=\"fas fa-chart-pie fa-3x mb-3 d-block\"></i>\r\n-                            <p>Henüz hizmet verisi bulunmuyor.</p>\r\n-                        </div>\r\n-                    <?php endif; ?>\r\n+                    <ul class=\"list-unstyled mb-0\">\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-server me-2 text-primary\"></i>\r\n+                            <strong>PHP:</strong> <?php echo PHP_VERSION; ?>\r\n+                        </li>\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-database me-2 text-success\"></i>\r\n+                            <strong>Veritabanı:</strong> SQL Server\r\n+                        </li>\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-clock me-2 text-info\"></i>\r\n+                            <strong>Tarih:</strong> <?php echo date('d.m.Y H:i:s'); ?>\r\n+                        </li>\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-user me-2 text-warning\"></i>\r\n+                            <strong>Kullanıcı:</strong> <?php echo htmlspecialchars($currentUser['name']); ?>\r\n+                        </li>\r\n+                        <li class=\"mb-0\">\r\n+                            <i class=\"fas fa-envelope me-2 text-secondary\"></i>\r\n+                            <strong>E-posta:</strong> <?php echo htmlspecialchars($currentUser['email']); ?>\r\n+                        </li>\r\n+                    </ul>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n \r\n-    <!-- Son Aktiviteler (Örnek) -->\r\n+    <!-- Yardım ve Dokümantasyon -->\r\n     <div class=\"row\">\r\n         <div class=\"col-12\">\r\n             <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-header bg-success text-white\">\r\n+                <div class=\"card-header bg-info text-white\">\r\n                     <h5 class=\"mb-0\">\r\n-                        <i class=\"fas fa-history me-2\"></i>Sistem Bilgileri\r\n+                        <i class=\"fas fa-question-circle me-2\"></i>Yardım ve Kullanım\r\n                     </h5>\r\n                 </div>\r\n                 <div class=\"card-body\">\r\n                     <div class=\"row\">\r\n                         <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-muted\">Sunucu Bilgileri</h6>\r\n-                            <ul class=\"list-unstyled\">\r\n-                                <li><i class=\"fas fa-server me-2 text-primary\"></i>PHP Versiyonu: <?php echo PHP_VERSION; ?></li>\r\n-                                <li><i class=\"fas fa-database me-2 text-success\"></i>Veritabanı: SQL Server</li>\r\n-                                <li><i class=\"fas fa-clock me-2 text-info\"></i>Sunucu Saati: <?php echo date('d.m.Y H:i:s'); ?></li>\r\n-                            </ul>\r\n+                            <h6 class=\"text-primary\">Hakediş Hesaplama</h6>\r\n+                            <p class=\"text-muted small\">\r\n+                                Bayi hakediş hesaplamalarını görüntüleyebilir ve detaylı raporlara erişebilirsiniz.\r\n+                            </p>\r\n                         </div>\r\n                         <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-muted\">Sistem Durumu</h6>\r\n-                            <ul class=\"list-unstyled\">\r\n-                                <li><i class=\"fas fa-check-circle me-2 text-success\"></i>Veritabanı Bağlantısı: Aktif</li>\r\n-                                <li><i class=\"fas fa-check-circle me-2 text-success\"></i>Login Sistemi: Aktif</li>\r\n-                                <li><i class=\"fas fa-check-circle me-2 text-success\"></i>Dosya Yükleme: Aktif</li>\r\n-                            </ul>\r\n+                            <h6 class=\"text-success\">Hakediş Tanımlama</h6>\r\n+                            <p class=\"text-muted small\">\r\n+                                Hakediş prim dönemleri ve oranlarını tanımlayabilir, düzenleyebilirsiniz.\r\n+                            </p>\r\n                         </div>\r\n                         <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-muted\">Kullanıcı Bilgileri</h6>\r\n-                            <ul class=\"list-unstyled\">\r\n-                                <li><i class=\"fas fa-user me-2 text-primary\"></i>Kullanıcı: <?php echo htmlspecialchars($currentUser['name']); ?></li>\r\n-                                <li><i class=\"fas fa-envelope me-2 text-info\"></i>E-posta: <?php echo htmlspecialchars($currentUser['email']); ?></li>\r\n-                                <li><i class=\"fas fa-shield-alt me-2 text-warning\"></i>Yetki: <?php \r\n-                                switch($currentUser['group_name']) {\r\n-                                    case 'admin': echo 'Admin'; break;\r\n-                                    case 'bolge_yoneticisi': echo 'Bölge Yöneticisi'; break;\r\n-                                    case 'bayi': echo 'Bayi'; break;\r\n-                                    default: echo 'Kullanıcı'; break;\r\n-                                }\r\n-                                ?></li>\r\n-                            </ul>\r\n+                            <h6 class=\"text-warning\">Primebaz Rapor</h6>\r\n+                            <p class=\"text-muted small\">\r\n+                                Primebaz raporlarını sisteme yükleyebilir ve analiz yapabilirsiniz.\r\n+                            </p>\r\n                         </div>\r\n                     </div>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n </div>\r\n \r\n-<?php include 'includes/footer.php'; ?>\r\n+<?php include 'includes/footer.php'; ?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1760976876130,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,11 +63,11 @@\n                                 <small>Hakediş Tanımlama</small>\r\n                             </a>\r\n                         </div>\r\n                         <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"primebaz_rapor_yukle.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n-                                <i class=\"fas fa-file-excel fa-2x d-block mb-2\"></i>\r\n-                                <small>Primebaz Rapor</small>\r\n+                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n+                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n+                                <small>Ödeme Yönetimi</small>\r\n                             </a>\r\n                         </div>\r\n                         \r\n                         <?php if ($currentUser['group_name'] === 'admin'): ?>\r\n@@ -166,11 +166,11 @@\n                                 Hakediş prim dönemleri ve oranlarını tanımlayabilir, düzenleyebilirsiniz.\r\n                             </p>\r\n                         </div>\r\n                         <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-warning\">Primebaz Rapor</h6>\r\n+                            <h6 class=\"text-warning\">Ödeme Yönetimi</h6>\r\n                             <p class=\"text-muted small\">\r\n-                                Primebaz raporlarını sisteme yükleyebilir ve analiz yapabilirsiniz.\r\n+                                Bayi ödemelerini takip edebilir, ödeme planları oluşturabilir ve yönetebilirsiniz.\r\n                             </p>\r\n                         </div>\r\n                     </div>\r\n                 </div>\r\n"
                },
                {
                    "date": 1760976900395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,14 +26,9 @@\n                         Hoş geldiniz, <strong><?php echo htmlspecialchars($currentUser['name']); ?></strong>\r\n                     </p>\r\n                     <p class=\"text-muted\">\r\n                         Yetki seviyeniz: <span class=\"badge bg-primary\"><?php \r\n-                        switch($currentUser['group_name']) {\r\n-                            case 'admin': echo 'Admin'; break;\r\n-                            case 'bolge_yoneticisi': echo 'Bölge Yöneticisi'; break;\r\n-                            case 'bayi': echo 'Bayi'; break;\r\n-                            default: echo 'Kullanıcı'; break;\r\n-                        }\r\n+                        echo htmlspecialchars($currentUser['group_name'] ?? 'Kullanıcı');\r\n                         ?></span>\r\n                     </p>\r\n                 </div>\r\n             </div>\r\n"
                },
                {
                    "date": 1761062397206,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,177 @@\n+<?php\r\n+$pageTitle = \"Ana Sayfa\";\r\n+$breadcrumbs = [\r\n+    ['title' => 'Ana Sayfa']\r\n+];\r\n+\r\n+// Auth kontrol\r\n+require_once 'auth.php';\r\n+$currentUser = checkAuth();\r\n+checkUserStatus();\r\n+updateLastActivity();\r\n+\r\n+include 'includes/header.php';\r\n+?>\r\n+\r\n+<div class=\"container-fluid mt-4\">\r\n+    <!-- Hoş Geldiniz -->\r\n+    <div class=\"row mb-4\">\r\n+        <div class=\"col-12\">\r\n+            <div class=\"card border-0 shadow-sm\">\r\n+                <div class=\"card-body text-center py-5\">\r\n+                    <h1 class=\"display-4 text-primary mb-3\">\r\n+                        <i class=\"fas fa-chart-line me-3\"></i>Digiturk Rapor Sistemi\r\n+                    </h1>\r\n+                    <p class=\"lead text-muted\">\r\n+                        Hoş geldiniz, <strong><?php echo htmlspecialchars($currentUser['name']); ?></strong>\r\n+                    </p>\r\n+                    <p class=\"text-muted\">\r\n+                        Yetki seviyeniz: <span class=\"badge bg-primary\"><?php \r\n+                        echo htmlspecialchars($currentUser['group_name'] ?? 'Kullanıcı');\r\n+                        ?></span>\r\n+                    </p>\r\n+                </div>\r\n+            </div>\r\n+        </div>\r\n+    </div>\r\n+\r\n+    <div class=\"row\">\r\n+        <!-- Hızlı Erişim -->\r\n+        <div class=\"col-md-8 mb-4\">\r\n+            <div class=\"card border-0 shadow-sm\">\r\n+                <div class=\"card-header bg-primary text-white\">\r\n+                    <h5 class=\"mb-0\">\r\n+                        <i class=\"fas fa-bolt me-2\"></i>Hızlı Erişim\r\n+                    </h5>\r\n+                </div>\r\n+                <div class=\"card-body\">\r\n+                    <div class=\"row g-3\">\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"views/Yonetim/Muhasebe/bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n+                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n+                                <small>Hakediş Hesaplama</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"views/Yonetim/Muhasebe/bayi_hakedis_tanimla.php\" class=\"btn btn-outline-info w-100 py-3\">\r\n+                                <i class=\"fas fa-cog fa-2x d-block mb-2\"></i>\r\n+                                <small>Hakediş Tanımlama</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"views/Yonetim/Muhasebe/bayi_odeme_yonetimi.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n+                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n+                                <small>Ödeme Yönetimi</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        \r\n+                        <?php if ($currentUser['group_name'] === 'admin'): ?>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_hakedis_tanimla.php\" class=\"btn btn-outline-primary w-100 py-3\">\r\n+                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n+                                <small>Hakediş Tanımlama</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n+                                <i class=\"fas fa-coins fa-2x d-block mb-2\"></i>\r\n+                                <small>Hakediş Hesaplama</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-danger w-100 py-3\">\r\n+                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n+                                <small>Ödeme Yönetimi</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"users.php\" class=\"btn btn-outline-secondary w-100 py-3\">\r\n+                                <i class=\"fas fa-users-cog fa-2x d-block mb-2\"></i>\r\n+                                <small>Kullanıcı Yönetimi</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <div class=\"col-md-4 col-6\">\r\n+                            <a href=\"user_groups.php\" class=\"btn btn-outline-dark w-100 py-3\">\r\n+                                <i class=\"fas fa-layer-group fa-2x d-block mb-2\"></i>\r\n+                                <small>Grup Yönetimi</small>\r\n+                            </a>\r\n+                        </div>\r\n+                        <?php endif; ?>\r\n+                    </div>\r\n+                </div>\r\n+            </div>\r\n+        </div>\r\n+\r\n+        <!-- Sistem Bilgileri -->\r\n+        <div class=\"col-md-4 mb-4\">\r\n+            <div class=\"card border-0 shadow-sm\">\r\n+                <div class=\"card-header bg-success text-white\">\r\n+                    <h5 class=\"mb-0\">\r\n+                        <i class=\"fas fa-info-circle me-2\"></i>Sistem Bilgileri\r\n+                    </h5>\r\n+                </div>\r\n+                <div class=\"card-body\">\r\n+                    <ul class=\"list-unstyled mb-0\">\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-server me-2 text-primary\"></i>\r\n+                            <strong>PHP:</strong> <?php echo PHP_VERSION; ?>\r\n+                        </li>\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-database me-2 text-success\"></i>\r\n+                            <strong>Veritabanı:</strong> SQL Server\r\n+                        </li>\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-clock me-2 text-info\"></i>\r\n+                            <strong>Tarih:</strong> <?php echo date('d.m.Y H:i:s'); ?>\r\n+                        </li>\r\n+                        <li class=\"mb-2\">\r\n+                            <i class=\"fas fa-user me-2 text-warning\"></i>\r\n+                            <strong>Kullanıcı:</strong> <?php echo htmlspecialchars($currentUser['name']); ?>\r\n+                        </li>\r\n+                        <li class=\"mb-0\">\r\n+                            <i class=\"fas fa-envelope me-2 text-secondary\"></i>\r\n+                            <strong>E-posta:</strong> <?php echo htmlspecialchars($currentUser['email']); ?>\r\n+                        </li>\r\n+                    </ul>\r\n+                </div>\r\n+            </div>\r\n+        </div>\r\n+    </div>\r\n+\r\n+    <!-- Yardım ve Dokümantasyon -->\r\n+    <div class=\"row\">\r\n+        <div class=\"col-12\">\r\n+            <div class=\"card border-0 shadow-sm\">\r\n+                <div class=\"card-header bg-info text-white\">\r\n+                    <h5 class=\"mb-0\">\r\n+                        <i class=\"fas fa-question-circle me-2\"></i>Yardım ve Kullanım\r\n+                    </h5>\r\n+                </div>\r\n+                <div class=\"card-body\">\r\n+                    <div class=\"row\">\r\n+                        <div class=\"col-md-4\">\r\n+                            <h6 class=\"text-primary\">Hakediş Hesaplama</h6>\r\n+                            <p class=\"text-muted small\">\r\n+                                Bayi hakediş hesaplamalarını görüntüleyebilir ve detaylı raporlara erişebilirsiniz.\r\n+                            </p>\r\n+                        </div>\r\n+                        <div class=\"col-md-4\">\r\n+                            <h6 class=\"text-success\">Hakediş Tanımlama</h6>\r\n+                            <p class=\"text-muted small\">\r\n+                                Hakediş prim dönemleri ve oranlarını tanımlayabilir, düzenleyebilirsiniz.\r\n+                            </p>\r\n+                        </div>\r\n+                        <div class=\"col-md-4\">\r\n+                            <h6 class=\"text-warning\">Ödeme Yönetimi</h6>\r\n+                            <p class=\"text-muted small\">\r\n+                                Bayi ödemelerini takip edebilir, ödeme planları oluşturabilir ve yönetebilirsiniz.\r\n+                            </p>\r\n+                        </div>\r\n+                    </div>\r\n+                </div>\r\n+            </div>\r\n+        </div>\r\n+    </div>\r\n+</div>\r\n+\r\n+<?php include 'includes/footer.php'; ?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1761062643902,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -136,219 +136,7 @@\n                 </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n-\r\n-    <!-- Yardım ve Dokümantasyon -->\r\n-    <div class=\"row\">\r\n-        <div class=\"col-12\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-header bg-info text-white\">\r\n-                    <h5 class=\"mb-0\">\r\n-                        <i class=\"fas fa-question-circle me-2\"></i>Yardım ve Kullanım\r\n-                    </h5>\r\n-                </div>\r\n-                <div class=\"card-body\">\r\n-                    <div class=\"row\">\r\n-                        <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-primary\">Hakediş Hesaplama</h6>\r\n-                            <p class=\"text-muted small\">\r\n-                                Bayi hakediş hesaplamalarını görüntüleyebilir ve detaylı raporlara erişebilirsiniz.\r\n-                            </p>\r\n-                        </div>\r\n-                        <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-success\">Hakediş Tanımlama</h6>\r\n-                            <p class=\"text-muted small\">\r\n-                                Hakediş prim dönemleri ve oranlarını tanımlayabilir, düzenleyebilirsiniz.\r\n-                            </p>\r\n-                        </div>\r\n-                        <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-warning\">Ödeme Yönetimi</h6>\r\n-                            <p class=\"text-muted small\">\r\n-                                Bayi ödemelerini takip edebilir, ödeme planları oluşturabilir ve yönetebilirsiniz.\r\n-                            </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-    </div>\r\n </div>\r\n \r\n-<?php include 'includes/footer.php'; ?>\n-<?php\r\n-$pageTitle = \"Ana Sayfa\";\r\n-$breadcrumbs = [\r\n-    ['title' => 'Ana Sayfa']\r\n-];\r\n-\r\n-// Auth kontrol\r\n-require_once 'auth.php';\r\n-$currentUser = checkAuth();\r\n-checkUserStatus();\r\n-updateLastActivity();\r\n-\r\n-include 'includes/header.php';\r\n-?>\r\n-\r\n-<div class=\"container-fluid mt-4\">\r\n-    <!-- Hoş Geldiniz -->\r\n-    <div class=\"row mb-4\">\r\n-        <div class=\"col-12\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-body text-center py-5\">\r\n-                    <h1 class=\"display-4 text-primary mb-3\">\r\n-                        <i class=\"fas fa-chart-line me-3\"></i>Digiturk Rapor Sistemi\r\n-                    </h1>\r\n-                    <p class=\"lead text-muted\">\r\n-                        Hoş geldiniz, <strong><?php echo htmlspecialchars($currentUser['name']); ?></strong>\r\n-                    </p>\r\n-                    <p class=\"text-muted\">\r\n-                        Yetki seviyeniz: <span class=\"badge bg-primary\"><?php \r\n-                        echo htmlspecialchars($currentUser['group_name'] ?? 'Kullanıcı');\r\n-                        ?></span>\r\n-                    </p>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-    </div>\r\n-\r\n-    <div class=\"row\">\r\n-        <!-- Hızlı Erişim -->\r\n-        <div class=\"col-md-8 mb-4\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-header bg-primary text-white\">\r\n-                    <h5 class=\"mb-0\">\r\n-                        <i class=\"fas fa-bolt me-2\"></i>Hızlı Erişim\r\n-                    </h5>\r\n-                </div>\r\n-                <div class=\"card-body\">\r\n-                    <div class=\"row g-3\">\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n-                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Hesaplama</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_hakedis_tanimla.php\" class=\"btn btn-outline-info w-100 py-3\">\r\n-                                <i class=\"fas fa-cog fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Tanımlama</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n-                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n-                                <small>Ödeme Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        \r\n-                        <?php if ($currentUser['group_name'] === 'admin'): ?>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_hakedis_tanimla.php\" class=\"btn btn-outline-primary w-100 py-3\">\r\n-                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Tanımlama</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n-                                <i class=\"fas fa-coins fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Hesaplama</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-danger w-100 py-3\">\r\n-                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n-                                <small>Ödeme Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"users.php\" class=\"btn btn-outline-secondary w-100 py-3\">\r\n-                                <i class=\"fas fa-users-cog fa-2x d-block mb-2\"></i>\r\n-                                <small>Kullanıcı Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"user_groups.php\" class=\"btn btn-outline-dark w-100 py-3\">\r\n-                                <i class=\"fas fa-layer-group fa-2x d-block mb-2\"></i>\r\n-                                <small>Grup Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <?php endif; ?>\r\n-                    </div>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-\r\n-        <!-- Sistem Bilgileri -->\r\n-        <div class=\"col-md-4 mb-4\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-header bg-success text-white\">\r\n-                    <h5 class=\"mb-0\">\r\n-                        <i class=\"fas fa-info-circle me-2\"></i>Sistem Bilgileri\r\n-                    </h5>\r\n-                </div>\r\n-                <div class=\"card-body\">\r\n-                    <ul class=\"list-unstyled mb-0\">\r\n-                        <li class=\"mb-2\">\r\n-                            <i class=\"fas fa-server me-2 text-primary\"></i>\r\n-                            <strong>PHP:</strong> <?php echo PHP_VERSION; ?>\r\n-                        </li>\r\n-                        <li class=\"mb-2\">\r\n-                            <i class=\"fas fa-database me-2 text-success\"></i>\r\n-                            <strong>Veritabanı:</strong> SQL Server\r\n-                        </li>\r\n-                        <li class=\"mb-2\">\r\n-                            <i class=\"fas fa-clock me-2 text-info\"></i>\r\n-                            <strong>Tarih:</strong> <?php echo date('d.m.Y H:i:s'); ?>\r\n-                        </li>\r\n-                        <li class=\"mb-2\">\r\n-                            <i class=\"fas fa-user me-2 text-warning\"></i>\r\n-                            <strong>Kullanıcı:</strong> <?php echo htmlspecialchars($currentUser['name']); ?>\r\n-                        </li>\r\n-                        <li class=\"mb-0\">\r\n-                            <i class=\"fas fa-envelope me-2 text-secondary\"></i>\r\n-                            <strong>E-posta:</strong> <?php echo htmlspecialchars($currentUser['email']); ?>\r\n-                        </li>\r\n-                    </ul>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-    </div>\r\n-\r\n-    <!-- Yardım ve Dokümantasyon -->\r\n-    <div class=\"row\">\r\n-        <div class=\"col-12\">\r\n-            <div class=\"card border-0 shadow-sm\">\r\n-                <div class=\"card-header bg-info text-white\">\r\n-                    <h5 class=\"mb-0\">\r\n-                        <i class=\"fas fa-question-circle me-2\"></i>Yardım ve Kullanım\r\n-                    </h5>\r\n-                </div>\r\n-                <div class=\"card-body\">\r\n-                    <div class=\"row\">\r\n-                        <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-primary\">Hakediş Hesaplama</h6>\r\n-                            <p class=\"text-muted small\">\r\n-                                Bayi hakediş hesaplamalarını görüntüleyebilir ve detaylı raporlara erişebilirsiniz.\r\n-                            </p>\r\n-                        </div>\r\n-                        <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-success\">Hakediş Tanımlama</h6>\r\n-                            <p class=\"text-muted small\">\r\n-                                Hakediş prim dönemleri ve oranlarını tanımlayabilir, düzenleyebilirsiniz.\r\n-                            </p>\r\n-                        </div>\r\n-                        <div class=\"col-md-4\">\r\n-                            <h6 class=\"text-warning\">Ödeme Yönetimi</h6>\r\n-                            <p class=\"text-muted small\">\r\n-                                Bayi ödemelerini takip edebilir, ödeme planları oluşturabilir ve yönetebilirsiniz.\r\n-                            </p>\r\n-                        </div>\r\n-                    </div>\r\n-                </div>\r\n-            </div>\r\n-        </div>\r\n-    </div>\r\n-</div>\r\n-\r\n <?php include 'includes/footer.php'; ?>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1761118426625,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -45,59 +45,88 @@\n                     </h5>\r\n                 </div>\r\n                 <div class=\"card-body\">\r\n                     <div class=\"row g-3\">\r\n+                        <?php \r\n+                        // Veritabanı bağlantısı\r\n+                        $dbConfig = require 'config/mssql.php';\r\n+                        $connectionInfo = array(\r\n+                            \"Database\" => $dbConfig['database'],\r\n+                            \"UID\" => $dbConfig['username'],\r\n+                            \"PWD\" => $dbConfig['password'],\r\n+                            \"CharacterSet\" => \"UTF-8\"\r\n+                        );\r\n+                        $conn = sqlsrv_connect($dbConfig['host'], $connectionInfo);\r\n+                        \r\n+                        if ($conn === false) {\r\n+                            die(\"Veritabanı bağlantı hatası: \" . print_r(sqlsrv_errors(), true));\r\n+                        }\r\n+                        \r\n+                        // Dashboard'da gösterilecek sayfaları çek\r\n+                        $dashboardQuery = \"\r\n+                            SELECT \r\n+                                s.sayfa_id,\r\n+                                s.sayfa_adi,\r\n+                                s.sayfa_url,\r\n+                                s.sayfa_ikon,\r\n+                                s.sira_no,\r\n+                                m.menu_url,\r\n+                                mo.modul_url\r\n+                            FROM tanim_sayfalar s\r\n+                            INNER JOIN tanim_menuler m ON s.menu_id = m.menu_id\r\n+                            INNER JOIN tanim_moduller mo ON m.modul_id = mo.modul_id\r\n+                            WHERE s.dashboard = 1 AND s.durum = 1\r\n+                            ORDER BY s.sira_no ASC, s.sayfa_id ASC\r\n+                        \";\r\n+                        \r\n+                        $dashboardStmt = sqlsrv_query($conn, $dashboardQuery);\r\n+                        \r\n+                        if ($dashboardStmt === false) {\r\n+                            echo '<div class=\"col-12\"><div class=\"alert alert-warning\">Dashboard verileri yüklenemedi.</div></div>';\r\n+                        } else {\r\n+                            $renkler = ['primary', 'success', 'info', 'warning', 'danger', 'secondary', 'dark'];\r\n+                            $renkIndex = 0;\r\n+                            \r\n+                            // Sayfa yoksa bilgi göster\r\n+                            $sayfaVarMi = false;\r\n+                            \r\n+                            while ($sayfa = sqlsrv_fetch_array($dashboardStmt, SQLSRV_FETCH_ASSOC)) {\r\n+                                $sayfaVarMi = true;\r\n+                                $sayfaAdi = htmlspecialchars($sayfa['sayfa_adi']);\r\n+                                $sayfaUrl = htmlspecialchars($sayfa['sayfa_url']);\r\n+                                $sayfaIkon = htmlspecialchars($sayfa['sayfa_ikon'] ?? 'fa-file');\r\n+                                $menuUrl = htmlspecialchars($sayfa['menu_url']);\r\n+                                $modulUrl = htmlspecialchars($sayfa['modul_url']);\r\n+                                \r\n+                                // URL oluştur\r\n+                                $fullUrl = \"views/{$modulUrl}/{$menuUrl}/{$sayfaUrl}\";\r\n+                                \r\n+                                // Renk seç\r\n+                                $renk = $renkler[$renkIndex % count($renkler)];\r\n+                                $renkIndex++;\r\n+                        ?>\r\n                         <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"views/Yonetim/Muhasebe/bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n-                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Hesaplama</small>\r\n+                            <a href=\"<?php echo $fullUrl; ?>\" class=\"btn btn-outline-<?php echo $renk; ?> w-100 py-3\">\r\n+                                <i class=\"fas <?php echo $sayfaIkon; ?> fa-2x d-block mb-2\"></i>\r\n+                                <small><?php echo $sayfaAdi; ?></small>\r\n                             </a>\r\n                         </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"views/Yonetim/Muhasebe/bayi_hakedis_tanimla.php\" class=\"btn btn-outline-info w-100 py-3\">\r\n-                                <i class=\"fas fa-cog fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Tanımlama</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"views/Yonetim/Muhasebe/bayi_odeme_yonetimi.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n-                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n-                                <small>Ödeme Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n+                        <?php \r\n+                            }\r\n+                            \r\n+                            if (!$sayfaVarMi) {\r\n+                                echo '<div class=\"col-12\"><div class=\"alert alert-info mb-0\">';\r\n+                                echo '<i class=\"fas fa-info-circle me-2\"></i>';\r\n+                                echo 'Henüz dashboard\\'a eklenmiş sayfa bulunmuyor. ';\r\n+                                echo 'Sayfa eklemek için <code>tanim_sayfalar</code> tablosunda <code>dashboard=1</code> yapın.';\r\n+                                echo '</div></div>';\r\n+                            }\r\n+                            \r\n+                            sqlsrv_free_stmt($dashboardStmt);\r\n+                        }\r\n                         \r\n-                        <?php if ($currentUser['group_name'] === 'admin'): ?>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_hakedis_tanimla.php\" class=\"btn btn-outline-primary w-100 py-3\">\r\n-                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Tanımlama</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_hakedis_hesapla.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n-                                <i class=\"fas fa-coins fa-2x d-block mb-2\"></i>\r\n-                                <small>Hakediş Hesaplama</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-danger w-100 py-3\">\r\n-                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n-                                <small>Ödeme Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"users.php\" class=\"btn btn-outline-secondary w-100 py-3\">\r\n-                                <i class=\"fas fa-users-cog fa-2x d-block mb-2\"></i>\r\n-                                <small>Kullanıcı Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <div class=\"col-md-4 col-6\">\r\n-                            <a href=\"user_groups.php\" class=\"btn btn-outline-dark w-100 py-3\">\r\n-                                <i class=\"fas fa-layer-group fa-2x d-block mb-2\"></i>\r\n-                                <small>Grup Yönetimi</small>\r\n-                            </a>\r\n-                        </div>\r\n-                        <?php endif; ?>\r\n+                        sqlsrv_close($conn);\r\n+                        ?>\r\n                     </div>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n"
                }
            ],
            "date": 1758983725164,
            "name": "Commit-0",
            "content": "<?php\r\n$pageTitle = \"Ana Sayfa\";\r\n$breadcrumbs = [\r\n    ['title' => 'Ana Sayfa']\r\n];\r\n\r\n// Auth kontrol\r\nrequire_once 'auth.php';\r\n$currentUser = checkAuth();\r\ncheckUserStatus();\r\nupdateLastActivity();\r\n\r\n// Veritabanı bağlantısı\r\nrequire_once 'MSSQLConnection.php';\r\n\r\ntry {\r\n    $db = new MSSQLConnection();\r\n    $conn = $db->getConnection();\r\n    \r\n    // Genel istatistikler\r\n    $stats = [];\r\n    \r\n    // Toplam kayıt sayısı\r\n    $sql = \"SELECT COUNT(*) as total FROM iris_rapor\";\r\n    $stmt = $conn->prepare($sql);\r\n    $stmt->execute();\r\n    $stats['total_records'] = $stmt->fetch(PDO::FETCH_ASSOC)['total'];\r\n    \r\n    // Bu ayki kayıtlar\r\n    $sql = \"SELECT COUNT(*) as monthly FROM iris_rapor WHERE MONTH(MEMO_KAPANIS_TARIHI) = MONTH(GETDATE()) AND YEAR(MEMO_KAPANIS_TARIHI) = YEAR(GETDATE())\";\r\n    $stmt = $conn->prepare($sql);\r\n    $stmt->execute();\r\n    $stats['monthly_records'] = $stmt->fetch(PDO::FETCH_ASSOC)['monthly'];\r\n    \r\n    // Toplam alt bayi sayısı\r\n    $sql = \"SELECT COUNT(DISTINCT TALEBI_GIREN_PERSONEL_ALTBAYI) as total FROM iris_rapor WHERE TALEBI_GIREN_PERSONEL_ALTBAYI IS NOT NULL AND TALEBI_GIREN_PERSONEL_ALTBAYI != ''\";\r\n    $stmt = $conn->prepare($sql);\r\n    $stmt->execute();\r\n    $stats['total_dealers'] = $stmt->fetch(PDO::FETCH_ASSOC)['total'];\r\n    \r\n    // Hizmet dağılımı\r\n    $sql = \"SELECT \r\n                MEMO_KAYIT_TIPI,\r\n                COUNT(*) as count\r\n            FROM iris_rapor \r\n            WHERE MEMO_KAYIT_TIPI IN ('ISP', 'NEO', 'UYDU', 'BAGLANTI', 'SATIS', 'TEKNIK', 'IPTAL')\r\n            GROUP BY MEMO_KAYIT_TIPI\r\n            ORDER BY count DESC\";\r\n    $stmt = $conn->prepare($sql);\r\n    $stmt->execute();\r\n    $techStats = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n    // Toplam kullanıcı sayısı (admin ise)\r\n    if ($currentUser['group_name'] === 'admin') {\r\n        $sql = \"SELECT COUNT(*) as total FROM users WHERE status = 'AKTIF'\";\r\n        $stmt = $conn->prepare($sql);\r\n        $stmt->execute();\r\n        $stats['total_users'] = $stmt->fetch(PDO::FETCH_ASSOC)['total'];\r\n    }\r\n    \r\n} catch (Exception $e) {\r\n    $error = \"Veritabanı hatası: \" . $e->getMessage();\r\n}\r\n\r\ninclude 'includes/header.php';\r\n?>\r\n\r\n<div class=\"container-fluid mt-4\">\r\n    <!-- İstatistik Kartları -->\r\n    <div class=\"row mb-4\">\r\n        <div class=\"col-md-3\">\r\n            <div class=\"card border-0 shadow-sm\">\r\n                <div class=\"card-body text-center\">\r\n                    <div class=\"text-primary mb-3\">\r\n                        <i class=\"fas fa-database fa-3x\"></i>\r\n                    </div>\r\n                    <h3 class=\"text-primary\"><?php echo number_format($stats['total_records'] ?? 0); ?></h3>\r\n                    <p class=\"text-muted mb-0\">Toplam Adet</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class=\"col-md-3\">\r\n            <div class=\"card border-0 shadow-sm\">\r\n                <div class=\"card-body text-center\">\r\n                    <div class=\"text-success mb-3\">\r\n                        <i class=\"fas fa-calendar-alt fa-3x\"></i>\r\n                    </div>\r\n                    <h3 class=\"text-success\"><?php echo number_format($stats['monthly_records'] ?? 0); ?></h3>\r\n                    <p class=\"text-muted mb-0\">Bu Ayki Kayıt</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class=\"col-md-3\">\r\n            <div class=\"card border-0 shadow-sm\">\r\n                <div class=\"card-body text-center\">\r\n                    <div class=\"text-info mb-3\">\r\n                        <i class=\"fas fa-users fa-3x\"></i>\r\n                    </div>\r\n                    <h3 class=\"text-info\"><?php echo number_format($stats['total_dealers'] ?? 0); ?></h3>\r\n                    <p class=\"text-muted mb-0\">Alt Bayi</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <?php if (isset($stats['total_users'])): ?>\r\n        <div class=\"col-md-3\">\r\n            <div class=\"card border-0 shadow-sm\">\r\n                <div class=\"card-body text-center\">\r\n                    <div class=\"text-warning mb-3\">\r\n                        <i class=\"fas fa-user-shield fa-3x\"></i>\r\n                    </div>\r\n                    <h3 class=\"text-warning\"><?php echo number_format($stats['total_users']); ?></h3>\r\n                    <p class=\"text-muted mb-0\">Aktif Kullanıcı</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <?php endif; ?>\r\n    </div>\r\n\r\n    <div class=\"row\">\r\n        <!-- Hızlı Erişim -->\r\n        <div class=\"col-md-6 mb-4\">\r\n            <div class=\"card border-0 shadow-sm\">\r\n                <div class=\"card-header bg-primary text-white\">\r\n                    <h5 class=\"mb-0\">\r\n                        <i class=\"fas fa-bolt me-2\"></i>Hızlı Erişim\r\n                    </h5>\r\n                </div>\r\n                <div class=\"card-body\">\r\n                    <div class=\"row g-3\">\r\n                        <div class=\"col-6\">\r\n                            <a href=\"hakedis_hesapla.php\" class=\"btn btn-outline-primary w-100 py-3\">\r\n                                <i class=\"fas fa-calculator fa-2x d-block mb-2\"></i>\r\n                                Hakediş Hesaplama\r\n                            </a>\r\n                        </div>\r\n                        <div class=\"col-6\">\r\n                            <a href=\"upload_iris_final.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n                                <i class=\"fas fa-upload fa-2x d-block mb-2\"></i>\r\n                                Dosya Yükleme\r\n                            </a>\r\n                        </div>\r\n                        <div class=\"col-6\">\r\n                            <a href=\"list_uploads.php\" class=\"btn btn-outline-info w-100 py-3\">\r\n                                <i class=\"fas fa-list fa-2x d-block mb-2\"></i>\r\n                                Yükleme Listesi\r\n                            </a>\r\n                        </div>\r\n                        <?php if ($currentUser['group_name'] === 'admin'): ?>\r\n                        <div class=\"col-6\">\r\n                            <a href=\"users.php\" class=\"btn btn-outline-warning w-100 py-3\">\r\n                                <i class=\"fas fa-users-cog fa-2x d-block mb-2\"></i>\r\n                                Kullanıcı Yönetimi\r\n                            </a>\r\n                        </div>\r\n                        <div class=\"col-6\">\r\n                            <a href=\"bayi_odeme_yonetimi.php\" class=\"btn btn-outline-success w-100 py-3\">\r\n                                <i class=\"fas fa-money-bill-wave fa-2x d-block mb-2\"></i>\r\n                                Ödeme Yönetimi\r\n                            </a>\r\n                        </div>\r\n                        <?php endif; ?>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Hizmet Dağılımı -->\r\n        <div class=\"col-md-6 mb-4\">\r\n            <div class=\"card border-0 shadow-sm\">\r\n                <div class=\"card-header bg-info text-white\">\r\n                    <h5 class=\"mb-0\">\r\n                        <i class=\"fas fa-chart-pie me-2\"></i>Hizmet Dağılımı\r\n                    </h5>\r\n                </div>\r\n                <div class=\"card-body\">\r\n                    <?php if (!empty($techStats)): ?>\r\n                        <?php\r\n                        $totalTech = array_sum(array_column($techStats, 'count'));\r\n                        foreach ($techStats as $tech):\r\n                            $percentage = $totalTech > 0 ? round(($tech['count'] / $totalTech) * 100, 1) : 0;\r\n                            $colorClass = '';\r\n                            switch ($tech['MEMO_KAYIT_TIPI']) {\r\n                                case 'ISP': $colorClass = 'bg-primary'; break;\r\n                                case 'NEO': $colorClass = 'bg-success'; break;\r\n                                case 'UYDU': $colorClass = 'bg-info'; break;\r\n                                case 'BAGLANTI': $colorClass = 'bg-warning'; break;\r\n                                case 'SATIS': $colorClass = 'bg-danger'; break;\r\n                                case 'TEKNIK': $colorClass = 'bg-secondary'; break;\r\n                                case 'IPTAL': $colorClass = 'bg-dark'; break;\r\n                                default: $colorClass = 'bg-light'; break;\r\n                            }\r\n                        ?>\r\n                            <div class=\"d-flex justify-content-between align-items-center mb-2\">\r\n                                <span class=\"fw-medium\"><?php echo htmlspecialchars($tech['MEMO_KAYIT_TIPI']); ?></span>\r\n                                <div class=\"text-end\">\r\n                                    <span class=\"badge <?php echo $colorClass; ?> me-2\">\r\n                                        <?php echo number_format($tech['count']); ?>\r\n                                    </span>\r\n                                    <small class=\"text-muted\">%<?php echo $percentage; ?></small>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"progress mb-3\" style=\"height: 8px;\">\r\n                                <div class=\"progress-bar <?php echo $colorClass; ?>\" \r\n                                     style=\"width: <?php echo $percentage; ?>%\"></div>\r\n                            </div>\r\n                        <?php endforeach; ?>\r\n                    <?php else: ?>\r\n                        <div class=\"text-center py-4 text-muted\">\r\n                            <i class=\"fas fa-chart-pie fa-3x mb-3 d-block\"></i>\r\n                            <p>Henüz hizmet verisi bulunmuyor.</p>\r\n                        </div>\r\n                    <?php endif; ?>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Son Aktiviteler (Örnek) -->\r\n    <div class=\"row\">\r\n        <div class=\"col-12\">\r\n            <div class=\"card border-0 shadow-sm\">\r\n                <div class=\"card-header bg-success text-white\">\r\n                    <h5 class=\"mb-0\">\r\n                        <i class=\"fas fa-history me-2\"></i>Sistem Bilgileri\r\n                    </h5>\r\n                </div>\r\n                <div class=\"card-body\">\r\n                    <div class=\"row\">\r\n                        <div class=\"col-md-4\">\r\n                            <h6 class=\"text-muted\">Sunucu Bilgileri</h6>\r\n                            <ul class=\"list-unstyled\">\r\n                                <li><i class=\"fas fa-server me-2 text-primary\"></i>PHP Versiyonu: <?php echo PHP_VERSION; ?></li>\r\n                                <li><i class=\"fas fa-database me-2 text-success\"></i>Veritabanı: SQL Server</li>\r\n                                <li><i class=\"fas fa-clock me-2 text-info\"></i>Sunucu Saati: <?php echo date('d.m.Y H:i:s'); ?></li>\r\n                            </ul>\r\n                        </div>\r\n                        <div class=\"col-md-4\">\r\n                            <h6 class=\"text-muted\">Sistem Durumu</h6>\r\n                            <ul class=\"list-unstyled\">\r\n                                <li><i class=\"fas fa-check-circle me-2 text-success\"></i>Veritabanı Bağlantısı: Aktif</li>\r\n                                <li><i class=\"fas fa-check-circle me-2 text-success\"></i>Login Sistemi: Aktif</li>\r\n                                <li><i class=\"fas fa-check-circle me-2 text-success\"></i>Dosya Yükleme: Aktif</li>\r\n                            </ul>\r\n                        </div>\r\n                        <div class=\"col-md-4\">\r\n                            <h6 class=\"text-muted\">Kullanıcı Bilgileri</h6>\r\n                            <ul class=\"list-unstyled\">\r\n                                <li><i class=\"fas fa-user me-2 text-primary\"></i>Kullanıcı: <?php echo htmlspecialchars($currentUser['name']); ?></li>\r\n                                <li><i class=\"fas fa-envelope me-2 text-info\"></i>E-posta: <?php echo htmlspecialchars($currentUser['email']); ?></li>\r\n                                <li><i class=\"fas fa-shield-alt me-2 text-warning\"></i>Yetki: <?php \r\n                                switch($currentUser['group_name']) {\r\n                                    case 'admin': echo 'Admin'; break;\r\n                                    case 'bolge_yoneticisi': echo 'Bölge Yöneticisi'; break;\r\n                                    case 'bayi': echo 'Bayi'; break;\r\n                                    default: echo 'Kullanıcı'; break;\r\n                                }\r\n                                ?></li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<?php include 'includes/footer.php'; ?>\r\n"
        }
    ]
}