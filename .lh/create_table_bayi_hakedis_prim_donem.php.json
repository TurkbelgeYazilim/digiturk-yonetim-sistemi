{
    "sourceFile": "create_table_bayi_hakedis_prim_donem.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759394667447,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759394667447,
            "name": "Commit-0",
            "content": "<?php\r\n// Bayi Hakedis Prim Dönem Tablosu Oluşturma Script'i\r\n// Bu dosyayı sadece bir kez çalıştırın!\r\n\r\nini_set('display_errors', 1);\r\nini_set('display_startup_errors', 1);\r\nerror_reporting(E_ALL);\r\n\r\necho \"<h2>Bayi Hakedis Prim Dönem Tablosu Oluşturma</h2>\";\r\necho \"<hr>\";\r\n\r\ntry {\r\n    require_once 'auth.php';\r\n    $conn = getDatabaseConnection();\r\n    \r\n    echo \"<p><strong>Veritabanına bağlanıldı.</strong></p>\";\r\n    \r\n    // Tablo var mı kontrol et\r\n    $checkTableSql = \"SELECT COUNT(*) as table_count FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'bayi_hakedis_prim_donem'\";\r\n    $checkStmt = $conn->prepare($checkTableSql);\r\n    $checkStmt->execute();\r\n    $result = $checkStmt->fetch();\r\n    \r\n    if ($result['table_count'] > 0) {\r\n        echo \"<div style='color: orange;'><strong>UYARI:</strong> 'bayi_hakedis_prim_donem' tablosu zaten mevcut!</div>\";\r\n        echo \"<p>Mevcut tabloyu görmek için <a href='bayi_hakedis_prim_donem.php'>buraya tıklayın</a></p>\";\r\n    } else {\r\n        echo \"<p>Tablo oluşturuluyor...</p>\";\r\n        \r\n        // Tablo oluştur\r\n        $createTableSql = \"\r\n        CREATE TABLE bayi_hakedis_prim_donem (\r\n            id int IDENTITY(1,1) PRIMARY KEY,\r\n            donem_adi nvarchar(255) NOT NULL,\r\n            baslangic_tarihi date NOT NULL,\r\n            bitis_tarihi date NOT NULL,\r\n            durum nvarchar(50) NOT NULL DEFAULT 'AKTIF',\r\n            olusturma_tarihi datetime2 NOT NULL DEFAULT GETDATE(),\r\n            olusturan int NULL,\r\n            guncelleme_tarihi datetime2 NULL,\r\n            guncelleyen int NULL,\r\n            \r\n            -- Constraints\r\n            CONSTRAINT CK_bayi_hakedis_prim_donem_durum CHECK (durum IN ('AKTIF', 'PASIF')),\r\n            CONSTRAINT CK_bayi_hakedis_prim_donem_tarih CHECK (bitis_tarihi > baslangic_tarihi),\r\n            CONSTRAINT UQ_bayi_hakedis_prim_donem_adi UNIQUE (donem_adi)\r\n        )\";\r\n        \r\n        $conn->exec($createTableSql);\r\n        echo \"<p style='color: green;'><strong>✓ Tablo başarıyla oluşturuldu!</strong></p>\";\r\n        \r\n        // Index'leri oluştur\r\n        $indexes = [\r\n            \"CREATE INDEX IX_bayi_hakedis_prim_donem_durum ON bayi_hakedis_prim_donem(durum)\",\r\n            \"CREATE INDEX IX_bayi_hakedis_prim_donem_tarih ON bayi_hakedis_prim_donem(baslangic_tarihi, bitis_tarihi)\",\r\n            \"CREATE INDEX IX_bayi_hakedis_prim_donem_olusturma ON bayi_hakedis_prim_donem(olusturma_tarihi)\"\r\n        ];\r\n        \r\n        foreach ($indexes as $indexSql) {\r\n            $conn->exec($indexSql);\r\n        }\r\n        echo \"<p style='color: green;'><strong>✓ Index'ler başarıyla oluşturuldu!</strong></p>\";\r\n        \r\n        // Örnek veriler ekle\r\n        $sampleData = [\r\n            ['2025 1. Dönem', '2025-01-01', '2025-06-30', 'AKTIF'],\r\n            ['2025 2. Dönem', '2025-07-01', '2025-12-31', 'PASIF'],\r\n            ['2024 4. Çeyrek', '2024-10-01', '2024-12-31', 'AKTIF']\r\n        ];\r\n        \r\n        $insertSql = \"INSERT INTO bayi_hakedis_prim_donem (donem_adi, baslangic_tarihi, bitis_tarihi, durum, olusturan) VALUES (?, ?, ?, ?, 1)\";\r\n        $insertStmt = $conn->prepare($insertSql);\r\n        \r\n        foreach ($sampleData as $data) {\r\n            $insertStmt->execute($data);\r\n        }\r\n        \r\n        echo \"<p style='color: green;'><strong>✓ Örnek veriler eklendi!</strong></p>\";\r\n        \r\n        // Tablo yapısını göster\r\n        echo \"<h3>Tablo Yapısı:</h3>\";\r\n        $structureSql = \"SELECT \r\n            COLUMN_NAME as 'Sütun Adı',\r\n            DATA_TYPE as 'Veri Tipi',\r\n            IS_NULLABLE as 'Null Olabilir',\r\n            COLUMN_DEFAULT as 'Varsayılan Değer'\r\n        FROM INFORMATION_SCHEMA.COLUMNS \r\n        WHERE TABLE_NAME = 'bayi_hakedis_prim_donem'\r\n        ORDER BY ORDINAL_POSITION\";\r\n        \r\n        $structureStmt = $conn->prepare($structureSql);\r\n        $structureStmt->execute();\r\n        $columns = $structureStmt->fetchAll(PDO::FETCH_ASSOC);\r\n        \r\n        echo \"<table border='1' cellpadding='5' cellspacing='0' style='border-collapse: collapse;'>\";\r\n        echo \"<tr style='background-color: #f0f0f0;'>\";\r\n        echo \"<th>Sütun Adı</th><th>Veri Tipi</th><th>Null Olabilir</th><th>Varsayılan Değer</th>\";\r\n        echo \"</tr>\";\r\n        \r\n        foreach ($columns as $column) {\r\n            echo \"<tr>\";\r\n            echo \"<td>{$column['Sütun Adı']}</td>\";\r\n            echo \"<td>{$column['Veri Tipi']}</td>\";\r\n            echo \"<td>{$column['Null Olabilir']}</td>\";\r\n            echo \"<td>\" . ($column['Varsayılan Değer'] ?? '-') . \"</td>\";\r\n            echo \"</tr>\";\r\n        }\r\n        echo \"</table>\";\r\n        \r\n        echo \"<hr>\";\r\n        echo \"<p><strong>İşlem tamamlandı!</strong></p>\";\r\n        echo \"<p><a href='bayi_hakedis_prim_donem.php' style='background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;'>Dönem Yönetimi Sayfasına Git</a></p>\";\r\n    }\r\n    \r\n} catch (Exception $e) {\r\n    echo \"<div style='color: red;'>\";\r\n    echo \"<strong>HATA:</strong> \" . $e->getMessage();\r\n    echo \"</div>\";\r\n    echo \"<p>Hata detayları:</p>\";\r\n    echo \"<pre>\" . $e->getTraceAsString() . \"</pre>\";\r\n}\r\n?>\r\n\r\n<style>\r\nbody {\r\n    font-family: Arial, sans-serif;\r\n    margin: 20px;\r\n    background-color: #f5f5f5;\r\n}\r\n\r\ntable {\r\n    background-color: white;\r\n    margin: 10px 0;\r\n}\r\n\r\nh2, h3 {\r\n    color: #333;\r\n}\r\n\r\nhr {\r\n    border: 1px solid #ddd;\r\n    margin: 20px 0;\r\n}\r\n</style>"
        }
    ]
}