{
    "sourceFile": "debug_duplicates.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759561113033,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759561113033,
            "name": "Commit-0",
            "content": "<?php\r\n// Debug script to check for duplicate records\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\n\r\nrequire_once 'config/mssql.php';\r\n\r\ntry {\r\n    $conn = getDatabaseConnection();\r\n    \r\n    echo \"<h2>Debugging Duplicate Records</h2>\\n\";\r\n    \r\n    // 1. Check raw hakedis_tanim table\r\n    echo \"<h3>1. Raw hakedis_tanim table:</h3>\\n\";\r\n    $sql1 = \"SELECT id, bayi_id, created_at FROM hakedis_tanim ORDER BY id\";\r\n    $stmt1 = $conn->prepare($sql1);\r\n    $stmt1->execute();\r\n    $rawRecords = $stmt1->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n    echo \"<table border='1'>\\n\";\r\n    echo \"<tr><th>ID</th><th>Bayi ID</th><th>Created At</th></tr>\\n\";\r\n    foreach ($rawRecords as $record) {\r\n        echo \"<tr><td>{$record['id']}</td><td>{$record['bayi_id']}</td><td>{$record['created_at']}</td></tr>\\n\";\r\n    }\r\n    echo \"</table>\\n\";\r\n    echo \"<p>Total raw records: \" . count($rawRecords) . \"</p>\\n\";\r\n    \r\n    // 2. Check with DISTINCT\r\n    echo \"<h3>2. With DISTINCT on main query:</h3>\\n\";\r\n    $sql2 = \"SELECT DISTINCT ht.*, u.first_name, u.last_name, u.email\r\n            FROM hakedis_tanim ht\r\n            INNER JOIN users u ON ht.bayi_id = u.id\r\n            ORDER BY ht.created_at DESC\";\r\n    $stmt2 = $conn->prepare($sql2);\r\n    $stmt2->execute();\r\n    $distinctRecords = $stmt2->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n    echo \"<table border='1'>\\n\";\r\n    echo \"<tr><th>ID</th><th>Bayi ID</th><th>Name</th><th>Created At</th></tr>\\n\";\r\n    foreach ($distinctRecords as $record) {\r\n        echo \"<tr><td>{$record['id']}</td><td>{$record['bayi_id']}</td><td>{$record['first_name']} {$record['last_name']}</td><td>{$record['created_at']}</td></tr>\\n\";\r\n    }\r\n    echo \"</table>\\n\";\r\n    echo \"<p>Total distinct records: \" . count($distinctRecords) . \"</p>\\n\";\r\n    \r\n    // 3. Check for ID duplicates\r\n    echo \"<h3>3. ID Count Analysis:</h3>\\n\";\r\n    $ids = array_column($distinctRecords, 'id');\r\n    $idCounts = array_count_values($ids);\r\n    \r\n    echo \"<table border='1'>\\n\";\r\n    echo \"<tr><th>ID</th><th>Count</th></tr>\\n\";\r\n    foreach ($idCounts as $id => $count) {\r\n        $style = $count > 1 ? 'style=\"background-color: #ffcccc;\"' : '';\r\n        echo \"<tr $style><td>$id</td><td>$count</td></tr>\\n\";\r\n    }\r\n    echo \"</table>\\n\";\r\n    \r\n    // 4. If we found duplicates, show them\r\n    $duplicates = array_filter($idCounts, function($count) { return $count > 1; });\r\n    if (!empty($duplicates)) {\r\n        echo \"<h3>4. Duplicate IDs Found:</h3>\\n\";\r\n        foreach ($duplicates as $dupId => $count) {\r\n            echo \"<h4>ID $dupId appears $count times:</h4>\\n\";\r\n            $dupRecords = array_filter($distinctRecords, function($r) use ($dupId) {\r\n                return $r['id'] == $dupId;\r\n            });\r\n            \r\n            echo \"<table border='1'>\\n\";\r\n            echo \"<tr><th>All Fields</th></tr>\\n\";\r\n            foreach ($dupRecords as $record) {\r\n                echo \"<tr><td><pre>\" . print_r($record, true) . \"</pre></td></tr>\\n\";\r\n            }\r\n            echo \"</table>\\n\";\r\n        }\r\n    } else {\r\n        echo \"<p><strong>No duplicates found in query results!</strong></p>\\n\";\r\n    }\r\n    \r\n} catch (Exception $e) {\r\n    echo \"Error: \" . $e->getMessage();\r\n}\r\n?>"
        }
    ]
}