{
    "sourceFile": "create_primebaz_table.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1759242376077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759242647328,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,31 @@\n--- Primebaz Rapor Tablosu Oluşturma Script'i\r\n+-- ==========================================\r\n+-- PRİMEBAZ RAPOR TABLOSU OLUŞTURMA SCRİPT'İ\r\n+-- ==========================================\r\n -- Bu script Primebaz Excel dosyalarından gelen verileri saklamak için gerekli tabloyu oluşturur\r\n+-- \r\n+-- KULLANIM TALİMATLARI:\r\n+-- 1. SQL Server Management Studio'da hedef veritabanınıza bağlanın\r\n+-- 2. Bu script'i açın ve çalıştırın\r\n+-- 3. Script otomatik olarak bağlı olduğunuz veritabanında tabloyu oluşturacak\r\n+-- 4. Primebaz Excel dosyalarını yüklemek için primebaz_rapor_yukle.php sayfasını kullanın\r\n+--\r\n+-- TABLO YAPISI:\r\n+-- - 36 sütun (Bayi, Müşteri, Ürün, Mali, Dönem, Sistem bilgileri)\r\n+-- - 6 indeks (Performans için)\r\n+-- - Otomatik ID ve tarih alanları\r\n+-- ==========================================\r\n \r\n-USE [digiturk_rapor_db];\r\n-GO\r\n+-- ==========================================\r\n+-- VERİTABANI AYARI\r\n+-- ==========================================\r\n+-- Aşağıdaki satırı kendi veritabanınızın adıyla güncelleyin:\r\n+-- USE [VERITABANI_ADINIZ];\r\n+-- GO\r\n \r\n+-- Veya mevcut bağlı veritabanında çalıştırın (önerilen)\r\n+-- Script şu anda bağlı olan veritabanında çalışacak şekilde ayarlanmıştır\r\n+\r\n -- Eğer tablo mevcutsa sil (isteğe bağlı)\r\n -- DROP TABLE IF EXISTS primebaz_rapor;\r\n \r\n -- Primebaz rapor tablosunu oluştur\r\n@@ -118,61 +139,128 @@\n     CREATE INDEX IX_primebaz_rapor_eklenme ON primebaz_rapor (eklenme_tarihi);\r\n     PRINT 'Ekleme tarihi indeksi oluşturuldu.';\r\n END;\r\n \r\n--- Tablo istatistikleri\r\n-SELECT \r\n-    'primebaz_rapor' AS tablo_adi,\r\n-    COUNT(*) AS toplam_kayit,\r\n-    COUNT(DISTINCT bayi_kodu) AS benzersiz_bayi,\r\n-    COUNT(DISTINCT musteri_no) AS benzersiz_musteri,\r\n-    COUNT(DISTINCT donem) AS benzersiz_donem,\r\n-    MIN(eklenme_tarihi) AS ilk_kayit,\r\n-    MAX(eklenme_tarihi) AS son_kayit\r\n-FROM primebaz_rapor;\r\n+-- Tablo istatistikleri (tablo boş olsa bile çalışır)\r\n+IF EXISTS (SELECT * FROM sysobjects WHERE name='primebaz_rapor' AND xtype='U')\r\n+BEGIN\r\n+    SELECT \r\n+        'primebaz_rapor' AS tablo_adi,\r\n+        COUNT(*) AS toplam_kayit,\r\n+        COUNT(DISTINCT bayi_kodu) AS benzersiz_bayi,\r\n+        COUNT(DISTINCT musteri_no) AS benzersiz_musteri,\r\n+        COUNT(DISTINCT donem) AS benzersiz_donem,\r\n+        CASE \r\n+            WHEN COUNT(*) > 0 THEN MIN(eklenme_tarihi) \r\n+            ELSE NULL \r\n+        END AS ilk_kayit,\r\n+        CASE \r\n+            WHEN COUNT(*) > 0 THEN MAX(eklenme_tarihi) \r\n+            ELSE NULL \r\n+        END AS son_kayit\r\n+    FROM primebaz_rapor;\r\n+    \r\n+    PRINT 'Tablo istatistikleri gösterildi.';\r\n+END\r\n+ELSE\r\n+BEGIN\r\n+    PRINT 'primebaz_rapor tablosu bulunamadı.';\r\n+END;\r\n \r\n PRINT 'Primebaz rapor tablosu ve indeksleri başarıyla oluşturuldu.';\r\n \r\n--- Kullanım örnekleri:\r\n+-- ==========================================\r\n+-- KURULUM TAMAMLANDI\r\n+-- ==========================================\r\n+PRINT '================================================';\r\n+PRINT 'PRİMEBAZ RAPOR SİSTEMİ KURULUMU TAMAMLANDI!';\r\n+PRINT '================================================';\r\n+PRINT 'Şimdi yapabilecekleriniz:';\r\n+PRINT '1. primebaz_rapor_yukle.php sayfasını açın';\r\n+PRINT '2. uploads/primebaz/ klasörüne Excel dosyalarınızı yükleyin';\r\n+PRINT '3. Excel dosyalarını veritabanına aktarın';\r\n+PRINT '4. Aşağıdaki örnek sorguları kullanarak raporlar oluşturun';\r\n+PRINT '================================================';\r\n+\r\n+-- ==========================================\r\n+-- ÖRNEK KULLANIM SORGUKLARI\r\n+-- ==========================================\r\n /*\r\n \r\n--- Belirli bir dönemdeki verileri getir\r\n-SELECT * FROM primebaz_rapor \r\n+-- 1. Belirli bir dönemdeki verileri getir\r\n+SELECT TOP 100 * FROM primebaz_rapor \r\n WHERE yil = 2025 AND ay = 3 \r\n-ORDER BY islem_tarihi;\r\n+ORDER BY islem_tarihi DESC;\r\n \r\n--- Bayi bazında özet rapor\r\n+-- 2. Bayi bazında özet rapor (Mart 2025)\r\n SELECT \r\n     bayi_kodu,\r\n     bayi_adi,\r\n     COUNT(*) AS toplam_islem,\r\n     SUM(tutar) AS toplam_tutar,\r\n-    SUM(komisyon_tutari) AS toplam_komisyon\r\n+    SUM(komisyon_tutari) AS toplam_komisyon,\r\n+    AVG(tutar) AS ortalama_tutar\r\n FROM primebaz_rapor \r\n WHERE yil = 2025 AND ay = 3\r\n GROUP BY bayi_kodu, bayi_adi\r\n ORDER BY toplam_tutar DESC;\r\n \r\n--- Aylık özet\r\n+-- 3. Aylık genel özet\r\n SELECT \r\n     yil,\r\n     ay,\r\n     donem,\r\n     COUNT(*) AS toplam_kayit,\r\n     SUM(tutar) AS toplam_tutar,\r\n     SUM(komisyon_tutari) AS toplam_komisyon,\r\n-    COUNT(DISTINCT bayi_kodu) AS aktif_bayi\r\n+    COUNT(DISTINCT bayi_kodu) AS aktif_bayi_sayisi,\r\n+    COUNT(DISTINCT musteri_no) AS toplam_musteri\r\n FROM primebaz_rapor\r\n GROUP BY yil, ay, donem\r\n ORDER BY yil DESC, ay DESC;\r\n \r\n--- Dosya bazında yükleme durumu\r\n+-- 4. Dosya bazında yükleme durumu\r\n SELECT \r\n     dosya_adi,\r\n     COUNT(*) AS kayit_sayisi,\r\n     MIN(eklenme_tarihi) AS yukleme_tarihi,\r\n-    donem\r\n+    donem,\r\n+    SUM(tutar) AS dosya_toplam_tutar\r\n FROM primebaz_rapor\r\n GROUP BY dosya_adi, donem\r\n ORDER BY yukleme_tarihi DESC;\r\n \r\n+-- 5. En yüksek ciroyu yapan bayiler (Son 3 ay)\r\n+SELECT TOP 10\r\n+    bayi_kodu,\r\n+    bayi_adi,\r\n+    bolge,\r\n+    COUNT(*) AS toplam_islem,\r\n+    SUM(tutar) AS toplam_ciro,\r\n+    SUM(komisyon_tutari) AS toplam_komisyon\r\n+FROM primebaz_rapor \r\n+WHERE eklenme_tarihi >= DATEADD(MONTH, -3, GETDATE())\r\n+GROUP BY bayi_kodu, bayi_adi, bolge\r\n+ORDER BY toplam_ciro DESC;\r\n+\r\n+-- 6. İl bazında dağılım\r\n+SELECT \r\n+    il,\r\n+    COUNT(*) AS islem_sayisi,\r\n+    COUNT(DISTINCT bayi_kodu) AS bayi_sayisi,\r\n+    SUM(tutar) AS toplam_tutar\r\n+FROM primebaz_rapor\r\n+GROUP BY il\r\n+ORDER BY toplam_tutar DESC;\r\n+\r\n+-- 7. Tablo genel durumu\r\n+SELECT \r\n+    COUNT(*) AS toplam_kayit,\r\n+    COUNT(DISTINCT bayi_kodu) AS benzersiz_bayi,\r\n+    COUNT(DISTINCT musteri_no) AS benzersiz_musteri,\r\n+    COUNT(DISTINCT donem) AS farklı_donem,\r\n+    MIN(islem_tarihi) AS en_eski_islem,\r\n+    MAX(islem_tarihi) AS en_yeni_islem,\r\n+    SUM(tutar) AS genel_toplam_tutar\r\n+FROM primebaz_rapor;\r\n+\r\n */\n\\ No newline at end of file\n"
                }
            ],
            "date": 1759242376077,
            "name": "Commit-0",
            "content": "-- Primebaz Rapor Tablosu Oluşturma Script'i\r\n-- Bu script Primebaz Excel dosyalarından gelen verileri saklamak için gerekli tabloyu oluşturur\r\n\r\nUSE [digiturk_rapor_db];\r\nGO\r\n\r\n-- Eğer tablo mevcutsa sil (isteğe bağlı)\r\n-- DROP TABLE IF EXISTS primebaz_rapor;\r\n\r\n-- Primebaz rapor tablosunu oluştur\r\nIF NOT EXISTS (SELECT * FROM sysobjects WHERE name='primebaz_rapor' AND xtype='U')\r\nBEGIN\r\n    CREATE TABLE primebaz_rapor (\r\n        id BIGINT IDENTITY(1,1) PRIMARY KEY,\r\n        \r\n        -- Bayi bilgileri\r\n        bayi_kodu NVARCHAR(50) NULL,\r\n        bayi_adi NVARCHAR(200) NULL,\r\n        bolge NVARCHAR(100) NULL,\r\n        il NVARCHAR(50) NULL,\r\n        ilce NVARCHAR(100) NULL,\r\n        mahalle NVARCHAR(200) NULL,\r\n        alan_kodu NVARCHAR(50) NULL,\r\n        \r\n        -- Müşteri bilgileri\r\n        musteri_no NVARCHAR(50) NULL,\r\n        musteri_adi NVARCHAR(200) NULL,\r\n        musteri_soyadi NVARCHAR(200) NULL,\r\n        telefon NVARCHAR(20) NULL,\r\n        adres NVARCHAR(500) NULL,\r\n        \r\n        -- Ürün bilgileri\r\n        urun_kodu NVARCHAR(50) NULL,\r\n        urun_adi NVARCHAR(200) NULL,\r\n        paket_kodu NVARCHAR(50) NULL,\r\n        paket_adi NVARCHAR(200) NULL,\r\n        \r\n        -- Tarih bilgileri\r\n        baslangic_tarihi DATETIME2 NULL,\r\n        bitis_tarihi DATETIME2 NULL,\r\n        islem_tarihi DATETIME2 NULL,\r\n        \r\n        -- İşlem bilgileri\r\n        islem_tipi NVARCHAR(50) NULL,\r\n        \r\n        -- Mali bilgiler\r\n        tutar DECIMAL(12,2) NULL,\r\n        komisyon_orani DECIMAL(5,2) NULL,\r\n        komisyon_tutari DECIMAL(12,2) NULL,\r\n        kdv_orani DECIMAL(5,2) NULL,\r\n        kdv_tutari DECIMAL(12,2) NULL,\r\n        toplam_tutar DECIMAL(12,2) NULL,\r\n        \r\n        -- Ödeme bilgileri\r\n        odeme_tarihi DATETIME2 NULL,\r\n        odeme_durumu NVARCHAR(50) NULL,\r\n        \r\n        -- Açıklamalar\r\n        aciklama NVARCHAR(500) NULL,\r\n        \r\n        -- Dönem bilgileri (dosya adından çıkarılır)\r\n        ay INT NULL,\r\n        yil INT NULL,\r\n        donem NVARCHAR(20) NULL,\r\n        \r\n        -- Sistem alanları\r\n        eklenme_tarihi DATETIME2 NOT NULL DEFAULT GETDATE(),\r\n        guncellenme_tarihi DATETIME2 NULL,\r\n        dosya_adi NVARCHAR(255) NULL\r\n    );\r\n    \r\n    PRINT 'primebaz_rapor tablosu oluşturuldu.';\r\nEND\r\nELSE\r\nBEGIN\r\n    PRINT 'primebaz_rapor tablosu zaten mevcut.';\r\nEND;\r\n\r\n-- İndeksler oluştur\r\n-- Bayi kodu indeksi\r\nIF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID('primebaz_rapor') AND name = 'IX_primebaz_rapor_bayi_kodu')\r\nBEGIN\r\n    CREATE INDEX IX_primebaz_rapor_bayi_kodu ON primebaz_rapor (bayi_kodu);\r\n    PRINT 'Bayi kodu indeksi oluşturuldu.';\r\nEND;\r\n\r\n-- Müşteri numarası indeksi\r\nIF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID('primebaz_rapor') AND name = 'IX_primebaz_rapor_musteri_no')\r\nBEGIN\r\n    CREATE INDEX IX_primebaz_rapor_musteri_no ON primebaz_rapor (musteri_no);\r\n    PRINT 'Müşteri numarası indeksi oluşturuldu.';\r\nEND;\r\n\r\n-- Dönem indeksi\r\nIF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID('primebaz_rapor') AND name = 'IX_primebaz_rapor_donem')\r\nBEGIN\r\n    CREATE INDEX IX_primebaz_rapor_donem ON primebaz_rapor (yil, ay, donem);\r\n    PRINT 'Dönem indeksi oluşturuldu.';\r\nEND;\r\n\r\n-- İşlem tarihi indeksi\r\nIF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID('primebaz_rapor') AND name = 'IX_primebaz_rapor_tarih')\r\nBEGIN\r\n    CREATE INDEX IX_primebaz_rapor_tarih ON primebaz_rapor (islem_tarihi);\r\n    PRINT 'İşlem tarihi indeksi oluşturuldu.';\r\nEND;\r\n\r\n-- Dosya adı indeksi\r\nIF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID('primebaz_rapor') AND name = 'IX_primebaz_rapor_dosya')\r\nBEGIN\r\n    CREATE INDEX IX_primebaz_rapor_dosya ON primebaz_rapor (dosya_adi);\r\n    PRINT 'Dosya adı indeksi oluşturuldu.';\r\nEND;\r\n\r\n-- Ekleme tarihi indeksi\r\nIF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID('primebaz_rapor') AND name = 'IX_primebaz_rapor_eklenme')\r\nBEGIN\r\n    CREATE INDEX IX_primebaz_rapor_eklenme ON primebaz_rapor (eklenme_tarihi);\r\n    PRINT 'Ekleme tarihi indeksi oluşturuldu.';\r\nEND;\r\n\r\n-- Tablo istatistikleri\r\nSELECT \r\n    'primebaz_rapor' AS tablo_adi,\r\n    COUNT(*) AS toplam_kayit,\r\n    COUNT(DISTINCT bayi_kodu) AS benzersiz_bayi,\r\n    COUNT(DISTINCT musteri_no) AS benzersiz_musteri,\r\n    COUNT(DISTINCT donem) AS benzersiz_donem,\r\n    MIN(eklenme_tarihi) AS ilk_kayit,\r\n    MAX(eklenme_tarihi) AS son_kayit\r\nFROM primebaz_rapor;\r\n\r\nPRINT 'Primebaz rapor tablosu ve indeksleri başarıyla oluşturuldu.';\r\n\r\n-- Kullanım örnekleri:\r\n/*\r\n\r\n-- Belirli bir dönemdeki verileri getir\r\nSELECT * FROM primebaz_rapor \r\nWHERE yil = 2025 AND ay = 3 \r\nORDER BY islem_tarihi;\r\n\r\n-- Bayi bazında özet rapor\r\nSELECT \r\n    bayi_kodu,\r\n    bayi_adi,\r\n    COUNT(*) AS toplam_islem,\r\n    SUM(tutar) AS toplam_tutar,\r\n    SUM(komisyon_tutari) AS toplam_komisyon\r\nFROM primebaz_rapor \r\nWHERE yil = 2025 AND ay = 3\r\nGROUP BY bayi_kodu, bayi_adi\r\nORDER BY toplam_tutar DESC;\r\n\r\n-- Aylık özet\r\nSELECT \r\n    yil,\r\n    ay,\r\n    donem,\r\n    COUNT(*) AS toplam_kayit,\r\n    SUM(tutar) AS toplam_tutar,\r\n    SUM(komisyon_tutari) AS toplam_komisyon,\r\n    COUNT(DISTINCT bayi_kodu) AS aktif_bayi\r\nFROM primebaz_rapor\r\nGROUP BY yil, ay, donem\r\nORDER BY yil DESC, ay DESC;\r\n\r\n-- Dosya bazında yükleme durumu\r\nSELECT \r\n    dosya_adi,\r\n    COUNT(*) AS kayit_sayisi,\r\n    MIN(eklenme_tarihi) AS yukleme_tarihi,\r\n    donem\r\nFROM primebaz_rapor\r\nGROUP BY dosya_adi, donem\r\nORDER BY yukleme_tarihi DESC;\r\n\r\n*/"
        }
    ]
}